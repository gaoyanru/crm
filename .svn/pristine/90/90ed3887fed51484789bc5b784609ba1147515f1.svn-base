"use strict";var crmApp=angular.module("crmApp",["ngAnimate","ngMessages","ngRoute","ui.router","ui.bootstrap","angularFileUpload","ngLocale","fixed.table.header","ngMaterial","chart.js"]);crmApp.config(["$stateProvider","$urlRouterProvider","$httpProvider","userProvider","$mdThemingProvider","$mdAriaProvider",function(a,b,c,d,e,f){a.state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("main",{url:"/main",templateUrl:"views/main.html",controller:"MainCtrl",title:"爱康鼎客户管理系统"}).state("main.dashboard",{url:"/dashboard",templateUrl:"views/dashboard.html",controller:"Dashboard",title:"爱康鼎客户管理系统"}).state("main.cus_pub",{url:"/customers/pub",templateUrl:"views/customer_pub.html",controller:"Customer_pub"}).state("main.cus_my",{url:"/customers/my",templateUrl:"views/customer_my.html",controller:"Customer_my"}).state("main.cus_signed",{url:"/customers/signed",templateUrl:"views/customer_signed.html",controller:"Customer_signed"}).state("main.cus_settings",{url:"/customers/setting",templateUrl:"views/customer_setting.html",controller:"Customer_setting"}).state("main.order_addAgent",{url:"/orders/OrderAddAgent/:orderid",templateUrl:"views/order_addAgent.html",controller:"OrderAddAgent"}).state("main.order_complete",{url:"/orders/ordercomplete",templateUrl:"views/order_complete.html",controller:"Order_complete"}).state("main.order_list",{url:"/orders/orderlist",templateUrl:"views/order_list.html",controller:"Order_list"}).state("main.order_remind",{url:"/orders/orderremind",templateUrl:"views/order_remind.html",controller:"Order_remind"}).state("main.order_change",{url:"/orders/order_change",templateUrl:"views/order_change.html",controller:"Order_change"}).state("main.order_statement",{url:"/orders/statement",templateUrl:"views/order_statement.html",controller:"Order_statement"}).state("main.order_outworker",{url:"/orders/outworker",templateUrl:"views/order_outworker.html",controller:"Order_outworker"}).state("main.company_sub",{url:"/company/sub",templateUrl:"views/company_sublist.html",controller:"Company_sub"}).state("main.statis_cus",{url:"/statis/statis_cus",templateUrl:"views/statis_cus.html",controller:"Statis_cus"}).state("main.statis_top",{url:"/statis/statis_top",templateUrl:"views/statis_top.html",controller:"Statis_top"}).state("main.static_order",{url:"/statis/static_order",templateUrl:"views/statis_order.html",controller:"Statis_order"}).state("main.users",{url:"/statis/user_users",templateUrl:"views/user_users.html",controller:"User_users"}).state("main.user_my",{url:"/statis/user_my",templateUrl:"views/user_my.html",controller:"User_my"}).state("main.site_ps",{url:"/statis/site_ps",templateUrl:"views/site_ps.html",controller:"Site_ps"}).state("main.statis_mate",{url:"/statis/statis_mate",templateUrl:"views/statis_mate.html",controller:"Statis_mate"}).state("main.statis_tend",{url:"/statis/statis_tend",templateUrl:"views/statis_tend.html",controller:"Statis_tend"}).state("main.statis_today",{url:"/statis/statis_today",templateUrl:"views/statis_today.html",controller:"Statis_today"}).state("main.user_group",{url:"/user/group",templateUrl:"views/user_group.html",controller:"User_group"}).state("main.statis_signed",{url:"/user/statis_signed",templateUrl:"views/statis_signed.html",controller:"Statis_signed"}).state("main.outwork_dict",{url:"/user/outwork_dict",templateUrl:"views/outwork_dict.html",controller:"Outwork_dict"}).state("main.go_task_config",{url:"/orders/go_task_config",templateUrl:"views/go_task_config.html",controller:"Gotaskconfig"}),b.when("/main/user","/login").otherwise("/login"),c.defaults.transformResponse.push(function(a,b,c){return angular.isString(a)?a:401==c?void(location.href="#login"):a.status?a:(alert(a.message),a)}),e.theme("default").primaryPalette("blue-grey"),c.interceptors.push(["$q","$rootScope",function(a,b){var c=0;return{request:function(a){return c++,b.isLoading=!0,a},response:function(a){return c--,0===c&&(b.isLoading=!1),a},responseError:function(d){return c--,0===c&&(b.isLoading=!1),a.reject(d)}}}]),f.disableWarnings()}]).run(["$rootScope","$state","$http","$locale",function(a,b,c,d){}]),Date.prototype.toISOString=function(){return[this.getFullYear(),this.getMonth()+1,this.getDate()<10?"0"+this.getDate():this.getDate()].join("-")},angular.module("crmApp").provider("user",function(){var a={get:function(){var a=sessionStorage.getItem("user");return a||(location.href="#/login"),JSON.parse(a)},set:function(a){sessionStorage.setItem("user",JSON.stringify(a))}};this.$get=[function(){var b=sessionStorage.getItem("user");return b||(location.href="#/login"),a}],this.set=function(a){sessionStorage.setItem("user",JSON.stringify(a))}}),angular.module("ngLocale",[],["$provide",function(a){var b={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};a.value("$locale",{DATETIME_FORMATS:{AMPMS:["上午","下午"],DAY:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],ERANAMES:["公元前","公元"],ERAS:["公元前","公元"],FIRSTDAYOFWEEK:6,MONTH:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],SHORTDAY:["日","一","二","三","四","五","六"],SHORTMONTH:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],STANDALONEMONTH:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],WEEKENDRANGE:[5,6],fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"y年M月d日 ah:mm:ss",mediumDate:"y年M月d日",mediumTime:"ah:mm:ss","short":"y/M/d ah:mm",shortDate:"y/M/d",shortTime:"ah:mm"},NUMBER_FORMATS:{CURRENCY_SYM:"¥",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-¤",negSuf:"",posPre:"¤",posSuf:""}]},id:"zh-cn",localeID:"zh_CN",pluralCat:function(a,c){return b.OTHER}})}]),angular.module("crmApp").factory("server",["$http",function(a){return{getMyCustomer:function(b){return a.get("/api/Customer?"+$.param(b))},saveCustomer:function(b,c){return b.Id?void 0:a.post("/api/customer?verify="+c,b)},getCustomerDetail:function(b){return a.get("/api/customerdetail/"+b)},saveCompany:function(b,c){return b.Id?void 0:a.post("/api/subsidiary?verify="+c,b)},getSalers:function(){return a.get("/api/contract/sales")},deleteCustomer:function(b){return a["delete"]("/api/opencustomer/"+b)},getIndustry:function(){return a.get("/api/industry")},getCustomerType:function(){return a.get("/api/cuscategory")},http:a}}]),angular.module("crmApp").factory("menu",["user",function(a){var b={selectSection:function(a){a.opened=!0},toggleSelectSection:function(a){a.opened=!a.opened},isSectionSelected:function(a){return a.opened},selectPage:function(a){self.currentPage&&(self.currentPage.selected=!1),a.selected=!0,self.currentPage=a},isPageSelected:function(a){return a.selected},getSections:function(){function b(a,b){return a.Rank>b.Rank}var c=a.get();if(c){var d=JSON.parse(c.FunctionList),e=[];_.each(d.sort(b),function(a){var c={};c.name=a.FunctionName,c.icon=a.Icon,c.type="toggle",c.pages=[],_.each(a.children.sort(b),function(a){var b={};b.name=a.FunctionName,b.router=a.FunctionUrl,b.type="link",c.pages.push(b)}),e.push(c)}),this.sections=e}}};return b.getSections(),b}]),angular.module("crmApp").controller("MainCtrl",["$scope","$http","$state","$stateParams","user","menu","$timeout",function(a,b,c,d,e,f,g){function h(a){return f.isPageSelected(a)}function i(a){return f.isSectionSelected(a)}function j(a){f.toggleSelectSection(a)}function k(b){a.title=b.name,f.selectPage(b)}a.user=e.get();angular.fromJson(a.user.FunctionList);a.routerChange=function(b){if(a.selectedNavTree=b,b.url){var d=b.params||{};c.go(b.url,d,{inherit:!1})}},a.updatePswd=function(){var a=$uibModal.open({templateUrl:"views/updatePswd.html",controller:"UpdatePswdCtrl"});a.result.then(function(a){},function(){console.info("Modal dismissed at: "+new Date)})},a.logout=function(){b.get("/api/security/logout").then(function(){sessionStorage.clear(),location.href="#/login"})},a.logoutZY=function(){b.put("/api/subsidiary/exit").success(function(a){b.get("/api/user").success(function(a){e.set(a.data[0]),f.getSections(),c.go("main"),location.reload()})})},this.isOpen=i,this.isSelected=h,this.toggleOpen=j,this.selectPage=k,a.menu=f;var l=c.current.name;"main"===l&&c.go("main.dashboard");var m=_.find(f.sections,function(a){var b=_.find(a.pages,{router:l});return b&&k(b),!!b});m||(a.title=c.current.title),a.$on("$stateChangeSuccess",function(b,c,d,e,f){c.title&&(a.title=c.title)})}]),angular.module("crmApp").controller("LoginCtrl",["$scope","$state","$http","menu",function(a,b,c,d){a.login=function(){var e=a.userName,f=a.password;return e&&f?void c.post("/api/security/login",{UserName:e,PassWord:f}).success(function(a){a.status!==!1&&(sessionStorage.setItem("user",JSON.stringify(a.data)),d.getSections(),b.go("main"))}).error(function(){}):void alert("请输入用户名和密码!")}}]),angular.module("crmApp").directive("menuLink",function(){return{scope:{section:"="},templateUrl:"views/menu-link.tmpl.html",link:function(a,b){var c=b.parent().controller();a.isSelected=function(){return c.isSelected(a.section)},a.selectPage=function(a){c.selectPage(a)}}}}).directive("menuToggle",["$mdUtil","$animateCss","$$rAF",function(a,b,c){return{scope:{section:"="},templateUrl:"views/menu-toggle.tmpl.html",link:function(a,b){var c=b.parent().controller();a.renderContent=!1,a.isOpen=function(){return c.isOpen(a.section)},a.toggle=function(){c.toggleOpen(a.section)};var d=b[0].parentNode.parentNode.parentNode;if(d.classList.contains("parent-list-item")){var e=d.querySelector("h2");b[0].firstChild.setAttribute("aria-describedby",e.id)}}}}]),angular.module("crmApp").directive("dateFormat",["$filter",function(a){var b=a("date");return{require:"ngModel",link:function(a,c,d,e){function f(a){return b(a,"yyyy-MM-dd")}e.$formatters.push(f)}}}]),angular.module("crmApp").directive("picView",["$uibModal",function(a){return{restrict:"A",replace:!0,link:function(a,b,c,d){var e=c.ngSrc;a.src=e,b.find("img").viewer({navbar:!1,title:!1,built:function(){var a=$(this).next(),b=this;a.find(".viewer-canvas").on("click",function(a){"IMG"!==a.target.tagName.toUpperCase()&&$(b).viewer("hide")}),$("body").append(a)}}),a.$watch(function(){return c.ngSrc},function(b,c){b!==c&&(a.src=b)})},template:'<div class="picView"><img src="{{src}}" alt="" class="img-thumbnail"></div>'}}]),angular.module("crmApp").filter("filterRole",function(){var a=function(a){var b="";switch(a){case 1:b="系统管理员";break;case 2:b="总经理";break;case 3:b="财务总监";break;case 4:b="销售总监";break;case 5:b="业务员";break;default:b="其他"}return b};return a}).filter("filterInvoiceProperty",function(){var a=function(a){var b="";switch(+a){case 1:b="公司";break;case 2:b="个人"}return b};return a}).filter("psType",function(){var a=function(a){var b="";switch(+a){case 1:b="公司核名";break;case 2:b="产品服务";break;case 3:b="贷帐公司";case 4:b="孵化器";case 5:b="渠道"}return b};return a}).filter("filterInvoiceCategory",function(){var a=function(a){var b="";switch(+a){case 1:b="专票";break;case 2:b="普票"}return b};return a}),angular.module("crmApp").filter("filterInvoice",function(){var a=function(a){var b="";switch(a){case 1:b="非预借发票"}return b};return a}),angular.module("crmApp").filter("filterProp",function(){var a=function(a){var b="";switch(a){case 1:b="公司";break;case 2:b="个人"}return b};return a}),angular.module("crmApp").filter("filterAddValue",function(){var a=function(a){var b={1:"小规模",2:"一般纳税人"};return b[a]};return a}).filter("tDateTime",function(){var a=function(a){return"0001"==a.substr(0,4)?"":a?a.replace("T"," "):""};return a}).filter("tDate",function(){var a=function(a){return a?"0001"==a.substring(0,4)?null:a?a.substring(0,10):"":null};return a}).filter("fPayType",function(){var a=function(a){var b={1:"半年付",2:"年付",3:"季付",4:"零税(半年)"};return b[a]};return a}).filter("nospace",function(){return function(a){return a?a.replace(/ /g,""):""}}).filter("cusTypeName",function(){return function(a,b){var c=_.find(b,{CustomerTypeId:a});return c?c.Name:""}}).filter("groupMember",function(){return function(a,b){if(!b)return a;var c=_.filter(a,{DepartmentId:b});return c}}).filter("orderCategory",function(){var a={1:"记账",2:"注册+记账"};return function(b){return a[b]}}).filter("fDate",function(){var a=function(a){return a?"0001"==a.substring(0,4)?null:new Date(a):(console.error("time error"),null)};return a}).filter("otStatus",function(){var a={1:"进行中",2:"已完成",3:"未开始"};return function(b){return a[b]}}).filter("fYseNo",function(){return function(a){return a?"是":"否"}}).filter("fOtType",function(){return function(a){var b={1:"税务",2:"工商",3:"其他"};return b[a]}}).filter("outWorkStatus",function(){var a=function(a){var b="";switch(+a){case 1:b="待分配";break;case 2:b="待处理";break;case 3:b="进行中";break;case 4:b="已取消";break;case 5:b="已完成"}return b};return a}),angular.module("crmApp").controller("Customer_my",["$scope","server","$state","$mdDialog","user","$mdToast","$q","FileUploader","$timeout",function(a,b,c,d,e,f,g,h,i){function j(a,b){return parseInt(a.Name)<parseInt(b.Name)}function k(){var c=g.defer(),d=angular.extend({offset:(a.paginator.currentPage-1)*a.paginator.perPage,limit:a.paginator.perPage},a.searchItem,d);return 0===d.tagIds&&(d.tagIds=""),b.getMyCustomer(d).success(function(b){a.paginator.total=b.data.total,a.customers=b.data.list,c.resolve(a.customers[0].Id)}),c.promise}function l(a,b){var c=/^.*\.(?:xls|xlsx)$/;return c.test(a.name)?!0:(alert("请选择Excel文件"),!1)}a.user=e.get(),a.open=function(b){function c(a){k()}var e;e=b?"views/customer_view.html":"views/customer_addCustomer.html",d.show({controller:"Customer_view",templateUrl:e,clickOutsideToClose:!0,fullscreen:!0,locals:{customer:b||{},getNextId:a.getNextId}}).then(function(a){c(a)},function(){})},a.getNextId=function(b){var c=g.defer(),d=_.find(a.customers,{Id:b.Id}),e=_.indexOf(a.customers,d)+1;return e<a.customers.length?c.resolve(a.customers[e].Id):(a.paginator.currentPage+=1,k().then(function(a){c.resolve(a)})),c.promise},b.getCustomerType().success(function(b){a.ctypes=b.data.sort(j)}),a.search={cusType:0,userid:0},a["delete"]=function(a){confirm("确认要删除客户吗？")&&b.deleteCustomer(a.Id).then(function(a){a.status&&k()})},a.forward=function(a){d.show({controller:"Customer_forword",templateUrl:"views/customer_forward.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:a||{}}}).then(function(a){k()},function(){})},a.toPub=function(a){confirm("确认要将客户转入公海吗？")&&b.http.put("/api/custranstoocean?customerId="+a.Id).then(function(a){a.status&&k()})},a.toPubAll=function(){var c=_.map(_.filter(a.customers,{selected:!0}),"Id");b.http.post("/api/customerocean",c).then(function(a){k()})},a.selectAll=function(){_.each(a.customers,function(a){a.selected=!0})},a.clear=function(){_.each(a.customers,function(a){a.selected=!1})},a.toOthersAll=function(){var b=_.map(_.filter(a.customers,{selected:!0}),"Id");d.show({controller:"Customer_forword",templateUrl:"views/customer_forward.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:b||[]}}).then(function(a){k()},function(){})},a.closeTool=function(){a.batIsOpen=!1},a.getFromPub=function(a){b.http.put("/api/grabcustomers?CustomerSourceId="+a).success(function(a){f.show(f.simple().textContent("操作成功！").position("top center").hideDelay(1e3)),k()})},a.paginator={total:0,currentPage:1,perPage:10,previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.pageChanged=function(){k()},a.setCurrentPage=function(){a.paginator.currentPage=a.currentPage,k()},a.searchItem={companyName:"",SalesId:0,phone:"",CustomerTypeId:0,tagIds:0,DepartmentId:0,CustomerSourceId:0},a.searchFn=function(){a.searchItem.companyName=a.search.companyName,a.searchItem.phone=a.search.phone,a.searchItem.CustomerTypeId=a.search.cusType,angular.isArray(a.search.tagId)?a.searchItem.tagIds=_.map(a.search.tagId,"Id").join(","):a.searchItem.tagIds="",a.searchItem.DepartmentId=a.search.DepartmentId||0,a.searchItem.SalesId=a.search.userid||0,a.searchItem.CustomerSourceId=a.search.CustomerSourceId||0,a.searchItem.firsttracktime=a.search.firsttracktime?a.search.firsttracktime.toISOString():"",a.searchItem.lasttracktime=a.search.lasttracktime?a.search.lasttracktime.toISOString():"",k(a.searchItem)},a.checkBQ=function(){a.search.tagId.indexOf(0)>-1&&a.search.tagId.length>1&&_.pull(a.search.tagId,0)},a.tagSelect=function(b){angular.isArray(a.search.tagId)&&(a.search.tagId.indexOf(b)>-1||_.remove(a.search.tagId,function(a){return a.TagType===b.TagType}))},k(),a.verifyGroup=function(){if(0!=a.search.DepartmentId){var b=a.search.DepartmentId,c=_.find(a.users,{UserId:a.search.userid});return c?c.DepartmentId!=b?void(a.search.userid=0):void 0:void(a.search.userid=0)}},b.http.get("/api/tag").success(function(b){a.tags=b.data,a.tagGroup=_.groupBy(a.tags,"TagType")}),b.getSalers().success(function(b){a.users=b.data}),b.http.get("/api/departments").success(function(b){a.groups=b.data}),b.http.get("/api/customersource").success(function(b){b.status&&(a.sourceTypes=b.data)}),a.uploader2=new h({url:"/api/files/4",autoUpload:!0}),a.uploader2.onBeforeUploadItem=function(a,b){d.show({controller:["$scope","$interval",function(a,b){a.loadingText="导入中..."}],templateUrl:"views/common_loading.html",clickOutsideToClose:!1,fullscreen:!0,locals:{customer:a||{}}})},a.uploader2.onCompleteItem=function(a,b,c,e){return b.hasError?(alert(b.message),void location.reload()):(d.hide(),void i(function(){b.data.length>0?(alert(b.data.join("\n")),location.reload()):(alert("全部导入成功！"),location.reload())},500))},a.uploader2.onErrorItem=function(){alert("上传失败!")},a.uploader2.filters.push({name:"customFilter",fn:l}),a.upFile=function(b,c){a.uploader2.url="/api/files/4?customSourceId="+b+"&saleId="+a.user.UserId,$(c.target).parents(".dropdown-menu").find('input[type="file"]').click()}}]).controller("Customer_view",["$scope","server","$mdDialog","$mdToast","customer","user","getNextId",function(a,b,c,d,e,f,g){function h(a,b){return parseInt(a.Name)<parseInt(b.Name)}function i(c){b.getCustomerDetail(c).success(function(b){b.status&&(a.postData=b.data,a.title=a.postData.CompanyName,e=b.data,j())})}function j(){b.http.get("/api/customertag/"+e.Id).success(function(b){a.custags=b.data,a.tags||k()})}function k(){b.http.get("/api/tag").success(function(b){var c={},d=a.custags;m=b.data,_.each(b.data,function(a){var b=_.find(d,function(b){return a.Id===b.TagId});c[a.TagType]?c[a.TagType].tags.push(a):c[a.TagType]={selected:-1,tags:[a]},b&&(c[a.TagType].selected=c[a.TagType].tags.length-1)}),a.tags=c})}a.postData={},a.customer={Id:e.Id},a.opt={},a.notPub=!0,b.getCustomerType().success(function(b){a.ctypes=b.data.sort(h)}),b.http.get("/api/mycity").success(function(b){a.city=b.data[0]}),b.http.get("/api/customersource").success(function(b){b.status&&(a.sourceTypes=b.data)});var l=f.get();a.title=e.CompanyName||"新增客户",e.Id&&i(e.Id),a.next=function(d){angular.element('div[ng-controller="Customer_track"]').scope().save(),b.http.put("/api/customer/"+e.Id+"?verify=0",a.postData).success(function(f){if(f&&angular.isObject(f.data)){var h=f.data,j=JSON.parse(h.name);c.show({controller:"Customer_warning",templateUrl:"views/customer_warning.html",clickOutsideToClose:!0,fullscreen:!0,skipHide:!0,locals:{customers:j}}).then(function(c){b.http.put("/api/customer/"+e.Id+"?verify=1",a.postData).success(function(b){b.status&&g(d).then(function(b){a.customer.Id=b,i(b)})})},function(){})}else f.status&&g(d).then(function(b){a.customer.Id=b,i(b)})})},a.toPub=function(c){confirm("确认要将客户转入公海吗？")&&b.http.put("/api/custranstoocean?customerId="+a.customer.Id).then(function(b){b.status&&g(c).then(function(b){a.customer.Id=b,i(b)})})},a.ok=function(f){e.Id?b.http.put("/api/customer/"+e.Id,a.postData).success(function(b){b.status&&(d.show(d.simple().textContent("修改成功！").position("top center").hideDelay(2e3)),c.hide(a.postData))}):(a.city&&(a.postData.CityCode=a.city.Code),b.saveCustomer(a.postData,0).success(function(e){if(e&&angular.isObject(e.data)){var f=e.data;if(1==f.errorcode)d.show(d.simple().textContent(e.data.name).position("top center").hideDelay(2e3));else{var g=JSON.parse(f.name);c.show({controller:"Customer_warning",templateUrl:"views/customer_warning.html",clickOutsideToClose:!0,fullscreen:!0,skipHide:!0,locals:{customers:g}}).then(function(d){b.saveCustomer(a.postData,1).success(function(a){a.status&&c.hide()})},function(){})}}else c.hide(a.postData)}))},a.cancel=function(){c.cancel()},a.addTag=function(c){function d(){b.http.post("/api/customertag",f).success(function(){j()})}var f={CustomerId:e.Id,TagId:c.Id,SalesId:l.UserId},g=_.indexOf(a.tags[c.TagType].tags,c);if(a.tags[c.TagType].selected!==g){a.tags[c.TagType].selected=g;var h=_.find(a.custags,{TagType:c.TagType});return h?void b.http["delete"]("/api/customertag/"+h.Id).success(function(){d()}):void d()}},a.deleteTag=function(c){if(m){var d=_.find(m,{Id:c.TagId});a.tags[d.TagType].selected=-1}b.http["delete"]("/api/customertag/"+c.Id)},a.track=function(a){c.show({controller:"Customer_track",templateUrl:"views/customer_track.html",clickOutsideToClose:!0,fullscreen:!0,skipHide:!0,locals:{customer:a||{}}}).then(function(a){},function(){})};var m}]).controller("Customer_forword",["$scope","server","$mdDialog","$mdToast","customer",function(a,b,c,d,e){b.getSalers().success(function(b){a.salers=b.data}),a.ok=function(d){angular.isArray(e)?b.http.put("/api/transcustomer/"+a.saler,e).success(function(a){a.status&&c.hide()}):b.http.put("/api/customer/"+e.Id+"/"+a.saler).success(function(a){a.status&&c.hide()})},a.cancel=function(){c.cancel()}}]).controller("Customer_track",["$scope","$filter","server","$mdDialog","$mdToast","user",function(a,b,c,d,e,f){function g(){c.http.get("/api/customertrack/"+h.Id).success(function(b){a.tracks=b.data})}var h=a.customer;f.get();a.track={},a.title=h.CompanyName,a.save=function(){if(a.track.content){var d={CustomId:h.Id,Description:a.track.content,TrackDate:b("date")(a.TrackDate,"yyyy-MM-dd")};c.http.post("/api/customertrack",d).success(function(){a.track.content="",g()})}},a.cancel=function(){d.cancel()},a.$watch("customer.Id",function(a,b){a&&g()})}]).controller("Customer_remind",["$scope","$filter","server","$mdDialog","$mdToast","user",function(a,b,c,d,e,f){function g(){c.http.get("/api/nexttrackremind/"+h.Id).success(function(b){a.reminds=b.data})}var h=a.customer,i=f.get();a.title=h.CompanyName,a.today=new Date,a.remind={},a.$watch("customer.Id",function(a,b){a&&g()}),a.addRemind=function(){var d=_.find(a.reminds,function(c){return b("date")(a.remind.remindDate,"yyyy-MM-dd")==c.NextTrackTime.substr(0,10)});if(d)return void(a.remind.remindDate=null);var e={SalesId:i.UserId,CustomerId:h.Id,NextTrackTime:a.remind.remindDate};c.http.post("/api/nexttrackremind",e).success(function(){g(),a.remind.remindDate=null})},a.deleteRemind=function(a){c.http["delete"]("/api/nexttrackremind/"+a.Id)},a.cancel=function(){d.cancel()}}]).controller("Customer_warning",["$scope","$mdDialog","customers",function(a,b,c){a.customers=c,a.ok=function(a){b.hide()},a.cancel=function(){b.cancel()}}]),angular.module("crmApp").controller("Customer_pub",["$scope","server","$state","$mdDialog","FileUploader","$timeout","$mdToast","user","$q",function(a,b,c,d,e,f,g,h,i){function j(a,b){return parseInt(a.Name)<parseInt(b.Name)}function k(){var c=angular.extend({offset:(a.paginator.currentPage-1)*a.paginator.perPage,limit:a.paginator.perPage},a.searchItem,c);b.http.get("/api/opencustomer?"+$.param(c)).success(function(b){a.paginator.total=b.data.total,a.customers=b.data.list})}a.title=c.current.title,a.user=h.get(),a.open=function(b){function c(a){k()}var e;e=b?"views/customer_view.html":"views/customer_addCustomer.html",d.show({controller:"Customer_viewpub",templateUrl:e,clickOutsideToClose:!0,fullscreen:!0,locals:{customer:b||{},getNextId:a.getNextId}}).then(function(a){c(a)},function(){})},a.getNextId=function(b){var c=i.defer(),d=_.find(a.customers,{Id:b.Id}),e=_.indexOf(a.customers,d)+1;return e<a.customers.length?c.resolve(a.customers[e].Id):(a.paginator.currentPage+=1,k().then(function(a){c.resolve(a)})),c.promise},a["delete"]=function(a){confirm("确认要删除客户吗？")&&b.deleteCustomer(a.Id).success(function(a){a.status&&k()})},a.forward=function(a){b.http.put("/api/opencustomer/"+a.Id+"/6").success(function(a){a.status&&(g.show(g.simple().textContent("操作成功！").position("top center").hideDelay(1e3)),k())})},a.paginator={total:0,currentPage:1,perPage:10,previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.searchParams={limit:10,offset:0,start:"",end:"",status:0,cusname:"",cid:""},a.pageChanged=function(){k()},a.setCurrentPage=function(){a.paginator.currentPage=a.currentPage,k()},a.searchItem={companyName:"",Mobile:"",HisCusTypeId:0},b.http.get("/api/cuscategory").success(function(b){b.status&&(a.ctypes=b.data.sort(j))}),a.search={cusType:0},a.search=function(){a.searchItem.companyName=a.search.companyName,a.searchItem.Mobile=a.search.phone,a.searchItem.HisCusTypeId=a.search.cusType,k(a.searchItem)},k(),b.http.get("/api/customersource").success(function(b){b.status&&(a.sourceTypes=b.data)})}]).controller("Customer_viewpub",["$scope","server","$mdDialog","$mdToast","customer","getNextId",function(a,b,c,d,e,f){function g(c){c&&(b.getCustomerDetail(c).success(function(b){b.status&&(a.postData=_.extend(a.postData,b.data),a.title=a.postData.CompanyName)}),h())}function h(){e.Id&&b.http.get("/api/customertag/"+e.Id).success(function(b){a.custags=b.data})}a.postData={CustomerTypeId:5},a.isPub=!0,a.customer={Id:e.Id},b.getCustomerType().success(function(b){a.ctypes=b.data}),b.http.get("/api/customersource").success(function(b){b.status&&(a.sourceTypes=b.data)}),a.title=e.CompanyName||"新增客户",g(e.Id),a.next=function(c){angular.element('div[ng-controller="Customer_track"]').scope().save(),e.Id?b.http.put("/api/customer/"+e.Id,a.postData).success(function(b){b.status&&f(c).then(function(b){a.customer.Id=b,g(b)})}):b.saveCustomer(a.postData,0).success(function(e){e&&e.data.errorcode?1==e.data.errorcode?d.show(d.simple().textContent(e.data.name).position("top center").hideDelay(2e3)):confirm('手机号码与"'+e.data.name+'"公司的重复，请确定是否继续提交！')&&b.saveCustomer(a.postData,0).success(function(b){f(c).then(function(b){a.customer.Id=b,g(b)})}):f(c).then(function(b){a.customer.Id=b,g(b)})})},a.ok=function(f){e.Id?b.http.put("/api/customer/"+e.Id,a.postData).success(function(a){a.status&&(d.show(d.simple().textContent("修改成功！").position("top center").hideDelay(2e3)),c.hide())}):b.saveCustomer(a.postData,0).success(function(e){e&&e.data.errorcode?1==e.data.errorcode?d.show(d.simple().textContent(e.data.name).position("top center").hideDelay(2e3)):confirm('手机号码与"'+e.data.name+'"公司的重复，请确定是否继续提交！')&&b.saveCustomer(a.postData,0).success(function(b){b.status&&c.hide(a.postData)}):c.hide(a.postData)})},a.cancel=function(){c.cancel()}}]).controller("Customer_rob",["$scope","server","$mdDialog","$mdToast","customer",function(a,b,c,d,e){b.getCustomerType().success(function(b){a.ctypes=b.data});var f=!1;a.ok=function(g){b.http.put("/api/opencustomer/"+e.Id+"/"+a.cusType).success(function(a){f=!0,a.status&&(d.show(d.simple().textContent("操作成功！").position("top center").hideDelay(1e3)),c.hide())})},a.cancel=function(){f?c.hide():c.cancel()}}]),angular.module("crmApp").controller("OrderAddAgent",["$scope","$state","server","$filter","FileUploader","$mdDialog","$mdToast","$timeout","user","$uibModal",function(a,b,c,d,e,f,g,h,i,j){function k(){if(a.salers&&a.postData.SalesId){var b=_.find(a.salers,{UserId:a.postData.SalesId});b||a.salers.push({UserId:a.postData.SalesId,RealName:a.postData.SalesName,disabled:!0})}}function l(b,c,d){var e=m(d,b.file.name);b.formData.push({key:e}),_.each(a.signkey,function(a,c){var d={};d[c]=a,b.formData.push(d)}),a["_key"+c]=e}function m(a,b){var c=function(a){var b="",c=a.lastIndexOf(".");return-1!=c&&(b=a.substring(c)),b},e=function(a){a=a||32;for(var b="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",c=b.length,d="",e=0;a>e;e++)d+=b.charAt(Math.floor(Math.random()*c));return d},f=c(b),g={1:"FileUploads/Order/CardID/",2:"FileUploads/Order/BusinessLicense/",3:"FileUploads/Order/Contract/",4:"FileUploads/Agent/"},h=d("date")(new Date,"yyyyMM"),i=g[a]+h+"/"+e(10)+f;return i}function n(c,d){function e(){h(function(){b.go("main.order_list")},10)}if(a.saving=!1,c.status)if(a.ok&&a.ok(),d){a.postData.Customer.Id||(a.postData.Customer.Id=c.data.CustomerId);var i=f.confirm().title("您需要添加外勤任务吗?").textContent("").ok("添加").cancel("不添加");f.show(i).then(function(){var b=j.open({templateUrl:"views/order_outworker_add.html",controller:"Order_outworker_add",backdrop:"static",size:"hg",resolve:{customer:function(){return a.postData.Customer}}});b.result.then(function(a){e()},function(){e()})},function(){e()})}else g.show(g.simple().textContent("保存成功！").position("top center").hideDelay(2e3)),e()}function o(a,b){var c=/^.*\.(?:png|jpg|bmp|gif|jpeg)$/;return c.test(a.name)?!0:(alert("请选择图片"),!1)}function p(){function b(){d&&e&&(a.cjPrice=(e-d).toFixed(2))}var d,e;c.http.get("/api/order/price?"+$.param({AddedValue:1,PayType:1})).success(function(a){d=(a.data/6).toFixed(2),b()}),c.http.get("/api/order/price?"+$.param({AddedValue:2,PayType:1})).success(function(a){e=(a.data/6).toFixed(2),b()})}a.user=i.get(),c.http.get("/api/mycity").success(function(b){a.city=b.data[0]}),a.orderid&&c.http.get("/api/contractdetail/"+a.orderid).success(function(b){if(b.status){a.cStep=2,a.isRemind?(a.postData.Customer=b.data.Customer,a.postData.Category=1):(a.postData=b.data,a.postData.ContractDate=d("fDate")(a.postData.ContractDate),a.postData.ServiceStart=d("fDate")(a.postData.ServiceStart),a.postData.ServiceEnd=d("fDate")(a.postData.ServiceEnd));var c=a.postData;a.isChange&&(c.FreChangeOrderId=c.OrderId,delete c.OrderId,c.Customer.AddedValue=2,c.ServiceStart=null,c.Amount="",p()),c.Customer.RegisterDate=d("fDate")(c.Customer.RegisterDate),c.Customer.BusnissDeadline=d("fDate")(c.Customer.BusnissDeadline),c.Customer.NoDeadLine=!!c.Customer.NoDeadLine,a.isRemind?a.otherData={ServiceContent:"记账报税"}:a.isChange?a.otherData={ServiceContent:"产品变更"}:a.otherData=a.postData.StatementInfo,a.postData.ServiceEnd&&(a.maxDate=new Date(a.postData.ServiceEnd)),c.IsChange&&(c.Customer.AddedValue=1)}}),a.$parent&&a.$parent.orderForm&&(a.orderForm=a.$parent.orderForm),a.postData={Customer:{}},a.otherData={ServiceContent:"记账报税"},a.timeoption={timezone:"UTC"};var q;c.getSalers().success(function(b){a.salers=b.data,k()}),c.getIndustry().success(function(b){a.industries=b.data}),c.http.get("/api/paymodes").success(function(b){a.paymodes=b.data}),a.selectSalers=function(){a.cStep>0||a.orderid||(a.cStep=0)},a.selectTypeStep=function(b){a.orderid||(a.cStep=1)},a.getAmount=function(){a.otherData.AccountsTax=+a.postData.Amount;var b=_.pick(a.otherData,"AccountsTax","ServiceCharge","TaxPayment","AnnualReport","Register","OpenBank","NationLocalTax","Prints","AddressCost","Change"),c=0;return _.each(b,function(a){c+=+(a||0)}),c},a.selectCustomer=function(){var b=j.open({templateUrl:"views/Order_cusSelect.html",controller:"Order_cusSelect",size:"lg"});b.result.then(function(b){a.postData.Customer=b,b.AreaCode&&(a.areaSele=b.AreaCode)},function(){})},a.selectCustomerStep=function(b){if(1==b){var c=j.open({templateUrl:"views/Order_cusSelect.html",controller:"Order_cusSelect",size:"lg"});c.result.then(function(b){a.postData.Customer=b,a.postData.Customer.RegisterDate=d("fDate")(a.postData.Customer.RegisterDate),a.postData.Customer.BusnissDeadline=d("fDate")(a.postData.Customer.BusnissDeadline),a.postData.Customer.NoDeadLine=!!a.postData.Customer.NoDeadLine,a.cStep=2},function(){})}else{var e=a.postData.Category;q&&(q.SalesId=a.postData.SalesId,a.postData=q),a.postData.Category=e,a.cStep=2}q=angular.copy(a.postData)},c.http.get("/api/gift").success(function(b){a.gifts=b.data});var r="https://pilipa.oss-cn-beijing.aliyuncs.com";c.http.get("/api/signkey").success(function(b){delete b.data.Filename,delete b.data.key,delete b.data.callback,delete b.data.expire,delete b.data.Host,a.signkey=b.data}),a.uploader1=new e({url:r,autoUpload:!0}),a.uploader1.onCompleteItem=function(b,c,d,e){
a.postData.Customer.PersonCardPath=r+"/"+a._key1},a.uploader1.onBeforeUploadItem=function(a){l(a,1,1)},a.uploader1.onErrorItem=function(){alert("上传失败!")},a.uploader1.filters.push({name:"customFilter",fn:o}),a.uploader2=new e({url:r,autoUpload:!0}),a.uploader2.onCompleteItem=function(b,c,d,e){a.postData.Customer.BusinessLicense=r+"/"+a._key2},a.uploader2.onBeforeUploadItem=function(a){l(a,2,2)},a.uploader2.onErrorItem=function(){alert("上传失败!")},a.uploader2.filters.push({name:"customFilter",fn:o}),a.save=function(){if(a.saving=!0,a.city&&(a.postData.Customer.CityCode=a.city.Code),a.postData.GiftTypeId){var b=_.find(a.gifts,function(b){return b.Id===+a.postData.GiftTypeId});a.postData.GiftTypeId=b.Id,a.postData.GiftTypeName=b.GiftTypeName}if(a.postData.Customer.NoDeadLine?a.postData.Customer.NoDeadLine=1:a.postData.Customer.NoDeadLine=0,a.postData.ServiceStart&&(a.postData.ServiceStart=d("date")(a.postData.ServiceStart,"yyyy-MM")),(1==a.postData.Category||2==a.postData.Status||a.supp)&&!a.postData.Customer.BusnissDeadline&&!a.postData.Customer.NoDeadLine)return alert("请输入完整营业期限！"),void(a.saving=!1);if(2==a.postData.Category&&!a.postData.Customer.PersonCardPath)return alert("请上传法人身份证!"),void(a.saving=!1);a.postData.IsChange&&(a.postData.Customer.AddedValue=2);var e=a.postData,f=a.otherData;if(f.PayId=e.PayId,f.SalesId=e.SalesId,f.SumAccount=a.getAmount(),f.ServiceContent||(f.ServiceContent="记帐报税"),a.postData.StatementInfo=f,a.postData.OrderId)a.supp?c.http.put("/api/supplementaryinfo",a.postData).success(function(a){n(a)}):c.http.put("/api/contract/"+a.postData.OrderId,a.postData).success(function(a){n(a)});else{if(a.isChange)return void c.http.post("/api/signacontract",a.postData).success(function(a){n(a,!0)});c.http.post("/api/contract",a.postData).success(function(a){n(a,!0)})}},a.getPrice=function(){if(a.postData.Customer.AddedValue&&a.postData.PayType){var b={AddedValue:a.postData.Customer.AddedValue,PayType:a.postData.PayType};c.http.get("/api/order/price?"+$.param(b)).success(function(b){a.postData.Amount=b.data})}},a.setChangePrice=function(){var b=a.postData;if(b.ServiceStart&&b.ServiceEnd){var c=new Date(b.ServiceEnd),d=new Date(b.ServiceStart),e=1+(12*(c.getYear()-d.getYear())+c.getMonth()-d.getMonth());b.Amount=+(a.cjPrice*e).toFixed(2)}},a.maxDate=new Date("2029-12-31"),a.setEndDate=function(){if(a.postData.PayType&&a.postData.ServiceStart){if(a.isChange)return void a.setChangePrice();var b={1:5,2:11,3:2,4:5,5:12,6:12},c=b[a.postData.PayType];if(a.postData.GiftTypeId){var e=_.find(a.gifts,function(b){return b.Id===+a.postData.GiftTypeId});c+=e.MonthNum}var f=new Date(a.postData.ServiceStart),g=new Date(f.setMonth(f.getMonth()+c));a.postData.ServiceEnd=d("date")(g,"yyyy-MM")}}}]).controller("Order_cusSelect",["$scope","server","$mdDialog","$mdToast",function(a,b,c,d){function e(){var c=angular.extend({offset:(a.paginator.currentPage-1)*a.paginator.perPage,limit:a.paginator.perPage},a.searchItem);b.http.get("/api/order/customer?"+$.param(c)).success(function(b){a.paginator.total=b.data.total,a.customers=b.data.list})}a.search={CompanyName:""},a.paginator={total:0,currentPage:1,perPage:10,previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.searchParams={limit:10,offset:0,start:"",end:"",status:0,cusname:"",cid:""},a.pageChanged=function(){e()},a.setCurrentPage=function(){a.paginator.currentPage=a.currentPage,e()},a.searchItem={companyname:""},a.search=function(){a.searchItem.companyname=a.search.CompanyName,e()},e(),a.select=function(a){c.hide(a)},a.cancel=function(){c.cancel()}}]),angular.module("crmApp").controller("Dashboard",["$scope","$state","user","menu","server","$filter","$mdDialog","$q",function(a,b,c,d,e,f,g,h){function i(){var b,c=new Date,d=f("date")(c,"yyyy-MM-dd"),g=c.getFullYear(),h=c.getMonth(),i=new Date(g+"-1-1");h>5&&(b=new Date(g+"-7-1"));var j=new Date(g+"-"+(3*Math.floor(h/3)+1)+"-1"),k=new Date;k.setDate(1),e.http.get("/api/allsalestop?startDate="+f("date")(i,"yyyy-MM-dd")+"&endDate="+d).success(function(c){a.year=c.data,b||(a.halfyear=c.data)}),b&&e.http.get("/api/allsalestop?startDate="+f("date")(b,"yyyy-MM-dd")+"&endDate="+d).success(function(b){a.halfyear=b.data}),e.http.get("/api/allsalestop?startDate="+f("date")(j,"yyyy-MM-dd")+"&endDate="+d).success(function(b){a.quarter=b.data}),e.http.get("/api/allsalestop?startDate="+f("date")(k,"yyyy-MM-dd")+"&endDate="+d).success(function(b){a.month=b.data})}a.sections=d.sections,a.user=c.get(),a.rmd={},a.rmd.DQdate=new Date,a.getRemind=function(){e.http.get("/api/nexttrackremind?DQdate="+a.rmd.DQdate.toISOString()).success(function(b){a.reminds=b.data})},a.user.IsCenter?4===a.user.RoleId?b.go("main.site_ps"):e.http.get("/api/subsidiary").success(function(b){a.companies=b.data.list}):(a.timeoption={timezone:"UTC"},a.getRemind(),11!=a.user.RoleId&&7!=a.user.RoleId&&9!=a.user.RoleId||i()),a.showNext=!0,a.open=function(b){var c=angular.copy(b);c.Id=c.CustomerId,g.show({controller:"Customer_view",templateUrl:"views/customer_view.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:c||{},getNextId:a.getNextId}}).then(function(a){refreshData()},function(){})},a.getNextId=function(b){var c=h.defer(),d=_.find(a.reminds,{CustomerId:b.Id}),e=_.indexOf(a.reminds,d)+1;return e<a.reminds.length?c.resolve(a.reminds[e].CustomerId):(alert("没有下一个了。"),c.reject()),c.promise},a.track=function(a){var b=angular.copy(a);b.Id=b.CustomerId,g.show({controller:"Customer_track",templateUrl:"views/customer_track.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:b||{}}}).then(function(a){refreshData()},function(){})},a.forward=function(a){var b=angular.copy(a);b.Id=b.CustomerId,g.show({controller:"Customer_forword",templateUrl:"views/customer_forward.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:b||{}}}).then(function(a){refreshData()},function(){})},a.toPub=function(a){confirm("确认要将客户转入公海吗？")&&e.http.put("/api/custranstoocean?customerId="+a.CustomerId).success(function(a){a.status&&refreshData()})},a.enter=function(a){e.http.put("/api/subsidiary/entrance?SubsidiaryId="+a.SubsidiaryId).success(function(a){e.http.get("/api/users/functionlist").success(function(a){var b,d=[];_.each(a.data,function(a){1==a.FunctionLevel?(d.push(a),a.children=[],b=a):b.children.push(a)}),c.FunctionList=JSON.stringify(d),c.IsCenter=0,c.se=1,c.set(c),location.reload()})})}}]),function(){angular.module("crmApp").controller("Company_sub",["$scope","server","$state","$mdDialog",function(a,b,c,d){function e(){b.http.get("/api/subsidiary").success(function(b){a.companies=b.data.list})}a.title=c.current.title,a.open=function(a){d.show({controller:"Company_view",templateUrl:"views/company_add.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:a||{}}}).then(function(a){e()},function(){})},a["delete"]=function(a){b["delete"](a.CustomerId)},a.track=function(a){var b=$uibModal.open({templateUrl:"views/customer_track.html",controller:"CustomerTrack",size:"lg",resolve:{customer:function(){return a}},backdrop:"static"});b.result.then(function(a){e()},function(){e()})},a.forward=function(a){var b=$uibModal.open({templateUrl:"views/customer_forword.html",controller:"CustomerForward",size:"lg",resolve:{customer:function(){return a}},backdrop:"static"});b.result.then(function(a){e()},function(){})},e()}]).controller("Company_view",["$scope","server","$mdDialog","$mdToast","$http","customer",function(a,b,c,d,e,f){a.postData={},a.title=f.CompanyName||"新增公司",f.SubsidiaryId&&(a.postData=_.extend(a.postData,f)),e.get("/api/city").success(function(b){a.cities=b.data}),a.ok=function(g){f.SubsidiaryId?e.put("/api/subsidiary/"+f.SubsidiaryId,a.postData).success(function(a){a.status&&(d.show(d.simple().textContent("修改成功！").position("top center").hideDelay(2e3)),c.hide())}):(a.postData.PassWord="111111",b.saveCompany(a.postData,0).success(function(e){e&&e.data.errorcode?1==e.data.errorcode?d.show(d.simple().textContent(e.data.name).position("top center").hideDelay(2e3)):confirm('手机号码与"'+e.data.name+'"公司的重复，请确定是否继续提交！')&&b.saveCustomer(a.postData,0).success(function(a){a.status&&c.hide()}):c.hide()}))},a.cancel=function(){c.cancel()}}])}(angular),angular.module("crmApp").controller("Customer_setting",["$scope","server","$timeout",function(a,b,c){function d(a,b){return parseInt(a.Name)<parseInt(b.Name)}a.save=function(){b.http.put("/api/cuscategory",a.settings).success(function(){alert("保存成功！")})},b.getCustomerType().success(function(b){a.settings=b.data.sort(d)})}]),function(){angular.module("crmApp").controller("Customer_signed",["$scope","server","$state","$mdDialog","$q","user",function(a,b,c,d,e,f){function g(){var c=angular.extend({offset:(a.paginator.currentPage-1)*a.paginator.perPage,limit:a.paginator.perPage},a.searchItem,c);b.http.get("/api/customer/bill?"+$.param(c)).success(function(b){a.paginator.total=b.data.total,a.customers=b.data.list})}a.title=c.current.title,a.user=f.get(),a.open=function(b){function c(a){g()}var e;e=b?"views/customer_view.html":"views/customer_addCustomer.html",d.show({controller:"Customer_view",templateUrl:e,clickOutsideToClose:!0,fullscreen:!0,locals:{customer:b||{},getNextId:a.getNextId}}).then(function(a){c(a)},function(){})},a.service=function(b){d.show({controller:"Customer_viewService",templateUrl:"views/customer_viewservice.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:b||{},getNextId:a.getNextId}}).then(function(a){resFn(a)},function(){})},a.getNextId=function(b){var c=e.defer(),d=_.find(a.customers,{Id:b.Id}),f=_.indexOf(a.customers,d)+1;return f<a.customers.length?c.resolve(a.customers[f].Id):(a.paginator.currentPage+=1,g().then(function(a){c.resolve(a)})),c.promise},a.others=function(a){d.show({controller:"Order_statement_add",templateUrl:"views/order_statement_add.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:a}}).then(function(a){},function(){})},a.toOthersAll=function(){var b=_.map(_.filter(a.customers,{selected:!0}),"Id");d.show({controller:"Customer_forword",templateUrl:"views/customer_forward.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:b||[]}}).then(function(a){g()},function(){})},a.closeTool=function(){a.batIsOpen=!1},a.xufei=function(a){b.http.get("/api/orderbycusid?customerid="+a.Id).success(function(a){var b=_.last(a.data);d.show({controller:"Order_remind_order",templateUrl:"views/order_view.html",clickOutsideToClose:!0,fullscreen:!0,locals:{orderid:b.OrderId}}).then(function(a){g()},function(){})})},a.paginator={total:0,currentPage:1,perPage:10,previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.search={companyName:"",phone:""},a.pageChanged=function(){g()},a.setCurrentPage=function(){a.paginator.currentPage=a.currentPage,g()},a.searchItem={companyName:"",Mobile:"",salesId:0},a.search=function(){a.searchItem.companyName=a.search.companyName,a.searchItem.Mobile=a.search.phone,a.searchItem.salesId=a.search.salesId,g(a.searchItem)},b.getSalers().success(function(b){a.users=b.data}),g()}]).controller("Customer_viewService",["$scope","$filter","server","$mdDialog","customer",function(a,b,c,d,e){c.http.get("/api/statementbycusid?customerid="+e.Id).success(function(b){a.statements=b.data}),c.http.get("/api/maintaskbyid?customerid="+e.Id).success(function(b){a.outworkers=b.data}),c.http.get("/api/orderbycusid?customerid="+e.Id).success(function(b){a.orders=b.data}),a.cancel=function(){d.cancel()},a.detail=function(a){function b(a){}d.show({controller:"Order_outworker_detail",templateUrl:"views/order_outworker_detail.html",clickOutsideToClose:!0,fullscreen:!0,skipHide:!0,locals:{taskId:a.Id}}).then(function(a){b(a)},function(){})},a.open=function(a){d.show({controller:"Order_view",templateUrl:"views/order_view.html",clickOutsideToClose:!0,fullscreen:!0,skipHide:!0,locals:{orderid:a.OrderId}}).then(function(a){refreshData()},function(){})},a.openOri=function(a){d.show({controller:"Order_view",templateUrl:"views/order_view.html",clickOutsideToClose:!0,fullscreen:!0,skipHide:!0,locals:{orderid:a}}).then(function(a){refreshData()},function(){})}}])}(angular),angular.module("crmApp").controller("Order_list",["$scope","server","$mdDialog",function(a,b,c){function d(){var c=angular.extend({offset:(a.paginator.currentPage-1)*a.paginator.perPage,limit:a.paginator.perPage},a.searchItem,c);b.http.get("/api/contract?"+$.param(c)).success(function(b){a.paginator.total=b.data.total,a.customers=b.data.list})}a.open=function(a){c.show({controller:"Order_view",templateUrl:"views/order_view.html",clickOutsideToClose:!0,fullscreen:!0,locals:{orderid:a.OrderId}}).then(function(a){d()},function(){})},a.search={companyname:0,starttime:"",endtime:"",PayType:"0",AddedValue:"0"},a["delete"]=function(a){confirm("确认要删除客户吗？")&&b.http["delete"]("/api/contract/"+a.OrderId).success(function(a){a.status&&d()})},a.openOri=function(a){c.show({controller:"Order_view",templateUrl:"views/order_view.html",clickOutsideToClose:!0,fullscreen:!0,locals:{orderid:a}}).then(function(a){d()},function(){})},a.track=function(a){c.show({controller:"Customer_track",templateUrl:"views/customer_track.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:a||{}}}).then(function(a){d()},function(){})},a.forward=function(a){c.show({controller:"Customer_forword",templateUrl:"views/customer_forward.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:a||{}}}).then(function(a){d()},function(){})},a.paginator={total:0,currentPage:1,perPage:10,previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.pageChanged=function(){d()},a.setCurrentPage=function(){a.paginator.currentPage=a.currentPage,d()},a.searchItem={companyname:"",starttime:"",endtime:"",paytype:"0",addedvalue:"0"},a.search=function(){a.searchItem.companyname=a.search.companyName,a.searchItem.starttime=a.search.startdate&&a.search.startdate.toISOString()||"",a.searchItem.endtime=a.search.enddate&&a.search.enddate.toISOString()||"",a.searchItem.paytype=a.search.PayType,a.searchItem.addedvalue=a.search.AddedValue,d(a.searchItem)},d()}]).controller("Order_view",["$scope","$filter","server","$mdDialog","orderid",function(a,b,c,d,e){a.orderid=e,a.cancel=function(){d.cancel()},a.ok=function(){d.hide()}}]),angular.module("crmApp").controller("Order_remind",["$scope","server","$mdDialog",function(a,b,c){function d(){var c=angular.extend({offset:(a.paginator.currentPage-1)*a.paginator.perPage,limit:a.paginator.perPage},a.searchItem,c);b.http.get("/api/signacontract?"+$.param(c)).success(function(b){a.paginator.total=b.data.total,a.customers=b.data.list})}a.open=function(a){c.show({controller:"Order_remind_order",templateUrl:"views/order_view.html",clickOutsideToClose:!0,fullscreen:!0,locals:{orderid:a.OrderId}}).then(function(a){d()},function(){})},a.search={month:1},a.paginator={total:0,currentPage:1,perPage:10,previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.searchParams={limit:10,offset:0,start:"",end:"",status:0,cusname:"",cid:""},a.pageChanged=function(){d()},a.setCurrentPage=function(){a.paginator.currentPage=a.currentPage,d()},a.searchItem={monthcount:1},a.search=function(){a.searchItem.monthcount=a.search.month,d(a.searchItem)},d()}]).controller("Order_remind_order",["$scope","$filter","server","$mdDialog","orderid",function(a,b,c,d,e){a.orderid=e,a.isRemind=!0,a.cancel=function(){d.cancel()},a.ok=function(){d.hide()}}]),angular.module("crmApp").controller("Order_change",["$scope","server","$mdDialog",function(a,b,c){function d(){var c=angular.extend({offset:(a.paginator.currentPage-1)*a.paginator.perPage,limit:a.paginator.perPage},a.searchItem,c);b.http.get("/api/signacontract/my?"+$.param(c)).success(function(b){a.paginator.total=b.data.total,a.customers=b.data.list})}a.open=function(a){c.show({controller:"Order_change_order",templateUrl:"views/order_view.html",clickOutsideToClose:!0,fullscreen:!0,locals:{orderid:a.OrderId}}).then(function(a){d()},function(){})},a.search={companyname:0},a["delete"]=function(a){confirm("确认要删除客户吗？")&&b.http["delete"]("/api/contract/197").success(function(a){a.status&&d()})},a.track=function(a){c.show({controller:"Customer_track",templateUrl:"views/customer_track.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:a||{}}}).then(function(a){d()},function(){})},a.forward=function(a){c.show({controller:"Customer_forword",templateUrl:"views/customer_forward.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:a||{}}}).then(function(a){d()},function(){})},a.paginator={total:0,currentPage:1,perPage:10,previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.searchParams={limit:10,offset:0,start:"",end:"",status:0,cusname:"",cid:""},a.pageChanged=function(){d()},a.setCurrentPage=function(){a.paginator.currentPage=a.currentPage,d()},a.searchItem={cusname:""},a.search=function(){a.searchItem.cusname=a.search.companyName,d(a.searchItem)},d()}]).controller("Order_change_order",["$scope","$filter","server","$mdDialog","orderid",function(a,b,c,d,e){a.orderid=e,a.isChange=!0,a.cancel=function(){d.cancel()},a.ok=function(){d.hide()}}]),angular.module("crmApp").controller("Order_complete",["$scope","server","$mdDialog",function(a,b,c){function d(){var c=angular.extend({offset:(a.paginator.currentPage-1)*a.paginator.perPage,limit:a.paginator.perPage},a.searchItem,c);b.http.get("/api/orderszj/my?"+$.param(c)).success(function(b){a.paginator.total=b.data.total,a.customers=b.data.list})}a.open=function(a){c.show({controller:"Order_supplement",templateUrl:"views/order_view.html",clickOutsideToClose:!0,fullscreen:!0,locals:{orderid:a.OrderId}}).then(function(a){d()},function(){})},a.search={companyname:0},a["delete"]=function(a){confirm("确认要删除客户吗？")&&b.http["delete"]("/api/contract/"+a.OrderId).success(function(a){a.status&&d()})},a.track=function(a){c.show({controller:"Customer_track",templateUrl:"views/customer_track.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:a||{}}}).then(function(a){d()},function(){})},a.forward=function(a){c.show({controller:"Customer_forword",templateUrl:"views/customer_forward.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:a||{}}}).then(function(a){d()},function(){})},a.paginator={total:0,currentPage:1,perPage:10,previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.searchParams={limit:10,offset:0,start:"",end:"",status:0,cusname:"",cid:""},a.pageChanged=function(){d()},a.setCurrentPage=function(){a.paginator.currentPage=a.currentPage,d()},a.searchItem={cusname:""},a.search=function(){a.searchItem.cusname=a.search.companyName,d(a.searchItem)},d()}]).controller("Order_supplement",["$scope","$filter","server","$mdDialog","orderid",function(a,b,c,d,e){a.orderid=e,a.supp=!0,a.cancel=function(){d.cancel()},a.ok=function(){d.hide()}}]),angular.module("crmApp").controller("Order_statement",["$scope","server","$state","$mdDialog",function(a,b,c,d){function e(){var c=angular.extend({offset:(a.paginator.currentPage-1)*a.paginator.perPage,limit:a.paginator.perPage},a.searchItem);b.http.get("/api/statement?"+$.param(c)).success(function(b){a.paginator.total=b.data.total,a.customers=b.data.list})}a.add=function(a){d.show({controller:"Order_statement_add",templateUrl:"views/order_statement_add.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:{}}}).then(function(a){e()},function(){})},a["delete"]=function(a){confirm("确认要删除吗？")&&b.http["delete"]("/api/statement/"+a.Id).success(function(a){a.status&&e()})},a.paginator={total:0,currentPage:1,perPage:10,previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.search={companyName:"",phone:""},a.pageChanged=function(){e()},a.setCurrentPage=function(){a.paginator.currentPage=a.currentPage,e()},a.searchItem={startmonth:"",EndMonth:""},a.search=function(){a.search.start&&(a.searchItem.startmonth=a.search.start.toISOString()),a.search.end&&(a.searchItem.EndMonth=a.search.end.toISOString()),e(a.searchItem)},e()}]).controller("Order_statement_add",["$scope","server","$mdDialog","customer","$uibModal",function(a,b,c,d,e){a.postData={},b.getSalers().success(function(b){a.salers=b.data}),a.customer=d,d.Id&&(a.postData.CustomerId=d.Id,a.postData.CustomerName=d.CompanyName),a.select=function(b){var c=e.open({templateUrl:"views/Order_cusSelect.html",controller:"Order_cusSelect",size:"lg",appendTo:angular.element(".order_statement_add").parent()});c.result.then(function(b){a.postData.CustomerId=b.Id,a.postData.CustomerName=b.CompanyName},function(){})},b.http.get("/api/paymodes").success(function(b){a.paymodes=b.data}),b.getSalers().success(function(b){a.salers=b.data}),a.getAmount=function(){var b=_.pick(a.postData,"ServiceCharge","TaxPayment","AnnualReport","Register","OpenBank","NationLocalTax","Prints","AddressCost","Change"),c=0;return _.each(b,function(a){c+=a||0}),c},a.ok=function(d){a.postData.SumAccount=a.getAmount(),b.http.post("/api/statement",a.postData).success(function(a){a.status&&c.hide()})},a.cancel=function(){c.cancel()}}]),angular.module("crmApp").controller("Order_outworker",["$scope","$http","$state","$uibModal","user","$q",function(a,b,c,d,e,f){function g(){var c;c=a.searchItem;var d=angular.extend({offset:(a.paginator.currentPage-1)*a.paginator.perPage,limit:a.paginator.perPage},c,d);b.get("api/maintask?"+$.param(d)).success(function(b){a.paginator.total=b.data.total,a.customers=b.data.list})}function h(a){var b=[],c={};return _.each(a,function(a){c.CommonTaskId!==a.CommonTaskId?(c=_.pick(a,"CommonTaskName","Status","CommonTaskId","CommonWeight"),c.TaskList=[_.pick(a,"TaskName","OuterTaskId","Weight")],b.push(c)):c.TaskList.push(_.pick(a,"TaskName","OuterTaskId","Weight"))}),b}a.user=e.get(),a.open=function(a){var b=d.open({templateUrl:"views/order_outworker_add.html",controller:"Order_outworker_add",backdrop:"static",size:"hg",resolve:{customer:{}}});b.result.then(function(a){g()},function(){})},a.detail=function(a){var b=d.open({templateUrl:"views/order_outworker_detail.html",controller:"Order_outworker_detail",size:"hg",resolve:{taskId:function(){return a.Id}}});b.result.then(function(a){g()},function(){})},a.taskStatus={1:"待分配",2:"待处理",3:"进行中",4:"已取消",5:"已完成"},2!==a.user.Category&&8!==a.user.Category&&delete a.taskStatus[1],a.search={Id:"",companyname:"",connector:"",taskname:"",childtaskname:"",currOutworker:"",starttime:"",endtime:"",areacode:"",salesId:"0",taskstatus:""},a["delete"]=function(a){confirm("确认要取消任务吗？")&&b.put("api/maintask/cancelstatus/"+a.Id).success(function(a){a.status&&g()})},a.clear=function(){a.dt=null},a.changeDate=function(){var b=angular.element($("#date1"))[0].value,c=angular.element($("#date2"))[0].value;if(c){var d=b.replace(/-/gi,""),e=c.replace(/-/gi,"");0>e-d&&(angular.element($("#date1"))[0].value=c)}a.search.starttime=b,a.search.endtime=c},a.paginator={total:0,currentPage:1,perPage:15,previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.searchItem={Id:"",companyname:"",connector:"",taskname:"",childtaskname:"",outworkId:"0",starttime:"",endtime:"",areacode:"",salesId:"0",taskstatus:""},a.pageChanged=function(){g()},a.setCurrentPage=function(){a.currentPage=Math.abs(Math.floor(a.currentPage))||1,a.paginator.currentPage=a.currentPage,g()},a.clear=function(){a.dt=null},a.popup1={opened:!1},a.popup2={opened:!1},a.open1=function(){a.popup1.opened=!0},a.open2=function(){a.popup2.opened=!0},a.changeDate=function(){var b=angular.element($("#date1"))[0].value,c=angular.element($("#date2"))[0].value;if(c){var d=b.replace(/-/gi,""),e=c.replace(/-/gi,"");0>e-d&&(angular.element($("#date1"))[0].value=c)}a.search.starttime=b,a.search.endtime=c},a.searchFn=function(){a.searchItem.companyname=a.search.companyname,a.searchItem.Id=a.search.Id,a.searchItem.connector=a.search.connector,a.searchItem.taskname=a.search.taskname,a.searchItem.childtaskname=a.search.childtaskname,a.searchItem.starttime=a.search.starttime,a.searchItem.endtime=a.search.endtime,a.searchItem.areacode=a.search.areacode,a.searchItem.salesId=a.search.salesId||0,a.searchItem.outworkId=a.search.currOutworker||0,a.searchItem.taskstatus=a.search.taskstatus,g(a.searchItem)},g(),b.get("/api/contract/sales").success(function(b){a.users=b.data}),b.get("api/outworkers").success(function(b){a.outworkers=b.data.list}),b.get("/api/commontask").success(function(b){a.Tasks=h(b.data)}),a.outTasks=[],b.get("/api/code/area").success(function(b){a.areas=b.data}),b.get("/api/outertasksub?offset=0&limit=9999").success(function(b){a.outTasks=_.filter(b.data.list,{Status:1})})}]).controller("Order_outworker_add",["$scope","$http","$uibModal","$uibModalInstance","customer","user",function(a,b,c,d,e,f){function g(a){var b=[],c={};return _.each(a,function(a){c.CommonTaskId!==a.CommonTaskId?(c=_.pick(a,"CommonTaskName","Status","CommonTaskId","CommonWeight"),c.TaskList=[_.pick(a,"TaskName","OuterTaskId","Weight")],b.push(c)):c.TaskList.push(_.pick(a,"TaskName","OuterTaskId","Weight"))}),b}f.get();b.get("/api/mycity").success(function(b){a.city=b.data[0]}),b.get("/api/commontask").success(function(b){a.tasksArr=g(_.filter(b.data,{Status:1}))}),a.open1=!1,a.open2=!1,a.checkTB=function(b){b.checked&&_.each(a.tasksArr,function(a){b.CommonTaskId!==a.CommonTaskId&&(a.checked=!1)})},a.tbIsDisable=function(){return!!_.chain(a.tasks).pluck("list").flatten().find({selected:!0}).value()},a.otherIsDisable=function(){return!!_.find(a.tasksArr,{checked:!0})},a.areaSele=0,a.postData={},e.Id&&(a.cus_selected=!0,a.postData.Customer=e),a.title="添加外勤任务",a.ok=function(e){function f(b){_.chain(a.tasks).pluck("list").flatten().filter(function(a){var c=_.find(b,{TaskId:a.Id});return c&&(a.selected=c.selected),!!c}).value()}function g(){b.post("/api/maintask",i).success(function(a){a.status&&d.close()})}if(!a.postData.Customer)return void alert("请选择公司！");var h=_.find(a.tasksArr,{checked:!0}),i={CustomerId:a.postData.Customer.Id,AreaCode:a.areaSele,Remark:a.postData.Remark},j=!1;if(h)i.CommonTaskId=h.CommonTaskId,i.ChildTasks=_.map(h.TaskList,function(b){var c=_.chain(a.tasks).pluck("list").flatten().find({Id:b.OuterTaskId}).value(),d=_.pick(c,"TaskName","Price","Weight","Remark");return d.TaskId=b.OuterTaskId,d.Weight=b.Weight,d.CustomerId=i.CustomerId,d}),i.MainTaskName=h.CommonTaskName;else{j=!0;var k=_.chain(a.tasks).pluck("list").flatten().filter({selected:!0}).map(function(a){return a}).value();if(i.ChildTasks=_.map(k,function(a){var b=_.pick(a,"TaskName","Price","Weight","Remark","selected");return b.TaskId=a.Id,b.CustomerId=i.CustomerId,b}),i.MainTaskName="其他",0===i.ChildTasks.length)return void alert("请选择任务！")}if(!a.areaSele)return void alert("请选择区域！");if(j){var l=c.open({templateUrl:"views/outwork_weight_setting.html",controller:"outworkWeightSetting",size:"lg",backdrop:"static",resolve:{tasks:function(){return i.ChildTasks}}});l.result.then(function(a){f(a);var b=_.map(_.filter(a,{selected:!0}),function(a){return a.Weight=a._weight,delete a.selected,a});i.ChildTasks=b,g()},function(a){f(a)})}else g()},b.get("/api/outertasksub?taskname=&BusinessType=&status=0&offset=0&limit=10000").success(function(b){var c=_.map(_.groupBy(_.filter(b.data.list,{Status:1}),"BusinessType"),function(a,b){var c={list:a};return 1==b?c.Name="税务":2==b?c.Name="工商":c.Name="其他",c});a.tasks=c}),b.get("/api/code/area").success(function(b){a.areaArr=b.data}),a.tbIsDisable=function(){return!!_.chain(a.tasks).pluck("list").flatten().find({selected:!0}).value()},a.otherIsDisable=function(){return!!_.find(a.tasksArr,{checked:!0})},a.cancel=function(){d.dismiss()},a.selectCustomer=function(){var b=c.open({templateUrl:"views/Order_cusSelect.html",controller:"Order_cusSelect",size:"lg"});b.result.then(function(b){a.postData.Customer=b,b.AreaCode&&(a.areaSele=b.AreaCode)},function(){})}}]).controller("Order_outworker_detail",["$scope","$http","$uibModalInstance","taskId","$mdDialog","user","$uibModal",function(a,b,c,d,e,f,g){function h(){j++,b.get("/api/maintask/"+d).success(function(b){a.customers=b.data})}function i(){j>0?c.close():c.dismiss()}a.customers=[],a.user=f.get(),a.forwards={forwardUserId:"0",isSelectAll:!1};var j=0;b.get("/api/outworkers").success(function(b){a.outworkers=b.data.list}),a.cancel=function(){if(8!==a.user.Category&&2!==a.user.Category||_.every(a.customers,function(a){return a.Status>1}))i();else if(confirm("还有任务未分配，确认关闭？"))return void i()},a.forward=function(a){e.show({controller:"OutworkForward",templateUrl:"views/customer_forward.html",clickOutsideToClose:!0,fullscreen:!0}).then(function(c){b.put("/api/childtask/trans?ids="+a.Id+"&outworkerId="+c).success(function(a){a.status&&h()})},function(){})},a.forwardAll=function(){var c=_.map(_.filter(a.customers,function(a){return a.Status<=3&&a.selected}),function(a){return a.Id}).join(",");return 0===c.length?(a.forwards.isSelectAll=!1,void(a.forwards.forwardUserId="0")):void b.put("/api/childtask/trans?ids="+c+"&outworkerId="+a.forwards.forwardUserId).success(function(b){b.status&&(h(),a.forwards.isSelectAll=!1,a.forwards.forwardUserId="0")})},a.statusChange=function(a,c,d){confirm("确认要“"+d+"”?")&&b.put("/api/childtask/"+a.Id+"/"+c).success(function(){h()})},a.editCompany=function(a){var c=g.open({templateUrl:"views/companyEdit.html",controller:"CompanyEdit",size:"lg",backdrop:"static",resolve:{companyId:function(){return a.CustomerId}}});c.result.then(function(c){b.put("/api/childtask/trans?ids="+a.Id+"&outworkerId="+c).success(function(a){a.status&&h()})},function(){})},a.selectAll=function(){a.forwards.isSelectAll?_.each(a.customers,function(a){a.Status<=3&&(a.selected=!0)}):_.each(a.customers,function(a){a.selected=!1})},h()}]).controller("Order_cusSelect",["$scope","$http","$uibModalInstance",function(a,b,c){function d(){var c=angular.extend({offset:(a.paginator.currentPage-1)*a.paginator.perPage,limit:a.paginator.perPage},a.searchItem);b.get("/api/order/customer?"+$.param(c)).success(function(b){a.paginator.total=b.data.total,a.customers=b.data.list})}a.search={CompanyName:""},a.paginator={total:0,currentPage:1,perPage:10,previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.searchParams={limit:10,offset:0,start:"",end:"",status:0,cusname:"",cid:""},a.pageChanged=function(){d()},a.setCurrentPage=function(){a.paginator.currentPage=a.currentPage,d()},a.searchItem={companyname:""},a.search=function(){a.searchItem.companyname=a.search.CompanyName,d()},d(),a.select=function(a){c.close(a)},a.cancel=function(){c.dismiss()}}]).controller("CompanyEdit",["$scope","$uibModalInstance","$http","companyId","FileUploader","$filter",function(a,b,c,d,e,f){function g(b,c,d){var e=h(d,b.file.name);b.formData.push({key:e}),_.each(a.signkey,function(a,c){var d={};d[c]=a,b.formData.push(d)}),a["_key"+c]=e}function h(a,b){var c=function(a){var b="",c=a.lastIndexOf(".");return-1!=c&&(b=a.substring(c)),b},d=function(a){a=a||32;for(var b="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",c=b.length,d="",e=0;a>e;e++)d+=b.charAt(Math.floor(Math.random()*c));return d},e=c(b),g={1:"FileUploads/Order/CardID/",2:"FileUploads/Order/BusinessLicense/",3:"FileUploads/Order/Contract/",4:"FileUploads/Agent/"},h=f("date")(new Date,"yyyy-MM"),i=g[a]+h+"/"+d(10)+e;return i}c.get("/api/industry").success(function(b){a.industries=b.data}),c.get("/api/mycity").success(function(b){a.city=b.data[0]}),a.city&&(a.postData.CityCode=a.city.Code),c.get("/api/code/area").success(function(b){a.areas=b.data}),a.postData={},c.get("/api/customerdetail/"+d).success(function(b){var c=b.data;c.BusnissDeadline&&"0001"===c.BusnissDeadline.substr(0,4)?c.BusnissDeadline="":c.BusnissDeadline=new Date(c.BusnissDeadline),c.RegisterDate&&"0001"===c.RegisterDate.substr(0,4)?c.RegisterDate="":c.RegisterDate=new Date(c.RegisterDate),c.AddedValue=""+c.AddedValue,c.IndustryId=""+c.IndustryId,a.postData=c}),a.ok=function(e){var g=a.postData;g.RegisterDate&&(g.RegisterDate=f("date")(a.postData.RegisterDate,"yyyy-MM-dd")),g.NoDeadLine?(g.BusnissDeadline="",g.NoDeadLine=1):g.NoDeadLine=0,c.put("/api/customer/"+d+"?verify=1",a.postData).success(function(a){a.status&&(alert("保存成功!"),b.dismiss("cancel"))})},a.cancel=function(){b.dismiss("cancel")};var i="https://pilipa.oss-cn-beijing.aliyuncs.com";
c.get("/api/signkey").success(function(b){delete b.data.Filename,delete b.data.key,delete b.data.callback,delete b.data.expire,delete b.data.Host,a.signkey=b.data}),a.uploader2=new e({url:i,autoUpload:!0}),a.uploader2.onCompleteItem=function(b,c,d,e){a.postData.BusinessLicense=i+"/"+a._key2},a.uploader2.onBeforeUploadItem=function(a){g(a,2,2)},a.uploader2.onErrorItem=function(){alert("上传失败!")}}]).controller("OutworkForward",["$scope","$mdDialog","$http","user","server",function(a,b,c,d,e){c.get("/api/outworkers").success(function(b){a.salers=b.data.list}),a.label="外勤",a.title="转接任务",a.ok=function(c){return a.saler?void b.hide(a.saler):void alert("请选择外勤人员!")},a.cancel=function(){b.cancel()}}]).controller("outworkWeightSetting",["$scope","$http","$uibModalInstance","tasks",function(a,b,c,d){a.Tasks=d,a.toInt=function(a,b){return Math.floor(Math.abs(a))||""},a["delete"]=function(a){confirm("确认要删除？")&&(a.selected=!1)},a.cancel=function(){c.dismiss(a.Tasks)},a.ok=function(){var b=_.filter(a.Tasks,{selected:!0}),d=_.uniq(b,function(a){return a._weight});d.length<b.length?alert("权重不能重复！"):c.close(a.Tasks)}}]),angular.module("crmApp").controller("Gotaskconfig",["$scope","$http","user","$uibModal",function(a,b,c,d){function e(){b.get("/api/commontask").success(function(b){a.weights=_.uniq(_.pluck(b.data,"CommonWeight")),a.tasksArr=f(b.data)})}function f(a){var b=[],c={};return _.each(a,function(a){c.CommonTaskId!==a.CommonTaskId?(c=_.pick(a,"CommonTaskName","Status","CommonTaskId","CommonWeight"),c.TaskList=[_.pick(a,"TaskName","OuterTaskId","Weight")],b.push(c)):c.TaskList.push(_.pick(a,"TaskName","OuterTaskId","Weight"))}),b}a.user=c.get(),e(),a.add=function(b,c,f){c.stopPropagation(),c.preventDefault();var g=d.open({templateUrl:"views/go_task_config_view.html",controller:"Gotaskconfig_add",size:"lg",resolve:{increased:function(){return{name:f,weights:a.weights,task:b||{}}}}});g.result.then(function(a){e()},function(){})},a.ifuse=function(a,c){a.stopPropagation(),a.preventDefault(),1==c.Status?b.put("/api/commontask/commontaskisstop?isstop=2&id="+c.CommonTaskId).success(function(a){e()}):b.put("/api/commontask/commontaskisstop?isstop=1&id="+c.CommonTaskId).success(function(a){e()})}}]).controller("Gotaskconfig_add",["$scope","$http","$uibModalInstance","$uibModal","increased","user",function(a,b,c,d,e,f){a.cancel=function(){c.dismiss()},a.title=e.name,a.Math=Math,a.task={Id:e.task.CommonTaskId,CommonTaskName:e.task.CommonTaskName,TaskList:e.task.TaskList,Status:e.task.Status,Weight:e.task.CommonWeight};var g=a.task.Weight;b.get("/api/outertasksub?taskname=&BusinessType=&status=0&offset=0&limit=10000").success(function(b){a.Tasks=_.filter(b.data.list,{Status:1}),_.each(e.task.TaskList,function(b){var c=_.find(a.Tasks,{Id:b.OuterTaskId});c&&(c._weight=b.Weight,c.checked=!0)})}),a.checkWeight=function(b){var c=_.filter(a.Tasks,{checked:!0}),d=_.uniq(c,function(a){return a.Weight});d.length<c.length&&alert("请注意，权重不能重复!")},a.ok=function(){var d=a.task,f=_.filter(a.Tasks,{checked:!0});f=_.map(f,function(b){return a.task.Id?{CommonTaskId:d.Id,Weight:b._weight,OuterTaskId:b.Id}:{Weight:b._weight,OuterTaskId:b.Id}}),d.OutWorkerTasks=f,delete d.TaskList;var h=a.task.Weight,i=e.weights;if(h!==g&&i.indexOf(h)>-1)return void alert("通办任务权重不能重复！");var j=_.uniq(f,function(a){return a.Weight});return j.length!=f.length?void alert("子任务权重不能重复！"):void(a.task.Id?b.put("/api/commontask",d).success(function(a){c.close()}):b.post("/api/commontask",d).success(function(a){c.close()}))}}]),angular.module("crmApp").controller("Outwork_dict",["$scope","$http","$state","$uibModal","user",function(a,b,c,d,e){function f(){var c=angular.extend({offset:(a.paginator.currentPage-1)*a.paginator.perPage,limit:a.paginator.perPage},a.searchItem);b.get("/api/outertasksub?"+$.param(c)).success(function(b){a.paginator.total=b.data.total,a.outworkers=b.data.list})}a.user=e.get(),a.searchData={},a.open=function(a){var b=d.open({templateUrl:"views/outwork_dict_view.html",controller:"Outwork_dict_view",resolve:{customer:a||{Price:0}}});b.result.then(function(a){f()},function(){})},a.paginator={total:0,currentPage:1,perPage:15,previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.pageChanged=function(){f()},a.setCurrentPage=function(){a.currentPage=Math.abs(Math.floor(a.currentPage))||1,a.paginator.currentPage=a.currentPage,f()},a.searchItem={TaskName:"",BusinessType:"",Status:"0"},a.search={TaskName:"",BusinessType:"",Status:"0"},a.searchFn=function(){a.searchItem.TaskName=a.search.TaskName,a.searchItem.BusinessType=a.search.BusinessType,a.searchItem.Status=a.search.Status,f()},a["delete"]=function(a){confirm("您确定要删除？")&&b["delete"]("/api/outworkers/"+a.Id).success(function(a){a.status&&f()})},f(),a.stopOrnot=function(a,c){if(confirm("确定更改吗？")){var d;d=1==a?2:1,b.put("/api/outertask/taskisstop?isstop="+d+"&id="+c,{}).success(function(a){f()})}},a.ifuse="启用"}]).controller("Outwork_dict_view",["$scope","$http","$uibModalInstance","customer",function(a,b,c,d){a.postData=_.clone(d)||{},a.postData.ifuse={use:a.postData.Status||1};a.title=a.postData.TaskName||"新增任务",a.checkPrice=function(){a.postData.Price<0?a.postData.Price=0:void 0},a.ok=function(e){var f=angular.copy(a.postData),g={};return f.Price<0?void alert("服务费用不能为负！"):(g.TaskName=f.TaskName?f.TaskName:"",g.BusinessType=f.BusinessType?f.BusinessType:"",g.Price=f.Price?f.Price:0,g.Status=f.ifuse.use,g.Id=d.Id,void(d.Id?(g.CreateBy=d.CreateBy,g.CreateDate=d.CreateDate,b.put("/api/outertask",g).success(function(a){a.status&&(alert("保存成功！"),c.close())})):b.post("/api/outertask",g).success(function(a){a.status&&(alert("保存成功！"),c.close())})))},a.cancel=function(){c.dismiss()}}]),angular.module("crmApp").controller("Statis_cus",["$scope","server","$state","$mdDialog","user",function(a,b,c,d,e){function f(){var c;c=a.user.IsCenter?"/api/customerforcenter":"/api/customerforsubsidiary",b.http.get(c).success(function(b){a.customers=b.data,a.total=_.reduce(a.customers,function(a,b,c){return a.AType+=b.AType,a.BType+=b.BType,a.CType+=b.CType,a.DType+=b.DType,a.EType+=b.EType,a.FType+=b.FType,a.BillType+=b.BillType,a},{AType:0,BType:0,CType:0,DType:0,EType:0,FType:0,BillType:0})})}a.user=e.get(),a.open=function(a,b){d.show({controller:"Statis_cus_detail",templateUrl:"views/statis_cus_detail.html",clickOutsideToClose:!0,fullscreen:!0,locals:{custype:a,userid:b.UserId}}).then(function(a){f()},function(){})},a.chartOptions={},f()}]).controller("Statis_cus_detail",["$scope","server","$mdDialog","custype","userid","$q",function(a,b,c,d,e,f){function g(){var c=angular.extend({offset:(a.paginator.currentPage-1)*a.paginator.perPage,limit:a.paginator.perPage},a.searchItem);b.http.get("/api/customerbycustype?"+$.param(c)).success(function(b){a.paginator.total=b.data.total,a.customers=b.data.list})}a.track=function(b){function d(a){g()}var e="views/customer_view.html";c.show({controller:"Customer_viewpub",templateUrl:e,clickOutsideToClose:!0,fullscreen:!0,skipHide:!0,locals:{customer:b||{},getNextId:a.getNextId}}).then(function(a){d(a)},function(){})},a.getNextId=function(b){var c=f.defer(),d=_.find(a.customers,{Id:b.Id}),e=_.indexOf(a.customers,d)+1;return e<a.customers.length?c.resolve(a.customers[e].Id):(a.paginator.currentPage+=1,g().then(function(a){c.resolve(a)})),c.promise},a.paginator={total:0,currentPage:1,perPage:10,previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.pageChanged=function(){g()},a.setCurrentPage=function(){a.paginator.currentPage=a.currentPage,g()},a.searchItem={custype:d,userid:e},g(),a.cancel=function(){c.cancel()}}]),angular.module("crmApp").controller("Statis_order",["$scope","server","user","$mdDialog","$filter",function(a,b,c,d,e){function f(){var c,d=angular.extend({offset:(a.paginator.currentPage-1)*a.paginator.perPage,limit:a.paginator.perPage},a.searchItem);c=a.user.IsCenter?"/api/orderforcenter?":"/api/orderforsubsidiary?",b.http.get(c+$.param(d)).success(function(b){a.paginator.total=b.data.total,a.customers=b.data.list,a.total=_.reduce(a.customers,function(a,b,c){return _.each(_.keys(b),function(c){"SalesName"!=c&&(a[c]=(a[c]||0)+b[c])}),a},{})})}a.user=c.get(),a.open=function(a){d.show({controller:"Customer_view",templateUrl:"views/customer_addCustomer.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:a||{}}}).then(function(a){f()},function(){})},a.paginator={total:0,currentPage:1,perPage:1e3,previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.pageChanged=function(){f()},a.setCurrentPage=function(){a.paginator.currentPage=a.currentPage,f()},a.searchItem={SalesId:"",startdate:null,enddate:null},a.search={SalesId:0},b.getSalers().success(function(b){a.user.IsGroupLeader?a.salers=_.filter(b.data,{DepartmentId:a.user.DepartmentId}):a.salers=b.data}),a.search=function(){a.searchItem.startdate=e("date")(a.search.startdate,"yyyy-MM-dd"),a.searchItem.enddate=e("date")(a.search.enddate,"yyyy-MM-dd"),a.searchItem.SalesId=a.search.SalesId,f()},f()}]),angular.module("crmApp").controller("User_users",["$scope","server","$state","$mdDialog","user",function(a,b,c,d,e){function f(){var c={SubsidiaryId:a.user.SubsidiaryId,userName:""};b.http.get("/api/users?"+$.param(c)).success(function(b){a.customers=b.data})}a.user=e.get(),a.open=function(a){d.show({controller:"User_view",templateUrl:"views/user_view.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:a||{}}}).then(function(a){f()},function(){})},a["delete"]=function(a){confirm("您确定要删除？")&&b.http["delete"]("/api/user/"+a.UserId).success(function(a){a.status&&f()})},f()}]).controller("User_view",["$scope","server","$mdDialog","$mdToast","customer",function(a,b,c,d,e){a.postData={},b.http.get("/api/roles").success(function(b){a.roles=b.data});var f=[];b.http.get("/api/users/functionlist").success(function(b){function c(a,b){return a.Rank>b.Rank}var d,g=[];_.each(b.data,function(a){var b={};b.name=a.FunctionName,b.Id=a.FunctionId,b.Rank=a.Rank,1==a.FunctionLevel?(d=b,d.children=[],g.push(b)):(d.children.push(b),f.push(b))});var h=[];if(_.each(g.sort(c),function(a){var b=_.pick(a,"name","Id");b.pages=[],_.each(a.children.sort(c),function(a){var c=_.pick(a,"name","Id");b.pages.push(c)}),h.push(b)}),a.functionlist=h,e.UserId){a.postData=_.extend(a.postData,e);var i=JSON.parse(a.postData.FunctionList);a.postData.functions=[],_.each(i,function(b){_.each(b.children,function(b){var c=_.find(f,function(a){return b.FunctionId==a.Id});c&&a.postData.functions.push(c)})})}}),a.changeRole=function(){var b=a.postData.RoleId,c=_.find(a.roles,function(a){return a.RoleId==b});if(c){a.postData.functions=[];var d=c.FunctionList.split(",");a.postData.functions=_.filter(f,function(a){return d.indexOf(a.Id)>=0})}},a.title=e.UserName||"新增用户",a.getSelectedText=function(){return a.postData.functions?a.postData.functions.length>1?a.postData.functions[0].name+" 等"+a.postData.functions.length+"项":a.postData.functions[0].name:""},a.ok=function(f){var g=angular.copy(a.postData);g.FunctionList=_.map(g.functions,function(a){return a.Id});var h=_.chain(g.FunctionList).map(function(a){return a.substr(0,2)}).uniq();g.FunctionList=h.union(g.FunctionList).value().join(","),delete g.functions,e.UserId?b.http.put("/api/user/"+e.UserId,g).success(function(a){a.status&&(d.show(d.simple().textContent("修改成功！").position("top center").hideDelay(2e3)),c.hide())}):b.http.post("/api/user",g).success(function(a){a.status&&c.hide()})},a.cancel=function(){c.cancel()}}]).controller("User_my",["$scope","server","$mdToast",function(a,b,c){a.postData={},b.http.get("/api/user").success(function(b){a.postData=b.data[0]}),a.ok=function(d){var e=angular.copy(a.postData),f=JSON.parse(e.FunctionList),g=[];_.each(f,function(a){g.push(a.FunctionId),_.each(a.children,function(a){g.push(a.FunctionId)})}),e.FunctionList=g.join(","),b.http.put("/api/user/"+e.UserId,e).success(function(a){a.status&&(c.show(c.simple().textContent("修改成功！").position("top center").hideDelay(2e3)),$mdDialog.hide())})},a.psdData={},a.changePsd=function(d){var e=angular.copy(a.psdData);return e.New!=e.New2?void alert("新密码不一致！"):void b.http.put("/api/user/pwd/reset",e).success(function(a){a.status&&(c.show(c.simple().textContent("修改成功！").position("top center").hideDelay(2e3)),$mdDialog.hide())})},a.cancel=function(){$mdDialog.cancel()}}]),angular.module("crmApp").controller("Site_ps",["$scope","server",function(a,b){function c(){var c={limit:a.paginator.perPage,offset:a.paginator.perPage*(a.paginator.currentPage-1),TypeId:a.typeId};b.http.get("/api/website?"+$.param(c)).success(function(b){a.paginator.total=b.data.total,a.data=b.data.list})}a.paginator={total:0,currentPage:1,perPage:10,userName:"",previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.pageChanged=function(){c()},a.setCurrentPage=function(){a.paginator.currentPage=a.currentPage,a.pageChanged()},a.searchParams=_.extend({},a.search),a.searchFn=function(){a.searchParams=_.extend({},a.search),c()},c()}]),angular.module("crmApp").controller("Statis_mate",["$scope","server",function(a,b){function c(c){a.total2=c.Num;var d={sourceid:c.Id,startDate:a.search.start.toISOString(),endDate:a.search.end.toISOString()};b.http.get("/api/customerbysource?"+$.param(d)).success(function(b){var d=b.data[0];a.chart2Options.labels=["签单","A类","B类","C类","D类","E类","F类","公海"],a.chart2Options.data=[d.BillType,d.AType,d.BType,d.CType,d.DType,d.EType,d.FType,d.GType],a.chart2Options.title=c.Marking})}a.search={},a.search.end=new Date,a.search.start=new Date,a.search.start.setMonth(a.search.start.getMonth()-1),a.searchFn=function(){var d={startDate:a.search.start.toISOString(),endDate:a.search.end.toISOString()};b.http.get("/api/reportsource?"+$.param(d)).success(function(b){a.data1=b.data;var d=_.map(b.data,"Marking"),e=_.map(b.data,"Num");a.chart1Options.data=e,a.chart1Options.labels=d,a.total=_.reduce(a.data1,function(a,b,c){return a+b.Num},0),c(b.data[0])})},a.searchFn(),a.chart1Options={labels:[],data:[],options:{legend:{display:!0,position:"bottom"}},onClick:function(b){var d=a.data1[b[0]._index];c(d)}},a.chart2Options={data:[],labels:[],series:"asdf"}}]),angular.module("crmApp").controller("Statis_tend",["$scope","server",function(a,b){function c(c){a.total2=c.Num;var d={salesid:c.SalesId,startDate:a.search.start.toISOString(),endDate:a.search.end.toISOString()};b.http.get("/api/tendencychart?"+$.param(d)).success(function(b){b.data[0];a.chart2Options.labels=_.map(b.data,"OrderDate"),a.chart2Options.data=[_.map(b.data,"OrderNum")],a.chart2Options.title=c.RealName})}a.search={},a.search.end=new Date,a.search.start=new Date,a.search.start.setMonth(a.search.start.getMonth()-1),a.searchFn=function(){var d={startDate:a.search.start.toISOString(),endDate:a.search.end.toISOString()};b.http.get("/api/salesordertop?"+$.param(d)).success(function(b){a.data1=b.data;var d=_.map(b.data,"RealName"),e=_.map(b.data,"Num");a.chart1Options.data=e,a.chart1Options.labels=d,a.total=_.reduce(a.data1,function(a,b,c){return a+b.Num},0),c(b.data[0])})},a.searchFn(),a.chart1Options={labels:[],data:[],options:{legend:{display:!0,position:"bottom"}},onClick:function(b){if(b[0]._index){var d=a.data1[b[0]._index];c(d)}}},a.chart2Options={data:[],labels:[],series:["签单数量"]}}]),angular.module("crmApp").controller("Statis_top",["$scope","server","$state","$mdDialog","user",function(a,b,c,d,e){function f(){b.http.get("/api/customerforsubsidiary").success(function(b){var c=_.uniq(_.map(b.data,"CompanyName")),d=a.typeCList=[],e=a.typeBList=[];_.each(c,function(a){var c=_.chain(b.data).filter({CompanyName:a}),f={CompanyName:a,salers:c.map(function(a){return{RealName:a.RealName,Num:a.CType}}).sortByOrder(["Num"],["desc"]).value(),total:c.reduce(function(a,b){return _.isObject(a)?a.CType+b.CType:a+b.CType}).value()};_.isObject(f.total)&&(f.total=f.total.CType),d.push(f);var g={CompanyName:a,salers:c.map(function(a){return{RealName:a.RealName,Num:a.BType}}).sortByOrder(["Num"],["desc"]).value(),total:c.reduce(function(a,b){return _.isObject(a)?a.BType+b.BType:a+b.BType}).value()};_.isObject(g.total)&&(g.total=g.total.BType),e.push(g)})}),b.http.get("/api/currentmonthorder").success(function(b){var c=_.uniq(_.map(b.data,"CompanyName")),d=a.typeSList=[];_.each(c,function(a){var c=_.chain(b.data).filter({CompanyName:a}),e={CompanyName:a,salers:c.map(function(a){return{RealName:a.RealName,Num:a.OrderNum}}).sortByOrder(["Num"],["desc"]).value(),total:c.reduce(function(a,b){return _.isObject(a)?a.OrderNum+b.OrderNum:a+b.OrderNum}).value()};_.isObject(e.total)&&(e.total=e.total.OrderNum),_.sortByOrder(e.salers,["Num"],["desc"]),d.push(e)})}),b.http.get("/api/cusnumbygroup").success(function(c){var d=a.companies=[],e=_.uniq(_.map(c.data,"SubsidiaryName"));_.each(e,function(a){var b=_.chain(c.data).filter({SubsidiaryName:a}),e={at:0,bt:0,ct:0,st:0};_.each(b.value(),function(a){e.bt+=a.BType,e.ct+=a.CType,e.at+=a.AType});var f={CompanyName:a,CList:b.map(function(a){return{DepartmentName:a.DepartmentName,Num:a.CType}}).sortByOrder(["Num"],["desc"]).value(),BList:b.map(function(a){return{DepartmentName:a.DepartmentName,Num:a.BType}}).sortByOrder(["Num"],["desc"]).value(),AList:b.map(function(a){return{DepartmentName:a.DepartmentName,Num:a.AType}}).sortByOrder(["Num"],["desc"]).value(),total:e};d.push(f)}),b.http.get("/api/currmonthbygroup").success(function(a){var b=_.uniq(_.map(a.data,"SubsidiaryName"));_.each(b,function(b){var c=_.chain(a.data).filter({SubsidiaryName:b}),e=_.find(d,{CompanyName:b});e||(e={CompanyName:b,CList:[],BList:[],AList:[],total:{at:0,bt:0,ct:0,st:0}}),e.SList=c.map(function(a){return{DepartmentName:a.DepartmentName,Num:a.OrderNum}}).sortByOrder(["Num"],["desc"]).value(),_.each(c.value(),function(a){e.total.st+=a.OrderNum})})})})}a.user=e.get(),a.chartOptions={},f()}]),angular.module("crmApp").controller("Statis_today",["$scope","server","$state","$mdDialog","user",function(a,b,c,d,e){function f(){var c=angular.extend({offset:(a.paginator.currentPage-1)*a.paginator.perPage,limit:a.paginator.perPage},a.searchItem);b.http.get("/api/newcustomer?"+$.param(c)).success(function(b){a.paginator.total=b.data.total,a.customers=b.data.list})}a.paginator={total:0,currentPage:1,perPage:10,previousText:"上一页",nextText:"下一页",lastText:"最后一页",firstText:"首页"},a.searchItem={DepartmentId:0},a.pageChanged=function(){f()},a.setCurrentPage=function(){a.paginator.currentPage=a.currentPage,f()},a.search={DepartmentId:0},a.searchFn=function(){a.searchItem.DepartmentId=a.search.DepartmentId,f(a.searchItem)},f(),b.http.get("/api/departments").success(function(b){a.groups=b.data})}]),angular.module("crmApp").controller("Statis_signed",["$scope","server",function(a,b){function c(c){a.total2=c.Num;var d={sourceid:c.Id,startDate:a.search.start.toISOString(),endDate:a.search.end.toISOString()};b.http.get("/api/customerbysource?"+$.param(d)).success(function(b){var d=b.data[0];a.chart2Options.labels=["签单","A类","B类","C类","D类","E类","F类","公海"],a.chart2Options.data=[d.BillType,d.AType,d.BType,d.CType,d.DType,d.EType,d.FType,d.GType],a.chart2Options.title=c.Marking})}a.search={},a.search.end=new Date,a.search.start=new Date,a.search.start.setMonth(a.search.start.getMonth()-1),a.searchFn=function(){var c={starttime:a.search.start.toISOString(),endtime:a.search.end.toISOString()};b.http.get("/api/customernumbytag?"+$.param(c)).success(function(b){a.data1=b.data;var c=_.map(b.data,"TagName"),d=_.map(b.data,"CusNum");a.chart1Options.data=d,a.chart1Options.labels=c,a.total=_.reduce(a.data1,function(a,b,c){return a+b.CusNum},0)}),b.http.get("/api/customernumbysource?"+$.param(c)).success(function(b){var c=_.map(b.data,"Marking"),d=_.map(b.data,"CusNum");a.chart2Options.data=d,a.chart2Options.labels=c,a.total2=_.reduce(b.data,function(a,b,c){return a+b.CusNum},0)})},a.searchFn(),a.chart1Options={labels:[],data:[],options:{legend:{display:!0,position:"bottom"}},onClick:function(b){var d=a.data1[b[0]._index];c(d)}},a.chart2Options={data:[],labels:[],series:""}}]),angular.module("crmApp").controller("User_group",["$scope","server","$state","$mdDialog","user","$mdToast",function(a,b,c,d,e,f){function g(c){b.http.get("/api/groups?groupId="+c.DepartmentId).success(function(b){a.members=b.data})}function h(){b.http.get("/api/departments").success(function(b){a.groups=b.data,a.active(a.groups[0])})}a.user=e.get(),a.add=function(){d.show({controller:"User_group_addGroup",templateUrl:"views/user_group_addgroup.html",clickOutsideToClose:!0,fullscreen:!0}).then(function(a){h()},function(){})},a["delete"]=function(a){confirm("确定要删除？")&&b.http["delete"]("/api/departments/"+a).success(function(a){h()})},a.active=function(b){var c=_.find(a.groups,{active:!0});c&&(c.active=!1),b.active=!0,a.seletedDept=b,g(b)},a.addMember=function(b){d.show({controller:"User_group_addMember",templateUrl:"views/user_group_addMember.html",clickOutsideToClose:!0,fullscreen:!0,locals:{members:a.members,dptId:a.seletedDept.DepartmentId}}).then(function(b){g(a.seletedDept)},function(){})},a.deleteMember=function(c){confirm("确定要移除成员？")&&b.http.put("/api/delgroup?userid="+c.UserId).success(function(){g(a.seletedDept)})},a.setLeader=function(c){b.http.put("/api/groupleaders?userid="+c.UserId+"&departmentid="+a.seletedDept.DepartmentId).success(function(b){g(a.seletedDept)})},h()}]).controller("User_group_addGroup",["$scope","server","$mdDialog",function(a,b,c){a.ok=function(d){var e={DepartmentName:a.name,ParentID:0};b.http.post("/api/departments",e).success(function(a){c.hide()})},a.cancel=function(){c.cancel()}}]).controller("User_group_addMember",["$scope","server","user","$mdDialog","members","dptId",function(a,b,c,d,e,f){function g(){var c={SubsidiaryId:a.user.SubsidiaryId,userName:""};b.http.get("/api/users?"+$.param(c)).success(function(b){_.each(b.data,function(a){_.find(e,{UserId:a.UserId})&&(a.hide=!0)}),a.users=b.data})}a.user=c.get(),g(),a.ok=function(c){b.http.post("/api/addgroups?departmentid="+f,a.selecteds).success(function(a){d.hide()})},a.cancel=function(){d.cancel()}}]),angular.module("crmApp").controller("User_outworker",["$scope","server","$state","$mdDialog","user",function(a,b,c,d,e){function f(){b.http.get("/api/outworkers").success(function(b){a.outworkers=b.data.list})}a.user=e.get(),a.open=function(a){d.show({controller:"User_outwroker_view",templateUrl:"views/user_outworker_view.html",clickOutsideToClose:!0,fullscreen:!0,locals:{customer:a||{}}}).then(function(a){f()},function(){})},a["delete"]=function(a){confirm("您确定要删除？")&&b.http["delete"]("/api/outworkers/"+a.Id).success(function(a){a.status&&f()})},f()}]).controller("User_outwroker_view",["$scope","server","$mdDialog","$mdToast","customer",function(a,b,c,d,e){a.postData=e||{};a.title=e.Name||"新增外勤",a.ok=function(f){var g=angular.copy(a.postData);e.Id?b.http.put("/api/outworkers/"+e.Id,g).success(function(a){a.status&&(d.show(d.simple().textContent("修改成功！").position("top center").hideDelay(2e3)),c.hide())}):b.http.post("/api/outworkers",g).success(function(a){a.status&&c.hide()})},a.cancel=function(){c.cancel()}}]),angular.module("crmApp").run(["$templateCache",function(a){a.put("views/Order_cusSelect.html",'<div class="modal-header"> <span class="close" ng-click="cancel()">&times;</span> <h3 class="modal-title">选择客户</h3> </div> <div class="modal-body"> <form class="form-inline"> <div class="form-group"> <label>公司名称/法人</label>： <input flex ng-model="search.CompanyName" class="form-control"> </div> <button class="btn btn-primary" type="button" ng-disabled="cusform.$invalid" ng-click="search()">查询</button> </form> <table class="table table-striped table-hover table-bordered" style="margin: 12px 0"> <thead> <tr class="info"> <th>公司名称</th> <th>联系人</th> <th>联系人电话</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td><a href="javascript:;" ng-click="select(customer)">{{::customer.Name ||customer.CompanyName}}</a></td> <td><a href="javascript:;" ng-click="select(customer)">{{::customer.Contacts|| customer.Connector}}</a></td> <td>{{::customer.Mobile}}</td> </tr> </tbody> </table> <div class="u-paginator"> <uib-pagination total-items="paginator.total" items-per-page="paginator.perPage" boundary-links="true" ng-model="paginator.currentPage" previous-text="{{::paginator.previousText}}" next-text="{{::paginator.nextText}}" first-text="{{::paginator.firstText}}" last-text="{{::paginator.lastText}}" force-ellipses="true" max-size="6" num-pages="paginator.numPages" ng-change="pageChanged()"> </uib-pagination> <div class="u-pages"> <span>{{paginator.currentPage}}</span> / <span>{{paginator.numPages}}</span> <span>合计:{{paginator.total}}</span> </div> <form name="paginatorForm" novalidate> <div class="input-group"> <input type="number" name="paginatorInput" ng-model="currentPage" required min="1" max="{{paginator.numPages}}" class="form-control"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-disabled="!paginatorForm.$valid" ng-click="setCurrentPage()">Go!</button> </span> </div> </form> </div> </div> <div class="modal-footer"> <button class="btn btn-warning" type="button" ng-click="cancel()">关闭</button> </div>'),a.put("views/common_loading.html",'<md-dialog aria-label="客户转出" class="md-dialog-md"> <md-dialog-content ng-cloak class="clearfix md-whiteframe-glow-z1 md-padding" style="overflow: hidden"> <div class="text-center">{{loadingText}}</div> <md-progress-linear md-mode="indeterminate"></md-progress-linear> </md-dialog-content> </md-dialog>'),a.put("views/companyEdit.html",'<div class="modal-header"> <span class="close" ng-click="cancel()">&times;</span> <h3 class="modal-title">公司信息修改</h3> </div> <div class="modal-body"> <table class="table table-bordered"> <tbody> <tr> <th colspan="4" style="text-align:left"> <span class="t_header">客户基本信息</span> </th> </tr> <tr> <td class="">公司名称</td> <td> <input type="text" ng-model="postData.CompanyName"> </td> <td class="">城市</td> <td> <span>{{city.Name}}</span> </td> </tr> <tr> <td>区域</td> <td> <select ng-model="postData.AreaCode" ng-disabled="isReadOnly"> <option ng-repeat="item in areas" value="{{item.AreaCode}}" ng-bind="item.AreaName"></option> </select> </td> <td class="">公司地址</td> <td> <input type="text" ng-model="postData.Address" ng-if="!isReadOnly" maxlength="100"> </td> </tr> <tr> <td class="">公司性质</td> <td> <select ng-model="postData.AddedValue" ng-disabled="isReadOnly"> <option value="1">小规模</option> <option value="2">一般纳税人</option> </select> </td> <td class="">所属行业</td> <td> <select ng-model="postData.IndustryId" ng-disabled="isReadOnly"> <option ng-repeat="item in industries" value="{{item.IndustryId}}" ng-bind="item.IndustryName"></option> </select> </td> </tr> <tr> <td class="">联系人</td> <td> <input type="text" ng-model="postData.Connector" ng-if="!isReadOnly" maxlength="10"> </td> <td class="">手机</td> <td> <input type="text" ng-model="postData.Mobile" ng-if="!isReadOnly" maxlength="11"> </td> </tr> </tbody> </table> <table class="table table-bordered"> <thead> <th colspan="4" style="text-align:left"> <span class="t_header">营业执照信息</span> </th> </thead> <tbody> <tr> <td class="">注册号</td> <td> <input type="text" ng-model="postData.RegNO" ng-if="!isReadOnly" maxlength="20"> </td> <td class="">法人</td> <td> <input type="text" ng-model="postData.LegalPerson" ng-if="!isReadOnly" maxlength="10"> </td> </tr> <tr> <td class="">国税登记号</td> <td> <input type="text" ng-model="postData.NationalTaxNO" ng-if="!isReadOnly" maxlength="20"> </td> <td class="">地税登记号</td> <td> <input type="text" ng-model="postData.LocalTaxNO" ng-if="!isReadOnly" maxlength="20"> </td> </tr> <tr> <td class="">营业期限</td> <td> <span class="date_sel"> <input type="text" uib-datepicker-popup ng-model="postData.RegisterDate" is-open="dateIsOpened11" datepicker-options="dateOptions" close-text="关闭" current-text="今天" clear-text="清空" ng-click="dateIsOpened11 = !dateIsOpened11" ng-disabled="isReadOnly"> <button type="button" ng-click="dateIsOpened11 = !dateIsOpened11" ng-show="!isReadOnly"><i class="glyphicon glyphicon-calendar"></i></button> </span>- <span class="date_sel"> <input type="text" uib-datepicker-popup ng-model="postData.BusnissDeadline" is-open="dateIsOpened1" datepicker-options="dateOptions" close-text="关闭" current-text="今天" clear-text="清空" ng-click="dateIsOpened1 = !dateIsOpened1" ng-disabled="isReadOnly || postData.NoDeadLine"> <button type="button" ng-click="dateIsOpened1 = !dateIsOpened1" ng-show="!isReadOnly"><i class="glyphicon glyphicon-calendar"></i></button> </span> <input type="checkbox" name="noLimitDate" value="1" ng-click="postData.NoDeadLine = !postData.NoDeadLine; " ng-checked="postData.NoDeadLine == 1"> 无期限  </td> <td class="">注册资金</td> <td> <input type="text" ng-model="postData.RegisteredCapital" ng-if="!isReadOnly" maxlength="15"> </td> </tr> <tr> <td class="">经营范围</td> <td> <textarea ng-model="postData.BusinessScope" ng-if="!isReadOnly" style="width:80%" rows="5"></textarea> </td> <td class="">上传营业执照</td> <td> <img ng-src="{{postData.BusinessLicense}}" ng-if="postData.BusinessLicense" class="order-img" alt="" pic-view> <input type="file" nv-file-select="" uploader="uploader2" ng-show="!isReadOnly"> <div class="progress" style="width:80%;margin-left:90px" ng-if="uploader2.isUploading"> <div class="progress-bar" role="progressbar" ng-style="{ \'width\': uploader2.progress + \'%\' }" style="width: 100%"></div> </div> <span>上传的图片大小请不要超过1M。</span> </td> </tr> </tbody> </table> </div> <div class="modal-footer"> <button class="btn btn-primary" type="button" ng-click="ok()">保存</button> <button class="btn btn-warning" type="button" ng-click="cancel()">关闭</button> </div>'),a.put("views/company_add.html",'<md-dialog aria-label="公司" class="md-dialog-lg"> <form name="cusform" novalidate> <md-toolbar> <div class="md-toolbar-tools"> <h2>{{::title}}</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <md-dialog-content ng-cloak class="clearfix md-whiteframe-glow-z1 md-padding" style="overflow: hidden"> <md-grid-list md-cols="2" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">公司名称</span> <input flex ng-model="postData.CompanyName" aria-label="CompanyName"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">城市</span> <md-select md-no-asterisk ng-model="postData.CityCode" class="md-select" required> <md-option ng-repeat="u in cities" ng-value="u.Code">{{u.Name}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">地址</span> <input required flex ng-model="postData.Address" aria-label="Address"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">总经理账号</span> <input required flex ng-model="postData.UserName"> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="user.RoleId<11"> <md-input-container layout="row"> <span class="md-label">来源</span> <md-select md-no-asterisk ng-model="postData.CustomerSourceId" class="md-select"> <md-option ng-value="0" ng-selected="true">全部</md-option> <md-option ng-repeat="u in sourceTypes" ng-value="u.Id">{{u.Marking}}</md-option> </md-select> </md-input-container> </md-grid-tile> </md-grid-list> </md-dialog-content> <md-dialog-actions layout="row" md-colors="::{background: \'default-primary-100\'}"> <span flex></span> <md-button class="md-raised md-primary" ng-disabled="cusform.$invalid" ng-click="ok($event)">保存</md-button> <md-button ng-click="cancel()">取消</md-button> </md-dialog-actions> </form> </md-dialog>'),a.put("views/company_sublist.html",'<md-button class="md-raised md-primary" ng-click="open()">新增公司</md-button> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>公司名称</th> <th>地址</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="item in companies"> <td><a href="javascript:;" ng-click="open(customer)">{{::item.CompanyName}}</a></td> <td>{{::item.Address}}</td> <td class="table-opt"><a href="javascript:;" ng-click="open(item)">查看</a> </td> </tr> </tbody> </table>'),
a.put("views/customer_addCustomer.html",'<md-dialog aria-label="客户" class="md-dialog-lg"> <form name="cusform" novalidate> <md-toolbar> <div class="md-toolbar-tools"> <h2>{{::title}}</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <md-dialog-content ng-cloak class="clearfix md-whiteframe-glow-z1 md-padding cus-info"> <md-grid-list md-cols="2" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">公司名称</span> <input flex ng-model="postData.CompanyName" aria-label="CompanyName"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">联系人</span> <input required flex ng-model="postData.Connector" aria-label="Connector"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">联系电话</span> <input required flex ng-model="postData.Mobile" aria-label="Mobile"> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="!isPub"> <md-input-container layout="row"> <span class="md-label md-required">意向度</span> <md-select md-no-asterisk ng-model="postData.CustomerTypeId" required aria-label="CustomerType" class="md-select"> <md-option ng-repeat="type in ctypes" ng-repeat="" ng-value="type.CustomerTypeId">{{type.Name}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">来源</span> <md-select md-no-asterisk ng-model="postData.CustomerSourceId" class="md-select"> <md-option ng-value="0" ng-selected="true">全部</md-option> <md-option ng-repeat="u in sourceTypes" ng-value="u.Id">{{u.Marking}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile md-colspan="2" md-rowspan="2"> <md-input-container layout="row"> <span class="md-label md-required">备注</span> <textarea flex ng-model="postData.Mark" maxlength="200"></textarea> </md-input-container> </md-grid-tile> </md-grid-list> <md-chips ng-model="custags" readonly md-removable="postData.CustomerTypeId != 5" md-on-remove="deleteTag($chip)"> <md-chip-template> <span>{{$chip.TagName}}</span> </md-chip-template> <span md-chip-remove>&times;</span> </md-chips> <div ng-if="postData.Id && postData.CustomerTypeId != 5"> <md-button class="md-primary" ng-disabled="cusform.$invalid" ng-click="isOpen = !isOpen">打标签 <i class="fa" ng-class="{\\\'fa-angle-double-down\\\': !isOpen,\\\'fa-angle-double-up\\\': !!isOpen}"></i></md-button> <div ng-show="isOpen"> <div ng-repeat="(key, tagGroup) in tags" class="tag-row"> <span class="pull-left tag-type">{{key}}</span> <md-chips ng-model="tagGroup.tags" readonly md-removable="false" md-can-click="true" md-selected="tagGroup.selected" md-on-select="addTag($chip,null,$index)"> <md-chip-template> <span>{{$chip.TagName}}</span> </md-chip-template> </md-chips> </div> </div> </div> </md-dialog-content> <md-dialog-actions layout="row" md-colors="::{background: \'default-primary-100\'}"> <span flex></span> <md-button class="md-raised md-primary" ng-disabled="cusform.$invalid" ng-click="ok($event)">保存</md-button> <md-button class="md-raised md-primary" ng-if="showNext" ng-click="next(postData)">下一条</md-button> <md-button ng-click="cancel()">取消</md-button> </md-dialog-actions> </form> </md-dialog>'),a.put("views/customer_forward.html",'<md-dialog aria-label="{{title||\'客户转出\'}}" class="md-dialog-md"> <form name="cusform" novalidate> <md-toolbar> <div class="md-toolbar-tools"> <h2>客户转出</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <md-dialog-content ng-cloak class="clearfix md-whiteframe-glow-z1 md-padding" style="overflow: hidden"> <md-input-container layout="row"> <span class="md-label md-required">{{::label||\'销售\'}}</span> <md-select md-no-asterisk ng-model="saler" required aria-label="saler" class="md-select"> <md-option ng-repeat="item in salers" ng-repeat="" ng-value="item.UserId">{{item.RealName}}</md-option> </md-select> </md-input-container> </md-dialog-content> <md-dialog-actions layout="row" md-colors="::{background: \'default-primary-100\'}"> <span flex></span> <md-button class="md-raised md-primary" ng-disabled="cusform.$invalid" ng-click="ok($event)">保存</md-button> <md-button ng-click="cancel()">取消</md-button> </md-dialog-actions> </form> </md-dialog>'),a.put("views/customer_my.html",'<div class="o-search well well-sm"> <form class="form-inline"> <md-grid-list md-cols="3" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">公司名称</span> <input flex ng-model="search.companyName" aria-label="CompanyName"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">联系电话</span> <input flex ng-model="search.phone" aria-label="Mobile"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">意向度</span> <md-select md-no-asterisk ng-model="search.cusType" aria-label="CustomerType" class="md-select"> <md-option ng-value="0" ng-selected="true">全部</md-option> <md-option ng-repeat="type in ctypes" ng-repeat="" ng-value="type.CustomerTypeId">{{type.Name}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">标签</span> <md-select md-no-asterisk ng-model="search.tagId" style="width:200px" aria-label="CustomerType" class="md-select" multiple ng-change="checkBQ()"> <md-option ng-value="0" ng-selected="true" ng-click="search.tagId = 0">全部</md-option> <md-optgroup ng-repeat="(key,list) in tagGroup" label="{{key}}"> <md-option ng-repeat="tag in list" ng-value="tag" ng-click="tagSelect(tag)">{{tag.TagName}}</md-option> </md-optgroup> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">来源</span> <md-select md-no-asterisk ng-model="search.CustomerSourceId" class="md-select"> <md-option ng-value="0" ng-selected="true">全部</md-option> <md-option ng-repeat="u in sourceTypes" ng-value="u.Id">{{u.Marking}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">首次跟踪</span> <md-datepicker ng-model="search.firsttracktime" md-open-on-focus="true"></md-datepicker> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">最后跟踪</span> <md-datepicker ng-model="search.lasttracktime" md-open-on-focus="true"></md-datepicker> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="user.RoleId<11"> <md-input-container layout="row"> <span class="md-label">分组</span> <md-select md-no-asterisk ng-model="search.DepartmentId" class="md-select" ng-change="verifyGroup()"> <md-option ng-value="0" ng-selected="true">全部</md-option> <md-option ng-repeat="g in groups" ng-value="g.DepartmentId">{{g.DepartmentName}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="user.RoleId<11"> <md-input-container layout="row"> <span class="md-label">销售</span> <md-select md-no-asterisk ng-model="search.userid" class="md-select"> <md-option ng-value="0" ng-selected="true">全部</md-option> <md-option ng-repeat="u in users|groupMember:search.DepartmentId" ng-value="u.UserId">{{u.RealName}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile md-colspan="3"> <div class="text-center"> <md-input-container> <md-button class="md-raised md-primary" ng-click="searchFn()">查询</md-button> <md-button class="md-raised md-primary" ng-click="open()">新增客户</md-button> <!-- <div uib-dropdown style="display: inline-block;">\r\n                            <md-button class="md-raised md-primary" uib-dropdown-toggle>批量获取</md-button>\r\n                            <md-list class="dropdown-menu" uib-dropdown-menu role="menu" style="right: 0;left: auto;width: 140px; min-width: 140px">\r\n                                <md-subheader class="md-no-sticky">客户来源:</md-subheader>\r\n                                <md-list-item ng-repeat="st in sourceTypes" ng-click="getFromPub(st.Id,$event)">{{::st.Marking}}</md-list-item>\r\n                                <md-divider></md-divider>\r\n                        </div> --> </md-input-container> <div uib-dropdown is-open="status.isopen" style="display: inline-block"> <md-button class="md-raised md-primary" uib-dropdown-toggle>批量导入</md-button> <md-list class="dropdown-menu" uib-dropdown-menu role="menu" style="right: 0;left: auto;width: 140px; min-width: 140px"> <md-subheader class="md-no-sticky">客户来源:</md-subheader> <md-list-item ng-repeat="st in sourceTypes" ng-click="upFile(st.Id,$event)">{{::st.Marking}}</md-list-item> <md-divider></md-divider> <input type="file" nv-file-select="" uploader="uploader2" style="opacity: 0"> </md-list> </div> </div> </md-grid-tile> </md-grid-list> </form> </div> <md-fab-toolbar md-open="batIsOpen" count="100" md-auto-close="false" md-direction="\'right\'"> <md-fab-trigger class="align-with-text"> <md-button class="md-fab md-primary"> <i class="fa fa-bars" aria-hidden="true"></i> </md-button> </md-fab-trigger> <md-toolbar> <md-fab-actions class="md-toolbar-tools"> <md-button class="md-button" ng-click="selectAll()">全选</md-button> <md-button class="md-button" ng-click="clear()">清空</md-button> <md-button class="md-button" ng-click="toPubAll()"><i class="fa fa-share" aria-hidden="true"></i>批量转入公海</md-button> <md-button ng-if="user.RoleId<11" class="md-button" ng-click="toOthersAll()"><i class="fa fa-share" aria-hidden="true"></i>批量转其他人</md-button> <md-button class="md-button" ng-click="closeTool()">关闭</md-button> </md-fab-actions> </md-toolbar> </md-fab-toolbar> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th style="width: 40px" ng-show="batIsOpen"></th> <th>公司名称</th> <th>联系人</th> <th>联系人电话</th> <th>意向度</th> <th>首次跟踪时间</th> <th>最后跟踪时间</th> <th>来源</th> <th>销售</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td ng-show="batIsOpen"> <md-checkbox ng-model="customer.selected" ng-true-value="true" ng-false-value="false" class="md-primary md-align-top-left" flex> </md-checkbox> </td> <td><a href="javascript:;" ng-click="open(customer)">{{customer.CompanyName}}</a></td> <td>{{customer.Connector}}</td> <td>{{customer.Mobile}}</td> <td>{{customer.CustomerTypeName}}</td> <td>{{customer.FirstTrackTime|tDate}}</td> <td>{{customer.LastTrackTime|tDate}}</td> <td>{{customer.Marking}}</td> <td>{{::customer.SaleName}}</td> <td class="table-opt"><a href="javascript:;" ng-click="open(customer)">查看</a> <a href="javascript:;" ng-if="user.RoleId<10" ng-click="forward(customer)">客户转出</a> <a href="javascript:;" ng-click="toPub(customer)">转到公海</a> <!--                 <a href="javascript:;" ng-click="delete(customer)">删除</a> --></td> </tr> </tbody> </table> <div class="u-paginator"> <uib-pagination total-items="paginator.total" items-per-page="paginator.perPage" boundary-links="true" ng-model="paginator.currentPage" previous-text="{{::paginator.previousText}}" next-text="{{::paginator.nextText}}" first-text="{{::paginator.firstText}}" last-text="{{::paginator.lastText}}" force-ellipses="true" max-size="6" num-pages="paginator.numPages" ng-change="pageChanged()"> </uib-pagination> <div class="u-pages"> <span>{{paginator.currentPage}}</span> / <span>{{paginator.numPages}}</span> &nbsp; <span>合计:{{paginator.total}}</span> </div> <form name="paginatorForm" novalidate> <div class="input-group"> <input type="number" name="paginatorInput" ng-model="currentPage" required min="1" max="{{paginator.numPages}}" class="form-control"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-disabled="!paginatorForm.$valid" ng-click="setCurrentPage()">Go!</button> </span> </div> </form> <input type="number" ng-model="paginator.perPage" required min="1" class="form-control" ng-blur="setCurrentPage();" style="width:70px"> <span class="u-pages"> /页 </span> </div>'),a.put("views/customer_pub.html",'<div class="o-search well well-sm"> <form class="form-inline"> <md-grid-list md-cols="4" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">公司名称</span> <input flex ng-model="search.companyName" aria-label="CompanyName"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">联系电话</span> <input required flex ng-model="search.phone" aria-label="Mobile"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">意向度</span> <md-select md-no-asterisk ng-model="search.cusType" required aria-label="CustomerType" class="md-select"> <md-option ng-value="0" ng-selected="true">全部</md-option> <md-option ng-repeat="type in ctypes" ng-repeat="" ng-value="type.CustomerTypeId">{{type.Name}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container> <md-button class="md-raised md-primary" ng-click="search()">查询</md-button> <md-button class="md-raised md-primary" ng-click="open()">新增公海客户</md-button> </md-input-container> </md-grid-tile> </md-grid-list> </form> </div> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>公司名称</th> <th>历史意向度</th> <th>联系人</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td><a href="javascript:;" ng-click="open(customer)">{{::customer.CompanyName}}</a></td> <td>{{::customer.cusTypeName}}</td> <td>{{::customer.Connector}}</td> <td class="table-opt"> <a href="javascript:;" ng-click="open(customer)">查看</a> <a href="javascript:;" ng-click="forward(customer)">抢客户</a> <a href="javascript:;" ng-if="user.RoleId<10" ng-click="delete(customer)">删除</a> </td> </tr> </tbody> </table> <div class="u-paginator"> <uib-pagination total-items="paginator.total" items-per-page="paginator.perPage" boundary-links="true" ng-model="paginator.currentPage" previous-text="{{::paginator.previousText}}" next-text="{{::paginator.nextText}}" first-text="{{::paginator.firstText}}" last-text="{{::paginator.lastText}}" force-ellipses="true" max-size="6" num-pages="paginator.numPages" ng-change="pageChanged()"> </uib-pagination> <div class="u-pages"> <span>{{paginator.currentPage}}</span> / <span>{{paginator.numPages}}</span> <span>合计:{{paginator.total}}</span> </div> <form name="paginatorForm" novalidate> <div class="input-group"> <input type="number" name="paginatorInput" ng-model="currentPage" required min="1" max="{{paginator.numPages}}" class="form-control"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-disabled="!paginatorForm.$valid" ng-click="setCurrentPage()">Go!</button> </span> </div> </form> </div>'),a.put("views/customer_rob.html",'<md-dialog aria-label="抢客户" class="md-dialog-md"> <form name="cusform" novalidate> <md-toolbar> <div class="md-toolbar-tools"> <h2>抢客户</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <md-dialog-content ng-cloak class="clearfix md-whiteframe-glow-z1 md-padding" style="overflow: hidden"> <md-input-container layout="row"> <span class="md-label md-required">意向度</span> <md-select md-no-asterisk ng-model="cusType" required aria-label="CustomerType" class="md-select"> <md-option ng-repeat="type in ctypes" ng-repeat="" ng-value="type.CustomerTypeId">{{type.Name}}</md-option> </md-select> </md-input-container> </md-dialog-content> <md-dialog-actions layout="row" md-colors="::{background: \'default-primary-100\'}"> <span flex></span> <md-button class="md-raised md-primary" ng-disabled="!cusType" ng-click="ok($event)">保存</md-button> <md-button ng-click="cancel()">取消</md-button> </md-dialog-actions> </form> </md-dialog>'),a.put("views/customer_setting.html",'<div class="col-md-8 md-padding"> <div class="row form-group" style="font-size: 1.2em"> <div class="col-md-3">意向度</div> <div class="col-md-3">库容（/个）</div> <div class="col-md-3">跟进期限（/天）</div> <div class="col-md-3">最大保护期（/天）</div> </div> <div class="row form-group" ng-repeat="setting in settings"> <label class="col-md-3 control-label">{{::setting.Name}}</label> <div class="col-md-3"> <input type="text" class="form-control" ng-model="setting.Repertory"> </div> <div class="col-md-3"> <input type="text" class="form-control" ng-model="setting.NoTrackDate"> </div> <div class="col-md-3"> <input type="text" class="form-control" ng-model="setting.LongestData"> </div> </div> <div class="text-center"> <md-button class="md-raised md-primary" ng-click="save()">保存</md-button> </div> </div>'),a.put("views/customer_signed.html",'<div class="o-search well well-sm"> <form class="form-inline"> <md-grid-list md-cols="5" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">公司名称</span> <input flex ng-model="search.companyName" aria-label="CompanyName"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">联系电话</span> <input required flex ng-model="search.phone" aria-label="Mobile"> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="user.RoleId<11"> <md-input-container layout="row"> <span class="md-label">销售</span> <md-select md-no-asterisk ng-model="search.salesId" class="md-select"> <md-option ng-value="0" ng-selected="true">全部</md-option> <md-option ng-repeat="u in users" ng-value="u.UserId">{{u.RealName}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container> <md-button class="md-raised md-primary" ng-click="search()">查询</md-button> </md-input-container> </md-grid-tile> </md-grid-list> </form> </div> <md-fab-toolbar ng-show="user.RoleId<11" md-open="batIsOpen" count="100" md-auto-close="false" md-direction="\'right\'"> <md-fab-trigger class="align-with-text"> <md-button class="md-fab md-primary"> <i class="fa fa-bars" aria-hidden="true"></i> </md-button> </md-fab-trigger> <md-toolbar> <md-fab-actions class="md-toolbar-tools"> <md-button class="md-button" ng-click="toOthersAll()"><i class="fa fa-share" aria-hidden="true"></i>批量转其他人</md-button> <md-button class="md-button" ng-click="closeTool()">关闭</md-button> </md-fab-actions> </md-toolbar> </md-fab-toolbar> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th style="width: 40px" ng-show="batIsOpen"></th> <th>公司名称</th> <th>联系人</th> <th>联系人电话</th> <th>合同日期</th> <th>销售</th> <th>主管会计</th> <th>主管会计电话</th> <th>其他服务</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td ng-show="batIsOpen"> <md-checkbox ng-model="customer.selected" ng-true-value="true" ng-false-value="false" class="md-primary md-align-top-left" flex> </md-checkbox> </td> <td>{{::customer.CompanyName}}</td> <td>{{::customer.Connector}}</td> <td>{{::customer.Mobile}}</td> <td>{{::customer.ContractDate|tDate}}</td> <td>{{::customer.SalesName}}</td> <td>{{::customer.AccountantName}}</td> <td>{{::customer.AccountantMobile}}</td> <td><a href="javascript:;" ng-click="open(customer)">查看公司</a> <a href="javascript:;" ng-click="service(customer)">服务内容</a> <a href="javascript:;" ng-click="xufei(customer)">续费</a> <a href="javascript:;" ng-click="xufei(customer)">挂起</a> </td> </tr> </tbody> </table> <div class="u-paginator"> <uib-pagination total-items="paginator.total" items-per-page="paginator.perPage" boundary-links="true" ng-model="paginator.currentPage" previous-text="{{::paginator.previousText}}" next-text="{{::paginator.nextText}}" first-text="{{::paginator.firstText}}" last-text="{{::paginator.lastText}}" force-ellipses="true" max-size="6" num-pages="paginator.numPages" ng-change="pageChanged()"> </uib-pagination> <div class="u-pages"> <span>{{paginator.currentPage}}</span> / <span>{{paginator.numPages}}</span> <span>合计:{{paginator.total}}</span> </div> <form name="paginatorForm" novalidate> <div class="input-group"> <input type="number" name="paginatorInput" ng-model="currentPage" required min="1" max="{{paginator.numPages}}" class="form-control"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-disabled="!paginatorForm.$valid" ng-click="setCurrentPage()">Go!</button> </span> </div> </form> </div>'),a.put("views/customer_totaltoc.html",'<div class="recharge"> <h2 class="clearfix ng-binding">客户统计</h2> <uib-tabset active="active" style="margin-top: 6px"> <uib-tab index="0" heading="新增客户统计"> <div style="padding: 6px 12px"> <div class="well well-sm u-search"> <form class="form-inline"> <div class="form-group"> <div class="input-group"> <input type="text" class="form-control" uib-datepicker-popup ng-model="search1.starttime" is-open="dateIsOpenedS" datepicker-options="dateOptions1" ng-required="true" close-text="关闭" current-text="今天" clear-text="清空" readonly ng-click="dateIsOpenedS = !dateIsOpenedS" ng-change="startChange()"> <span class="input-group-btn"> <button type="button" class="btn btn-default" ng-click="dateIsOpenedS = !dateIsOpenedS"><i class="glyphicon glyphicon-calendar"></i></button> </span> </div> — </div> <div class="form-group"> <div class="input-group"> <input class="form-control" type="text" uib-datepicker-popup ng-model="search1.endtime" is-open="dateIsOpenedE" datepicker-options="dateOptions2" ng-required="true" close-text="关闭" current-text="今天" clear-text="清空" readonly ng-click="dateIsOpenedE = !dateIsOpenedE"> <span class="input-group-btn"> <button type="button" class="btn btn-default" ng-click="dateIsOpenedE = !dateIsOpenedE"><i class="glyphicon glyphicon-calendar"></i></button> </span> </div> </div> <button type="button" class="btn btn-primary" ng-click="tab1Search()" style="margin-left:20px">查询</button> <button type="button" class="btn btn-primary" ng-click="dataExport1()" style="margin-left:20px">导出</button> </form> </div> <table class="table table-striped table-hover table-bordered" id="table1"> <thead> <tr class="info"> <th>大区</th> <th>省</th> <th>市</th> <th>一级代理商</th> <th>二级代理商</th> <th>新增客户数量</th> <th>新增客户合同金额</th> </tr> </thead> <tbody> <tr ng-repeat="item in data1"> <td>{{::item.PartitionName}}</td> <td>{{::item.ProvinceName}}</td> <td>{{::item.CityName}}</td> <td>{{::item.ChannelName1}}</td> <td>{{::item.ChannelName2}}</td> <td>{{::item.CustomerNum}}</td> <td>{{::item.ContractAmount}}</td> </tr> </tbody> <tfoot ng-if="data1.length != 0"> <tr> <td colspan="5">合计</td> <td>{{total1.SumCustomerNum}}</td> <td>{{total1.SumContractAmount||0}}</td> </tr> </tfoot> </table> </div> </uib-tab> <uib-tab index="1" heading="到期未续费客户统计"> <div style="padding: 6px 12px"> <div class="well well-sm u-search"> <form class="form-inline"> <div class="form-group"> <div class="input-group"> <input type="text" class="form-control" uib-datepicker-popup ng-model="search2.starttime" is-open="dateIsOpenedS" datepicker-options="dateOptions1" ng-required="true" close-text="关闭" current-text="今天" clear-text="清空" readonly ng-click="dateIsOpenedS = !dateIsOpenedS" ng-change="startChange()"> <span class="input-group-btn"> <button type="button" class="btn btn-default" ng-click="dateIsOpenedS = !dateIsOpenedS"><i class="glyphicon glyphicon-calendar"></i></button> </span> </div> — </div> <div class="form-group"> <div class="input-group"> <input class="form-control" type="text" uib-datepicker-popup ng-model="search2.endtime" is-open="dateIsOpenedE" datepicker-options="dateOptions2" ng-required="true" close-text="关闭" current-text="今天" clear-text="清空" readonly ng-click="dateIsOpenedE = !dateIsOpenedE"> <span class="input-group-btn"> <button type="button" class="btn btn-default" ng-click="dateIsOpenedE = !dateIsOpenedE"><i class="glyphicon glyphicon-calendar"></i></button> </span> </div> </div> <button type="button" class="btn btn-primary" ng-click="tab2Search()" style="margin-left:20px">查询</button> <button type="button" class="btn btn-primary" ng-click="dataExport2()" style="margin-left:20px">导出</button> <button type="button" class="btn btn-primary" ng-click="export()" style="margin-left:20px">未续费明细下载</button> </form> </div> <table class="table table-striped table-hover table-bordered" id="table2"> <thead> <tr class="info"> <th>大区</th> <th>省</th> <th>市</th> <th>一级代理商</th> <th>二级代理商</th> <th>未续费客户数量</th> </tr> </thead> <tbody> <tr ng-repeat="item in data2"> <td>{{::item.PartitionName}}</td> <td>{{::item.ProvinceName}}</td> <td>{{::item.CityName}}</td> <td>{{::item.ChannelName1}}</td> <td>{{::item.ChannelName2}}</td> <td>{{::item.NotReFeeNum}}</td> </tr> </tbody> <tfoot ng-if="data2.length != 0"> <tr> <td colspan="5">合计</td> <td>{{total2.SumNotReFee}}</td> </tr> </tfoot> </table> </div> </uib-tab> </uib-tabset> </div>'),a.put("views/customer_track.html",'<md-dialog aria-label="跟踪" class="md-dialog-lg"> <form name="cusform" novalidate> <md-toolbar> <div class="md-toolbar-tools"> <h2>{{::title}}</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <md-dialog-content ng-cloak class="clearfix md-whiteframe-glow-z1 md-padding"> <div class="trackblock"> <div ng-repeat="track in tracks" class="trackItem"> <div class="pull-right saler">{{::track.RealName}}</div> <div class="date">{{::track.TrackDate|tDateTime}}</div> <!-- <div class="pull-right" ng-if="user.UserId == track.SalesId && track.TrackDate.substr(0,10)==today"><a href="javascript:;" ng-click="delete(track)"><i class="glyphicon glyphicon-trash" aria-hidden="true"></i></a></div> --> <pre class="description">{{::track.Description}}</pre> </div> <div ng-if="!tracks || tracks.length === 0" class="trackItem">暂无跟踪记录</div> </div> <div class="addtrack well-sm" layout="column" ng-if="!isPub"> <!--  <md-input-container layout="row">\r\n                    <span class="md-label md-required">跟踪日期</span>\r\n                    <md-datepicker ng-model="TrackDate" flex formater="yyyy-MM-dd" md-max-date="maxDate" md-placeholder="跟踪日期" md-open-on-focus="true"></md-datepicker>\r\n                </md-input-container> --> <div flex layout="row" style="position: relative"> <textarea flex ng-model="track.content"></textarea> <md-button ng-click="save()" class="md-raised md-primary save">跟踪</md-button> </div> </div> <div class="addtrack well-sm tag-row" ng-if="!isPub"> <span class="pull-left tag-type" style="margin-left: 9px">提醒日期</span> <div style="position: relative"> <md-chips ng-model="reminds" readonly md-removable="true" md-on-remove="deleteRemind($chip)"> <md-chip-template> <span title="{{$chip.SalesName}}">{{$chip.NextTrackTime|tDate}}</span> </md-chip-template> <span style="cursor: pointer" md-chip-remove>&times;</span> </md-chips> <md-input-container layout="row" style="margin: 0"> <span class="md-label">添加提醒</span> <md-datepicker ng-model="remind.remindDate" flex formater="yyyy-MM-dd" md-placeholder="提醒日期" md-min-date="today" md-open-on-focus="false" ng-change="addRemind()"></md-datepicker> </md-input-container> </div> </div> </md-dialog-content> <md-dialog-actions layout="row" md-colors="::{background: \'default-primary-100\'}"> <span flex></span> <md-button ng-click="cancel()">关闭</md-button> </md-dialog-actions> </form> </md-dialog>'),a.put("views/customer_view.html",'<md-dialog aria-label="客户" class="md-dialog-lg"> <form name="cusform" novalidate> <md-toolbar> <div class="md-toolbar-tools"> <h2>{{title}}</h2>&nbsp; <md-chips ng-model="custags" class="title-chip" readonly md-removable="postData.CustomerTypeId != 5" md-on-remove="deleteTag($chip)"> <md-chip-template> <span>{{$chip.TagName}}</span> </md-chip-template> <span md-chip-remove>&times;</span> </md-chips> <span flex></span> </div> </md-toolbar> <md-dialog-content ng-cloak class="clearfix md-whiteframe-glow-z1" style="padding: 8px 16px;position: relative"> <div ng-show="opt.isOpen" class="well-sm" style="position: absolute;top: 2px;width: 96%;background: rgb(152, 148, 148);color: rgb(255, 255, 255); z-index: 99"> </div> <div layout="row"> <div flex="33" style="padding: 12px; border-right: solid 1px #999"> <md-input-container layout="row"> <span class="md-label md-required">公司名称</span> <input flex ng-model="postData.CompanyName" aria-label="CompanyName"> </md-input-container> <md-input-container layout="row"> <span class="md-label md-required">联系人</span> <input required flex ng-model="postData.Connector" aria-label="Connector"> </md-input-container> <md-input-container layout="row"> <span class="md-label md-required">联系电话</span> <input required flex ng-model="postData.Mobile" aria-label="Mobile"> </md-input-container> <md-input-container layout="row"> <span class="md-label md-required">意向度</span> <md-select md-no-asterisk ng-model="postData.CustomerTypeId" required aria-label="CustomerType" class="md-select"> <md-option ng-repeat="type in ctypes" ng-repeat="" ng-value="type.CustomerTypeId">{{type.Name}}</md-option> </md-select> </md-input-container> <md-input-container layout="row"> <span class="md-label">来源</span> <md-select md-no-asterisk ng-model="postData.CustomerSourceId" class="md-select" disabled> <md-option ng-value="0" ng-selected="true">全部</md-option> <md-option ng-repeat="u in sourceTypes" ng-value="u.Id">{{u.Marking}}</md-option> </md-select> </md-input-container> <md-input-container layout="row"> <span class="md-label md-required">备注</span> <textarea flex ng-model="postData.Mark" maxlength="200"></textarea> </md-input-container> </div> <div flex style="padding: 12px"> <md-content label="打标签" ng-if="postData.CustomerTypeId !=5 || postData.Status == 2"> <div>打标签</div> <div ng-repeat="(key, tagGroup) in tags" class="tag-row"> <span class="pull-left tag-type">{{key}}</span> <md-chips ng-model="tagGroup.tags" readonly md-removable="false" md-can-click="true" md-selected="tagGroup.selected" md-on-select="addTag($chip,null,$index)"> <md-chip-template> <span>{{$chip.TagName}}</span> </md-chip-template> <span md-chip-remove>&times;</span> </md-chips> </div> </md-content> <md-content label="跟踪记录"> <div ng-controller="Customer_track"> <div class="addtrack well-sm" layout="column" ng-if="!isPub"> <div flex layout="row" style="position: relative"> <textarea flex ng-model="track.content"></textarea> <!--              <md-button ng-click="save()" class="md-raised md-primary save">跟踪</md-button> --> </div> </div> <div class="trackblock"> <div ng-repeat="track in tracks" class="trackItem"> <div class="pull-right saler">{{::track.RealName}}</div> <div class="date">{{::track.TrackDate|tDateTime}}</div> <!-- <div class="pull-right" ng-if="user.UserId == track.SalesId && track.TrackDate.substr(0,10)==today"><a href="javascript:;" ng-click="delete(track)"><i class="glyphicon glyphicon-trash" aria-hidden="true"></i></a></div> --> <pre class="description">{{::track.Description}}</pre> </div> <div ng-if="!tracks || tracks.length === 0" class="trackItem">暂无跟踪记录</div> </div> </div> </md-content> <md-content label="客户提醒" ng-if="postData.CustomerTypeId !=5 || postData.Status == 2"> <div ng-controller="Customer_remind"> <div class="addtrack well-sm tag-row" ng-if="!isPub"> <span class="pull-left tag-type" style="margin-left: 9px">下次跟进日期</span> <div style="position: relative"> <md-chips ng-model="reminds" readonly md-removable="true" md-on-remove="deleteRemind($chip)"> <md-chip-template> <span title="{{$chip.SalesName}}">{{$chip.NextTrackTime|tDate}}</span> </md-chip-template> <span md-chip-remove style="cursor: pointer">&times;</span> </md-chips> <md-input-container layout="row" style="margin: 0"> <span class="md-label">添加提醒</span> <md-datepicker ng-model="remind.remindDate" flex formater="yyyy-MM-dd" md-placeholder="提醒日期" md-min-date="today" md-open-on-focus="false" ng-change="addRemind()"></md-datepicker> </md-input-container> </div> </div> </div> </md-content> </div> </div> </md-dialog-content> <md-dialog-actions layout="row" md-colors="::{background: \'default-primary-100\'}"> <span flex></span> <md-button ng-if="notPub && postData.Status <>2" class="md-raised md-primary" ng-click="toPub(postData)">转公海&amp;下一条</md-button> <md-button class="md-raised md-primary" ng-click="next(postData)">保存&amp;下一条</md-button> <md-button ng-click="cancel()">取消</md-button> </md-dialog-actions> </form> </md-dialog>'),
a.put("views/customer_viewservice.html",'<md-dialog class="md-dialog-lg"> <md-toolbar> <div class="md-toolbar-tools"> <h2>服务内容</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <md-dialog-content ng-cloak class="clearfix md-whiteframe-glow-z1 md-padding"> <md-toolbar> <div class="md-toolbar-tools"> <h2>记账服务</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>公司名称</th> <th>订单类型</th> <th>合同日期</th> <th>礼包</th> <th>销售</th> <th>提单日期</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="customer in orders"> <td>{{::customer.CompanyName}}<span style="color:red" ng-if="customer.IsChange">(已变更)</span><span style="color:red" ng-if="customer.FreChangeOrderId">(产品变更)</span></td> <td>{{::customer.Category|orderCategory}}</td> <td>{{::customer.ContractDate|tDate}}</td> <td>{{::customer.GiftTypeName}}</td> <td>{{::customer.SalesName}}</td> <td>{{::customer.CreateDate|tDateTime}}</td> <td class="table-opt"> <a ng-if="customer.FreChangeOrderId" href="javascript:;" ng-click="openOri(customer.FreChangeOrderId)">查看原合同</a> <a ng-if="customer.Stauts !=1" href="javascript:;" ng-click="open(customer)">查看/修改</a> <a ng-if="customer.Stauts ==1" href="javascript:;" ng-click="open(customer)">补充</a> <!-- <a href="javascript:;" ng-click="delete(customer)">删除</a> --> </td> </tr> </tbody> </table> <md-toolbar> <div class="md-toolbar-tools"> <h2>外勤任务</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>公司名称</th> <th>联系人</th> <th>联系人电话</th> <th>销售</th> <th>外勤</th> <th>状态</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="customer in outworkers"> <td>{{customer.CompanyName}}</td> <td>{{customer.Connector}}</td> <td>{{customer.Mobile}}</td> <td>{{customer.SalesName}}</td> <td>{{customer.OutWorkerName}}</td> <td>{{customer.Status|otStatus}}</td> <td class="table-opt"><a href="javascript:;" ng-click="detail(customer)">查看详情</a> </td></tr> </tbody> </table> <md-toolbar> <div class="md-toolbar-tools"> <h2>对账单</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>日期</th> <th>客户名称</th> <th>服务内容</th> <th>支付方式</th> <th>卡号</th> <th>员工</th> <th>收费总金额</th> <th>记账报税</th> <th>服务费</th> <th>汇缴</th> <th>年报</th> <th>注册</th> <th>银行开户</th> <th>国地税报道</th> <th>刻章</th> <th>地址费用</th> <th>变更</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="customer in statements"> <td>{{::customer.BillTime|tDate}}</td> <td>{{::customer.CompanyName}}</td> <td>{{::customer.ServiceContent}}</td> <td>{{::customer.PayName}}</td> <td>{{::customer.AccountNum}}</td> <td>{{::customer.SaleName}}</td> <td>{{::customer.SumAccount}}</td> <td>{{::customer.AccountsTax}}</td> <td>{{::customer.ServiceCharge}}</td> <td>{{::customer.TaxPayment}}</td> <td>{{::customer.AnnualReport}}</td> <td>{{::customer.Register}}</td> <td>{{::customer.OpenBank}}</td> <td>{{::customer.NationLocalTax}}</td> <td>{{::customer.Prints}}</td> <td>{{::customer.AddressCost}}</td> <td>{{::customer.Change}}</td> </tr> </tbody> </table> </md-dialog-content> <md-dialog-actions layout="row" md-colors="::{background: \'default-primary-100\'}"> <span flex></span> <md-button ng-click="cancel()">关闭</md-button> </md-dialog-actions> </md-dialog>'),a.put("views/dashboard.html",'<md-grid-list md-cols-md="3" md-cols="3" md-gutter="1em" md-row-height="300px" ng-if="!user.IsCenter"> <md-grid-tile md-colspan="2"> <div style="width: 100%;height: 100%; overflow: auto"> <div> <div style="padding-left:0"> <md-input-container layout="row" style="margin: 0"> <span class="md-label">跟踪提醒</span> <md-datepicker ng-model="rmd.DQdate" ng-model-options="timeoption" md-open-on-focus="true" ng-change="getRemind()"></md-datepicker> </md-input-container> </div> </div> <table class="table table-striped table-hover table-bordered" ng-if="reminds.length>0"> <thead> <tr> <th>公司名称</th> <th>联系人</th> <th>联系人电话</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="customer in reminds"> <td>{{::customer.CompanyName}}</td> <td>{{::customer.Connector}}</td> <td>{{::customer.Mobile}}</td> <td class="table-opt"><a href="javascript:;" ng-click="open(customer)">查看</a> <!--                 <a href="javascript:;" ng-click="delete(customer)">删除</a> --> </td> </tr> </tbody> </table> <div class="text-center md-padding" ng-if="reminds.length==0" md-colors="::{background: \'default-primary-100\'}">暂无提醒</div> </div> <md-divider></md-divider> </md-grid-tile> <md-grid-tile ng-if="user.RoleId==11 || user.RoleId ==7 || user.RoleId ==9"> <div style="width: 100%;height: 100%; overflow: auto"> <md-toolbar class="site-content-toolbar" style="height: 45px"> <div class="md-toolbar-tools" md-colors="::{background: \'default-primary-50\'}" style="padding-left:0"> 签单全国排名 </div> </md-toolbar> <md-content class="md-padding"> <ul class="list-group panming"> <li class="list-group-item">全年排名:<span class="badge">{{year}}</span></li> <li class="list-group-item">半年排名:<span class="badge">{{halfyear}}</span></li> <li class="list-group-item">季度排名:<span class="badge">{{quarter}}</span></li> <li class="list-group-item">当月排名:<span class="badge">{{month}}</span></li> </ul> </md-content> </div> </md-grid-tile> </md-grid-list> <md-grid-list md-cols="3" md-gutter="1em" md-row-height="150px" ng-if="user.IsCenter"> <md-grid-tile ng-repeat="item in companies"> <md-list flex class="md-dense" md-colors="::{background: \'default-primary-50\'}" style="padding: 12px"> <h4>{{item.CompanyName}}</h4> <h6>{{item.Address||\'&nbsp;\'}}</h6> <p class="text-center"> <md-button class="md-raised md-primary" ng-click="enter(item)">进入</md-button> </p> <md-divider></md-divider> </md-list> </md-grid-tile> </md-grid-list>'),a.put("views/go_task_config.html",'<div class="recharge"> <div class="well well-sm u-search clearfix"> <button class="btn btn-primary pull-right" ng-click="add(\'\',$event,\'新增通办任务\')" style="margin:12px 0">&nbsp;&nbsp;&nbsp;新增&nbsp;&nbsp;&nbsp;</button> </div> <!--<div ng-repeat="item in tasks">--> <div style="position:relative" ng-repeat="item in tasksArr"> <uib-accordion close-others="false"> <div uib-accordion-group class="panel-default" is-open="true"> <uib-accordion-heading> {{item.CommonTaskName}}&nbsp; <div style="position:absolute;top:0;right:20px"> <button class="btn btn-primary pull-right" ng-click="ifuse($event,item)" style="margin:5px 0;height:29px;line-height:16px">&nbsp;&nbsp;&nbsp;{{item.Status==1?"禁用":"启用"}}&nbsp;&nbsp;&nbsp;</button> <button class="btn btn-primary pull-right" ng-click="add(item,$event,\'编辑任务\')" style="margin:5px 20px 0;height:29px;line-height:16px">&nbsp;&nbsp;&nbsp;编辑&nbsp;&nbsp;&nbsp;</button> </div> </uib-accordion-heading> <label ng-repeat="_item in item.TaskList" style="margin-right:20px">{{$index+1}}.{{_item.TaskName}}</label> </div> </uib-accordion> </div> </div>'),a.put("views/go_task_config_view.html",'<div class="modal-header"> <span class="close" ng-click="cancel()">&times;</span> <h3 class="modal-title">{{::title}}</h3> </div> <div class="modal-body"> <form name="cusform" novalidate class="form-inline"> <div class="clearfix" style="width:80%"> <div class="form-group col-md-6" style="margin: 12px 0;float:left"> <label for="" class="required">通办任务名称</label> <input type="text" class="form-control" ng-model="task.CommonTaskName" maxlength="15" required> </div> <div class="form-group col-md-6" style="margin: 12px 0;float:left"> <label for="" class="required">排序权重</label> <input class="form-control" ng-model="task.Weight" min="1" max="99" maxlength="2" required style="width:80px" ng-change="task.Weight = Math.floor(Math.abs(task.Weight)) || \'\'"> </div> </div> </form> <div> <uib-accordion close-others="false"> <!--<div uib-accordion-group class="panel-default" is-open="true">\n                <uib-accordion-heading>\n                    {{item.name}}\n                    <div style="position:absolute;top:0;right:20px;">\n                        <button class="btn btn-primary pull-right" ng-click="ifuse($event)" style="margin:5px 0;height:29px;line-height:16px">&nbsp;&nbsp;&nbsp;启用&nbsp;&nbsp;&nbsp;</button>\n                        <button class="btn btn-primary pull-right" ng-click="add(\'\',$event,\'编辑任务\')" style="margin:5px 20px 0;height:29px;line-height:16px;">&nbsp;&nbsp;&nbsp;编辑&nbsp;&nbsp;&nbsp;</button>\n                    </div>\n                </uib-accordion-heading>\n                <lable ng-repeat="_item in item.tasks"><input type="checkbox" name="" checked value="{{_item}}">{{$index+1}}.{{_item}}</lable>\n            </div>--> <div uib-accordion-group class="panel-default" is-open="open1"> <uib-accordion-heading>税务任务 <i class="pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': open1, \'glyphicon-chevron-right\': !open1}"></i></uib-accordion-heading> <label ng-repeat="item in Tasks|filter:{BusinessType:1}:true" style="font-size:14px; min-width:200px;line-height:24px;display: inline-block; font-weight:400"><input type="checkbox" ng-model="item.checked">{{item.TaskName}}</label> </div> <!--ifChecked(item.Id) ifAdd && item.Status==1 ng-model="item.checked"--> <div uib-accordion-group class="panel-default" is-open="open2"> <uib-accordion-heading>工商任务 <i class="pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': open2, \'glyphicon-chevron-right\': !open2}"></i></uib-accordion-heading> <label ng-repeat="item in Tasks|filter:{BusinessType:2}:true" style="font-size:14px; min-width:200px;line-height:24px;display: inline-block;font-weight:400"><input type="checkbox" ng-model="item.checked">{{item.TaskName}}</label> </div> <div uib-accordion-group class="panel-default" is-open="open3"> <uib-accordion-heading>其他任务 <i class="pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': open3, \'glyphicon-chevron-right\': !open3}"></i></uib-accordion-heading> <label ng-repeat="item in Tasks|filter:{BusinessType:3}:true" style="font-size:14px;min-width:200px;display: inline-block;line-height:24px;font-weight:400"><input type="checkbox" ng-model="item.checked">{{item.TaskName}}</label> </div> </uib-accordion> <table class="table table-striped table-hover table-bordered"> <thead> <tr> <th style="width:150px">序号</th> <th style="width:350px">子任务名称</th> <th style="width:150px">权重</th> <th></th> </tr> </thead> <tbody> <tr ng-repeat="item in Tasks|filter:{checked:true} as result track by item.Id"> <td>{{$index+1}}</td> <td>{{item.defaultValue || item.TaskName}}</td> <td><input type="number" ng-model="item._weight" ng-init="item._weight=item._weight||result.length" min="1" max="99" maxlength="2" ng-model-options="{allowInvalid:true}" ng-change="task.Weight = Math.floor(Math.abs(task.Weight)) || \'\'" min="1"></td> <td> <a ng-click="item.checked=false" style="cursor:pointer">删除</a> </td> </tr> </tbody> </table> </div> </div> <div class="modal-footer"> <button class="btn btn-primary" type="button" ng-disabled="cusform.$invalid" ng-click="ok()">确认</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button> </div>'),a.put("views/login.html",'<div class="l-back"></div> <div class="l-box"> <div class="l-logo pull-left"> </div> <div class="l-lbox pull-right"> <div class="text-center l-header"> <img src="images/LOGO.5419b2f9.png" alt=""> </div> <form> <md-input-container class="md-block"> <label>用户名</label> <input ng-model="userName"> </md-input-container> <br> <md-input-container class="md-block"> <label>密码</label> <input type="password" ng-model="password"> </md-input-container> <div class="text-center" style="margin-top: 12px"> <button type="submit" class="btn btn-primary" ng-click="login()">登录</button> </div> </form> </div> </div> <div style="position:absolute;bottom:50px;right:50px"> <div class="text-center" style="font-size: 14px;color: #fff;line-height: 2em">外勤APP下载</div> <div><img src="images/qr.bdb1e551.png" alt="外勤APP下载"></div> </div>'),a.put("views/main.html",'<md-toolbar class="md-whiteframe-glow-z1 site-content-toolbar" style="height: 45px"> <div class="md-toolbar-tools" md-colors="::{background: \'default-primary-50\'}" style="padding-left:0"> <a class="headerlogo" ui-sref="main.dashboard"></a> <span style="margin: 0 12px">{{title}}</span> <div style="position: absolute; right: 12px;font-size: 16px; top:6px;line-height: 34px"> <span>欢迎您，{{user.RealName}}</span> <span class="btn btn-link pull-right" ng-if="user.se" style="color: #fff; text-align: right" ng-click="logoutZY()"><i class="fa fa-sign-out" aria-hidden="true"></i>退出直营</span> <span class="btn btn-link pull-right" ng-click="logout()"><i class="fa fa-sign-out" aria-hidden="true"></i>退出</span> </div> </div> </md-toolbar> <md-content flex layout="row"> <md-sidenav class="site-sidenav md-sidenav-left md-whiteframe-z2" md-is-locked-open="true" layout="column"> <ul class="docs-menu" flex> <li ng-repeat="section in menu.sections" class="parent-list-item {{section.className || \'\'}}" ng-class="{\'parentActive\' : isSectionSelected(section)}"> <menu-toggle section="section" ng-if="section.type === \'toggle\' && !section.hidden"></menu-toggle> </li> </ul> </md-sidenav> <md-content flex class="o-body" ui-view flex style="overflow: auto; padding: 12px"> </md-content> </md-content>'),a.put("views/menu-link.tmpl.html",'<md-button ng-class="{\'active\' : isSelected()}" ui-sref="{{section.router}}" ng-click="selectPage(section)"> <span aria-hidden="true" class="md-toggle-icon"><i class="fa"></i></span> {{section.name}} <span class="md-visually-hidden" ng-if="isSelected()"> current page </span> </md-button>'),a.put("views/menu-toggle.tmpl.html",'<md-button class="md-button-toggle" ng-click="toggle()" aria-expanded="{{isOpen()}}"> <div flex layout="row"> <span aria-hidden="true" class="md-toggle-icon"> <i class="{{section.icon}}" aria-hidden="true"></i> </span> {{section.name}} </div> </md-button> <ul id="docs-menu-{{section.name | nospace}}" class="menu-toggle-list"> <li ng-repeat="page in section.pages"> <menu-link section="page"></menu-link> </li> </ul>'),a.put("views/order_addAgent.html",'<form name="orderForm"> <md-content layout="column" class="order md-padding"> <md-card> <md-toolbar md-scroll-shrink ng-if="true"> <div class="md-toolbar-tools"> <h4>选择销售</h4></div> </md-toolbar> <md-card-content class="md-inline-form"> <md-input-container layout="row" style="margin: 0"> <span class="md-label md-required">销售</span> <md-select ng-disabled="postData.Orderid||isChange" md-no-asterisk ng-model="postData.SalesId" required aria-label="saler" class="md-select" ng-change="selectSalers()"> <md-option ng-repeat="item in salers" ng-disabled="item.disabled" ng-value="item.UserId">{{item.RealName}}</md-option> </md-select> </md-input-container> </md-card-content> </md-card> <md-card ng-if="cStep >= 0"> <md-toolbar md-scroll-shrink ng-if="true"> <div class="md-toolbar-tools"> <h4>订单类型</h4></div> </md-toolbar> <md-card-content class="md-inline-form"> <md-radio-group ng-model="postData.Category"> <md-radio-button ng-disabled="orderid" value="1" class="md-primary" ng-click="selectTypeStep(1)">记账报税</md-radio-button> <md-radio-button ng-disabled="orderid" value="2" class="md-primary" ng-click="selectTypeStep(2)">公司注册+记账报税</md-radio-button> </md-radio-group> </md-card-content> </md-card> <md-card ng-if="cStep == 1"> <md-toolbar md-scroll-shrink ng-if="true"> <div class="md-toolbar-tools"> <h4>选择客户</h4></div> </md-toolbar> <md-card-content class="md-inline-form"> <md-radio-group ng-model="cType"> <md-radio-button ng-value="1" class="md-primary" ng-click="selectCustomerStep(1)">已有客户(CRM/签单客户)</md-radio-button> <md-radio-button ng-value="2" class="md-primary" ng-click="selectCustomerStep(2)">新增客户</md-radio-button> </md-radio-group> </md-card-content> </md-card> <md-card ng-if="cStep > 1"> <md-toolbar md-scroll-shrink> <div class="md-toolbar-tools"> <h4>客户基本信息</h4></div> </md-toolbar> <md-card-content> <md-grid-list md-cols="2" md-cols-md="2" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">公司名称</span> <input required flex required ng-model="postData.Customer.CompanyName" aria-label="CompanyName" ng-readonly="isRemind||isChange"> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="postData.Category==1 || supp || postData.Status==2"> <md-input-container layout="row"> <span class="md-label md-required">公司地址</span> <input required flex required ng-model="postData.Customer.Address" aria-label="Address"> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="postData.Category==1 || supp || postData.Status==2"> <md-input-container> <span class="md-label md-required">所属行业</span> <md-select md-no-asterisk required ng-model="postData.Customer.IndustryId" class="md-select" required aria-label="IndustryId"> <md-option ng-repeat="ind in industries" ng-value="ind.IndustryId">{{::ind.IndustryName}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container> <span class="md-label md-required">企业类型</span> <md-select md-no-asterisk ng-disabled="supp||isChange || postData.IsChange" ng-model="postData.Customer.AddedValue" class="md-select" ng-change="getPrice()" required aria-label="AddedValue"> <md-option ng-value="1">小规模</md-option> <md-option ng-value="2">一般纳税人</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">联系人</span> <input required flex ng-model="postData.Customer.Connector" aria-label="Connector"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">联系电话</span> <input required flex ng-model="postData.Customer.Mobile" aria-label="Mobile"> </md-input-container> </md-grid-tile> </md-grid-list> </md-card-content> </md-card> <md-card ng-if="cStep > 1"> <md-toolbar md-scroll-shrink> <div class="md-toolbar-tools"> <h4>营业执照信息</h4></div> </md-toolbar> <md-card-content> <md-grid-list md-cols="2" md-cols-md="2" md-row-height="52px"> <md-grid-tile ng-if="postData.Category==1 || supp || postData.Status==2"> <md-input-container layout="row"> <span class="md-label md-required">注册号</span> <input required ng-readonly="isRemind||isChange" flex required ng-model="postData.Customer.RegNO" aria-label="RegNO"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">法人</span> <input required ng-readonly="isRemind||isChange" maxlength="10" flex required ng-model="postData.Customer.LegalPerson" aria-label="LegalPerson"> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="postData.Category==2 || supp"> <md-input-container> <div layout="row"> <span class="md-label md-required">法人身份证</span> <img ng-src="{{postData.Customer.PersonCardPath}}" class="order-img" alt="" ng-if="postData.Customer.PersonCardPath" pic-view> <span class="file-select btn btn-default" ng-if="!supp">选择文件 <input type="file" nv-file-select="" uploader="uploader1" ng-show="!isReadOnly"> </span> </div> <div class="progress" style="width:80%" ng-if="uploader2.isUploading"> <md-progress-linear md-mode="determinate" value="{{uploader2.progress}}"></md-progress-linear> </div> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="postData.Category==1 || supp || postData.Status==2"> <md-input-container layout="row"> <span class="md-label md-required">国税登记号</span> <input required flex ng-model="postData.Customer.NationalTaxNO" aria-label="NationalTaxNO"> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="postData.Category==1 || supp || postData.Status==2"> <md-input-container layout="row"> <span class="md-label md-required">地税登记号</span> <input required flex ng-model="postData.Customer.LocalTaxNO" aria-label="LocalTaxNO"> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="postData.Category==1 || supp || postData.Status==2"> <div layout="row" style="width: 100%"> <div style="width: 300px"> <md-input-container layout="row" style="padding-right: 0"> <span class="md-label md-required">营业期限</span> <md-datepicker required ng-model="postData.Customer.RegisterDate" ng-model-options="timeoption" md-current-view="year" md-open-on-focus="true"></md-datepicker> </md-input-container> </div> <div style="width: 320px"> <md-input-container layout="row" style="padding-right: 0"> <span class="md-label" style="min-width: 0">至</span> <md-datepicker ng-model="postData.Customer.BusnissDeadline" ng-disabled="postData.Customer.NoDeadLine" md-current-view="year" md-open-on-focus="true"></md-datepicker> <md-checkbox ng-model="postData.Customer.NoDeadLine" style="top: 6px;left: 6px">无期限</md-checkbox> </md-input-container> </div> </div> </md-grid-tile> <md-grid-tile ng-if="postData.Category==1 || supp || postData.Status==2"> <md-input-container layout="row"> <span class="md-label md-required">注册资金</span> <input required flex ng-model="postData.Customer.RegisteredCapital" aria-label="RegisteredCapital"> </md-input-container> </md-grid-tile> <md-grid-tile md-rowspan="2" ng-if="postData.Category==1 || supp"> <md-input-container layout="row"> <span class="md-label md-required">经营范围</span> <textarea name="" flex ng-model="postData.Customer.BusinessScope"></textarea> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="postData.Category==1 || supp || postData.Status==2"> <md-input-container> <div layout="row"> <span class="md-label md-required">营业执照</span> <img ng-src="{{postData.Customer.BusinessLicense}}" class="order-img" alt="" ng-if="postData.Customer.BusinessLicense" pic-view> <span class="file-select btn btn-default">选择文件 <input type="file" nv-file-select="" uploader="uploader2"> </span> </div> <div class="progress" style="width:80%" ng-if="uploader2.isUploading"> <md-progress-linear md-mode="determinate" value="{{uploader2.progress}}"></md-progress-linear> </div> </md-input-container> </md-grid-tile> </md-grid-list> </md-card-content> </md-card> <md-card ng-if="cStep > 1"> <md-toolbar md-scroll-shrink> <div class="md-toolbar-tools"> <h4>合同信息</h4></div> </md-toolbar> <md-card-content> <md-grid-list md-cols="2" md-cols-md="2" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">合同编号</span> <input required flex required ng-model="postData.ContractNo" aria-label="ContractNo"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">付款方式</span> <md-select md-no-asterisk ng-model="postData.PayType" ng-disabled="supp || isChange" class="md-select" ng-change="getPrice();setEndDate();" required> <md-option ng-value="3">季付</md-option> <md-option ng-value="1">半年付</md-option> <md-option ng-value="2">年付</md-option> <md-option ng-value="4">零税(半年)</md-option> <md-option ng-value="5">零税(全年)</md-option> <md-option ng-if="user.SubsidiaryId == 12" ng-value="6">机构零票全年</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">支付方式</span> <md-select md-no-asterisk ng-model="postData.PayId" class="md-select" required> <md-option ng-repeat="pay in paymodes" ng-value="pay.Id">{{::pay.PayName}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">卡号</span> <input flex ng-model="otherData.AccountNum"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">礼包</span> <md-select md-no-asterisk ng-model="postData.GiftTypeId" ng-disabled="supp|| isChange" class="md-select" ng-change="setEndDate()"> <md-option ng-value="0">不使用礼包</md-option> <md-option ng-repeat="gift in gifts" ng-value="gift.Id">{{gift.GiftTypeName}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">签订日期</span> <md-datepicker required ng-model="postData.ContractDate" ng-model-options="timeoption" md-open-on-focus="true"></md-datepicker> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="postData.Category==1 || supp || postData.Status==2"> <md-input-container layout="row"> <span class="md-label md-required">服务开始时间</span> <md-datepicker required ng-model="postData.ServiceStart" ng-model-options="timeoption" md-open-on-focus="true" md-current-view="year" formater="yyyy-MM" md-min-view="year" aria-label="ServiceStart" md-max-date="maxDate" ng-change="setEndDate()"></md-datepicker> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="postData.Category==1 || supp || postData.Status==2"> <md-input-container layout="row"> <span class="md-label md-required">服务结束时间</span> <md-datepicker required ng-model="postData.ServiceEnd" ng-model-options="timeoption" md-open-on-focus="true" md-current-view="year" formater="yyyy-MM" md-min-view="year"></md-datepicker> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">合同金额</span> <input required required ng-model="postData.Amount" md-current-view="year" md-min-view="year" aria-label="Amount"> </md-input-container> </md-grid-tile> <md-grid-tile md-rowspan="2"> <md-input-container layout="row"> <span class="md-label">备注</span> <textarea name="" flex ng-model="postData.Remark"></textarea> </md-input-container> </md-grid-tile> </md-grid-list></md-card-content> </md-card> <md-card ng-if="cStep > 1"> <md-toolbar md-scroll-shrink> <div class="md-toolbar-tools"> <h4>其他服务费用及代收费用</h4></div> </md-toolbar> <md-card-content> <md-grid-list md-cols="3" md-cols-md="3" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">服务内容</span> <input flex ng-model="otherData.ServiceContent"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">服务费</span> <input flex ng-model="otherData.ServiceCharge" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">总金额</span> <input flex readonly ng-value="getAmount()" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile md-colspan="3"> <div class="md-toolbar-tools"> 服务费 </div> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">汇缴</span> <input flex ng-model="otherData.TaxPayment" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">年报</span> <input flex ng-model="otherData.AnnualReport" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">注册</span> <input flex ng-model="otherData.Register" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">变更</span> <input flex ng-model="otherData.Changes" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile md-colspan="2"> </md-grid-tile> <md-grid-tile md-colspan="3"> <div class="text-center md-toolbar-tools" flex> 代收费 </div> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">银行开户</span> <input flex ng-model="otherData.OpenBank" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">税控</span> <input flex ng-model="otherData.NationLocalTax" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">刻章</span> <input flex ng-model="otherData.Prints" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">地址费用</span> <input flex ng-model="otherData.AddressCost" type="number"> </md-input-container> </md-grid-tile> </md-grid-list></md-card-content> </md-card> <div class="text-center" ng-if="cStep > 1"> <md-button class="md-raised md-primary" ng-disabled="orderForm.$invalid || saving" ng-click="save($event)">保存</md-button> </div> </md-content> </form>'),a.put("views/order_change.html",'<div class="o-search well well-sm"> <form class="form-inline"> <md-grid-list md-cols="5" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">公司名称</span> <input flex ng-model="search.companyName" aria-label="CompanyName"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container> <md-button class="md-raised md-primary" ng-click="search()">查询</md-button> </md-input-container> </md-grid-tile> </md-grid-list> </form> </div> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>公司名称</th> <th>合同日期</th> <th>服务结束时间</th> <th>销售</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td>{{::customer.CompanyName}}</td> <td>{{::customer.ContractDate|tDate}}</td> <td>{{::customer.ServiceEnd.substr(0,7)}}</td> <td>{{::customer.RealName}}</td> <td class="table-opt"><a href="javascript:;" ng-click="open(customer)">变更</a> </td> </tr> </tbody> </table> <div class="u-paginator"> <uib-pagination total-items="paginator.total" items-per-page="paginator.perPage" boundary-links="true" ng-model="paginator.currentPage" previous-text="{{::paginator.previousText}}" next-text="{{::paginator.nextText}}" first-text="{{::paginator.firstText}}" last-text="{{::paginator.lastText}}" force-ellipses="true" max-size="6" num-pages="paginator.numPages" ng-change="pageChanged()"> </uib-pagination> <div class="u-pages"> <span>{{paginator.currentPage}}</span> / <span>{{paginator.numPages}}</span> <span>合计:{{paginator.total}}</span> </div> <form name="paginatorForm" novalidate> <div class="input-group"> <input type="number" name="paginatorInput" ng-model="currentPage" required min="1" max="{{paginator.numPages}}" class="form-control"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-disabled="!paginatorForm.$valid" ng-click="setCurrentPage()">Go!</button> </span> </div> </form> </div>'),a.put("views/order_complete.html",'<div class="o-search well well-sm"> <form class="form-inline"> <md-grid-list md-cols="5" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">公司名称</span> <input flex ng-model="search.companyName" aria-label="CompanyName"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container> <md-button class="md-raised md-primary" ng-click="search()">查询</md-button> </md-input-container> </md-grid-tile> </md-grid-list> </form> </div> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>公司名称</th> <th>合同日期</th> <th>礼包</th> <th>销售</th> <th>提单日期</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td>{{::customer.CompanyName}}</td> <td>{{::customer.ContractDate|tDate}}</td> <td>{{::customer.GiftTypeName}}</td> <td>{{::customer.SalesName}}</td> <td>{{::customer.CreateDate|tDateTime}}</td> <td class="table-opt"> <a href="javascript:;" ng-click="open(customer)">查看</a> <a href="javascript:;" ng-click="delete(customer)">删除</a> </td> </tr> </tbody> </table> <div class="u-paginator"> <uib-pagination total-items="paginator.total" items-per-page="paginator.perPage" boundary-links="true" ng-model="paginator.currentPage" previous-text="{{::paginator.previousText}}" next-text="{{::paginator.nextText}}" first-text="{{::paginator.firstText}}" last-text="{{::paginator.lastText}}" force-ellipses="true" max-size="6" num-pages="paginator.numPages" ng-change="pageChanged()"> </uib-pagination> <div class="u-pages"> <span>{{paginator.currentPage}}</span> / <span>{{paginator.numPages}}</span> <span>合计:{{paginator.total}}</span> </div> <form name="paginatorForm" novalidate> <div class="input-group"> <input type="number" name="paginatorInput" ng-model="currentPage" required min="1" max="{{paginator.numPages}}" class="form-control"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-disabled="!paginatorForm.$valid" ng-click="setCurrentPage()">Go!</button> </span> </div> </form> </div>'),
a.put("views/order_list.html",'<div class="o-search well well-sm"> <form class="form-inline"> <md-grid-list md-cols="5" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">开始日期</span> <md-datepicker ng-model="search.startdate" md-open-on-focus="true"></md-datepicker> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">结束日期</span> <md-datepicker ng-model="search.enddate" md-open-on-focus="true"></md-datepicker> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">公司名称</span> <input flex ng-model="search.companyName" aria-label="CompanyName"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">付款方式</span> <md-select md-no-asterisk ng-model="search.PayType" class="md-select"> <md-option ng-value="0" ng-selected="true">全部</md-option> <md-option ng-value="3">季付</md-option> <md-option ng-value="1">半年付</md-option> <md-option ng-value="2">年付</md-option> <md-option ng-value="4">零税(半年)</md-option> <md-option ng-value="5">零税(全年)</md-option> <md-option ng-if="user.SubsidiaryId == 12" ng-value="6">机构零票全年</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container> <span class="md-label">企业类型</span> <md-select md-no-asterisk ng-model="search.AddedValue" class="md-select"> <md-option ng-value="0" ng-selected="true">全部</md-option> <md-option ng-value="1">小规模</md-option> <md-option ng-value="2">一般纳税人</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container> <md-button class="md-raised md-primary" ng-click="search()">查询</md-button> </md-input-container> </md-grid-tile> </md-grid-list> </form> </div> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>公司名称</th> <th>订单类型</th> <th>合同日期</th> <th>礼包</th> <th>销售</th> <th>提单日期</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td>{{::customer.CompanyName}}<span style="color:red" ng-if="customer.IsChange">(已变更)</span><span style="color:red" ng-if="customer.FreChangeOrderId">(产品变更)</span></td> <td>{{::customer.Category|orderCategory}}</td> <td>{{::customer.ContractDate|tDate}}</td> <td>{{::customer.GiftTypeName}}</td> <td>{{::customer.SalesName}}</td> <td>{{::customer.CreateDate|tDateTime}}</td> <td class="table-opt"> <a ng-if="customer.FreChangeOrderId" href="javascript:;" ng-click="openOri(customer.FreChangeOrderId)">查看原合同</a> <a ng-if="customer.Stauts !=1" href="javascript:;" ng-click="open(customer)">查看/修改</a> <a ng-if="customer.Stauts ==1" href="javascript:;" ng-click="open(customer)">补充</a> <a href="javascript:;" ng-click="delete(customer)">删除</a> </td> </tr> </tbody> </table> <div class="u-paginator"> <uib-pagination total-items="paginator.total" items-per-page="paginator.perPage" boundary-links="true" ng-model="paginator.currentPage" previous-text="{{::paginator.previousText}}" next-text="{{::paginator.nextText}}" first-text="{{::paginator.firstText}}" last-text="{{::paginator.lastText}}" force-ellipses="true" max-size="6" num-pages="paginator.numPages" ng-change="pageChanged()"> </uib-pagination> <div class="u-pages"> <span>{{paginator.currentPage}}</span> / <span>{{paginator.numPages}}</span> <span>合计:{{paginator.total}}</span> </div> <form name="paginatorForm" novalidate> <div class="input-group"> <input type="number" name="paginatorInput" ng-model="currentPage" required min="1" max="{{paginator.numPages}}" class="form-control"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-disabled="!paginatorForm.$valid" ng-click="setCurrentPage()">Go!</button> </span> </div> </form> </div>'),a.put("views/order_outworker.html",'<div class="recharge"> <div class="well well-sm u-search"> <form class="form-inline" style="position:relative;padding-right:150px"> <div class="form-group" style="margin: 5px 10px 5px 10px"> <label>序列ID</label>： <input type="text" ng-model="search.Id" class="form-control"> </div> <div class="form-group" style="margin: 5px 10px 5px 10px"> <label>公司名称</label>： <input type="text" ng-model="search.companyname" class="form-control"> </div> <div class="form-group" style="margin: 5px 10px 5px 10px"> <label>公司联系人</label>： <input type="text" ng-model="search.connector" class="form-control"> </div> <div class="form-group" style="margin: 5px 10px 5px 10px"> <label>任务名称</label>： <select ng-model="search.taskname" class="form-control"> <option value="" ng-selected="true">请选择</option> <option ng-repeat="task in Tasks" ng-value="task.CommonTaskId">{{task.CommonTaskName}}</option> <option ng-value="0">其他</option> <!--需要改数据--> </select> </div> <div class="form-group" style="margin: 5px 10px 5px 10px"> <label>当前子任务</label>： <select ng-model="search.childtaskname" class="form-control"> <option value="" ng-selected="true">请选择</option> <option ng-repeat="outT in outTasks" ng-value="outT.Id">{{outT.TaskName}}</option> </select> </div> <div class="form-group" style="margin: 5px 10px 5px 10px"> <label>当前外勤人员</label>： <select ng-model="search.currOutworker" class="form-control"> <option value="" ng-selected="true">请选择</option> <option ng-repeat="ot in outworkers" ng-value="{{ot.UserId}}">{{ot.RealName}}</option> <!--需要改数据--> </select> </div> <!--日期--> <div class="form-group" style="margin: 5px 10px 5px 10px;min-width:300px"> <lable style="margin-bottom: 5px;font-weight: bold;float:left;line-height:34px;height:34px">任务提交日期：</lable> <div class="row" style="float:left"> <div class="col-md-6"> <p class="input-group" style="margin:0"> <input type="text" class="form-control" uib-datepicker-popup="{{format}}" ng-model="dt1" is-open="popup1.opened" datepicker-options="dateOptions" close-text="Close" alt-input-formats="altInputFormats" ng-change="changeDate()" id="date1" style="padding:6px"> <span class="input-group-btn"> <button type="button" class="btn btn-default" ng-click="open1()"><i class="glyphicon glyphicon-calendar"></i></button> </span> </p> </div> <div class="col-md-6"> <p class="input-group" style="margin:0"> <input type="text" class="form-control" uib-datepicker-popup ng-model="dt2" is-open="popup2.opened" datepicker-options="dateOptions" close-text="Close" ng-change="changeDate()" id="date2" style="padding:6px"> <span class="input-group-btn"> <button type="button" class="btn btn-default" ng-click="open2()"><i class="glyphicon glyphicon-calendar"></i></button> </span> </p> </div> </div> </div> <div class="form-group" style="margin: 5px 10px 5px 10px"> <label>所属区（县）</label>： <select ng-model="search.areacode" class="form-control"> <option value="" ng-selected="true">请选择</option> <option ng-repeat="area in areas" ng-value="area.AreaCode">{{area.AreaName}}</option> <!--需要改数据--> </select> </div> <div class="form-group" style="margin: 5px 10px 5px 10px"> <label>销售人员</label>： <select ng-model="search.salesId" class="form-control"> <option value="0" ng-selected="true">请选择</option> <option ng-repeat="u in users" ng-value="u.UserId">{{u.RealName}}</option> <!--需要改--> </select> </div> <div class="form-group" style="margin: 5px 10px 5px 10px"> <label>子任务状态</label>： <select ng-model="search.taskstatus" class="form-control"> <option value="" ng-selected="true">请选择</option> <option ng-repeat="(key,value) in taskStatus" ng-value="key">{{value}}</option> <!--需要改--> </select> </div> <!--<div class="form-group">\n                <a href="">导出Excel表格</a>\n            </div>--> <button type="button" class="btn btn-primary" ng-click="searchFn()" style="position:absolute;right:20px;top:5px;width:110px">搜索</button> <button class="btn btn-primary pull-right" ng-click="open()" style="position:absolute;right:20px;top:50px" ng-if="user.Category ==2 || user.Category==8 || user.Category==5">新增外勤任务</button> </form> </div> <table class="table table-striped table-hover table-bordered"> <thead> <tr class="info"> <th>序列ID</th> <th>任务名称</th> <th>公司名称</th> <th>所属区域</th> <th>公司联系人</th> <th>销售人员</th> <!--<th>联系人电话</th>--> <th>当前子任务</th> <th>当前外勤人员</th> <th>提交任务时间</th> <th>子任务状态</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td style="text-align:center">{{customer.Id}}</td> <td style="text-align:center">{{customer.MainTaskName}}</td> <td style="text-align:center">{{customer.CompanyName}}</td> <td style="text-align:center">{{customer.AreaName}}</td> <td style="text-align:center">{{customer.Connector}}</td> <td style="text-align:center">{{customer.SalesName}}</td> <td style="text-align:center">{{customer.childTaskName}}</td> <td style="text-align:center">{{customer.OutWorkerName}}</td> <td style="text-align:center">{{customer.SubmitTaskTime.replace("T"," ")}}</td> <td style="text-align:center">{{customer.Status|outWorkStatus}}</td> <td class="table-opt" style="text-align:center"><button class="btn btn-link" href="javascript:;" ng-click="detail(customer)">查看详情</button> <button class="btn btn-link" href="javascript:;" ng-show="user.Category ==2 || user.Category==8" ng-disabled="customer.Status>3" ng-click="delete(customer)">取消</button></td> </tr> </tbody> </table> <div class="u-paginator"> <uib-pagination total-items="paginator.total" items-per-page="paginator.perPage" boundary-links="true" ng-model="paginator.currentPage" previous-text="{{::paginator.previousText}}" next-text="{{::paginator.nextText}}" first-text="{{::paginator.firstText}}" last-text="{{::paginator.lastText}}" force-ellipses="true" max-size="6" num-pages="paginator.numPages" ng-change="pageChanged()"> </uib-pagination> <div class="u-pages"> <span>{{paginator.currentPage}}</span> / <span>{{paginator.numPages}}</span> &nbsp; <span>合计:{{paginator.total}}</span> </div> <form name="paginatorForm" novalidate> <div class="input-group"> <input type="number" name="paginatorInput" ng-model="currentPage" required min="1" max="{{paginator.numPages}}" ng class="form-control"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-disabled="!paginatorForm.$valid" ng-click="setCurrentPage()">Go!</button> </span> </div> </form> </div> </div>'),a.put("views/order_outworker_add.html",'<div class="modal-header"> <span class="close" ng-click="cancel()">&times;</span> <h3 class="modal-title">添加外勤任务</h3> </div> <div class="modal-body"> <form name="cusform" novalidate> <div class="well well-sm" style="min-height: 200px"> <uib-accordion close-others="true"> <div uib-accordion-group class="panel-default" close-others="true" is-open="open1" is-disabled="tbIsDisable()"> <uib-accordion-heading> 通办任务 <i class="pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': accordion.open1, \'glyphicon-chevron-right\': !accordion.open1}"></i> </uib-accordion-heading> <div ng-repeat="task in tasksArr" style="width:100%;min-height:50px;margin:2px;background:#eee;max-height:280px"> <p> <lable style="width:100%;font-size:16px"><input type="checkbox" name="commonTask" ng-model="task.checked" ng-change="checkTB(task)" ng-value="true">&nbsp;&nbsp;&nbsp;{{task.CommonTaskName}}</lable> </p> <ul style="padding-left:20px;min-height:40px;display: inline-block"> <li style="float:left;margin-right:12px;height:18px;list-style:none" ng-repeat="item in task.TaskList"> {{$index+1}}.{{item.TaskName}} </li> </ul> </div> </div> <div uib-accordion-group class="panel-default" close-others="true" is-open="open2" is-disabled="otherIsDisable()"> <uib-accordion-heading> 其他 <i class="pull-right glyphicon" ng-class="{\'glyphicon-chevron-down\': accordion.open2, \'glyphicon-chevron-right\': !accordion.open2}"></i> </uib-accordion-heading> <uib-accordion close-others="false"> <div uib-accordion-group ng-repeat="tg in tasks" class="panel-default" is-open="true"> <uib-accordion-heading> {{::tg.Name}}任务 </uib-accordion-heading> <label style="margin:6px 30px 6px 0;font-size:16px;display:inline-block" ng-repeat="task in tg.list"><input type="checkbox" ng-model="task.selected">{{::task.TaskName}}</label> </div> </uib-accordion> </div> </uib-accordion> </div> <div class="well well-sm u-search form-inline clearfix"> <div class="form-group col-md-12"> <label class="required">选择公司</label>： <input flex ng-value="postData.Customer.CompanyName || postData.Customer.Connector" required ng-disabled="cus_selected" aria-label="CompanyName" ng-click="selectCustomer()" readonly class="form-control"> </div> <div class="form-group col-md-12" style="margin-top:20px"> <label class="required">选择区域</label>： <select ng-model="areaSele" class="form-control" required value="0" ng-change="change()" required> <option value="" ng-selected="true">请选择</option> <option ng-repeat="area in areaArr" ng-value="area.AreaCode">{{area.AreaName}}</option> </select> </div> <div class="form-group col-md-12" style="margin: 12px 0"> <label>备注</label>： <textarea name="" flex ng-model="postData.Remark" maxlength="400" style="width: 100%;height: 100px"></textarea> </div> </div> </form> </div> <div class="modal-footer"> <button class="btn btn-primary" type="button" ng-disabled="cusform.$invalid" ng-click="ok($event)">保存</button> <button class="btn btn-warning" type="button" ng-click="cancel()">关闭</button> </div>  '),a.put("views/order_outworker_detail.html",'<div class="modal-header"> <span class="close" ng-click="cancel()">&times;</span> <h3 class="modal-title">任务详情</h3> </div> <div class="modal-body"> <table class="table table-striped table-hover table-bordered"> <thead> <tr class="info"> <!--<th style="width: 40px;" ng-show="batIsOpen"></th>--> <th ng-show="user.Category ==2 || user.Category==8">选择</th> <th>序列ID</th> <th>子任务名称</th> <th>当前外勤人员</th> <th>开始时间</th> <th>完成时间</th> <th style="width:70px">状态</th> <th style="width:230px">操作</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers track by customer.TaskId"> <td ng-show="user.Category ==2 || user.Category==8"><input type="checkbox" ng-model="customer.selected" ng-disabled="customer.Status>3" style="vertical-align: top; width:16px;height:16px"></td> <td>{{customer.Id}}</td> <td>{{customer.TaskName}}</td> <td>{{customer.OutWorkerName}}</td> <td>{{customer.StartTime|tDateTime}}</td> <td>{{customer.EndTime|tDateTime}}</td> <td>{{customer.Status|outWorkStatus}}</td> <td><button class="btn btn-link" ng-click="editCompany(customer)" ng-if="user.Category ==2 || user.Category==8 || customer.OutWorkerId == user.UserId" ng-disabled="(user.Category ==2 || user.Category==8)? false :customer.Status != 3">编辑</button> <button class="btn btn-link" ng-click="statusChange(customer,3,\'确认资料\')" ng-if="user.Category ==2 || user.Category==8 || customer.OutWorkerId == user.UserId" ng-disabled="customer.Status!==2">确认资料</button> <button class="btn btn-link" ng-click="statusChange(customer,5,\'完成\')" ng-if="user.Category ==2 || user.Category==8 || customer.OutWorkerId == user.UserId" ng-disabled="customer.Status!==3">完成</button> <button class="btn btn-link" ng-click="forward(customer)" ng-if="user.Category ==2 || user.Category==8" ng-disabled="customer.Status>3">转接任务</button> <button class="btn btn-link" ng-click="statusChange(customer,4,\'取消任务\')" ng-if="user.Category ==2 || user.Category==8" ng-disabled="customer.Status>3">取消</button></td> </tr> </tbody> </table> <lable ng-if="user.Category ==2 || user.Category==8"><input type="checkbox" style="vertical-align: top; width:16px;height:16px" ng-model="forwards.isSelectAll" ng-change="selectAll()">全选</lable> <select ng-change="forwardAll()" ng-model="forwards.forwardUserId" ng-if="user.Category ==2 || user.Category==8"> <option selected value="0">任务批量分配</option> <option ng-repeat="ot in outworkers" value="{{::ot.UserId}}">{{::ot.RealName}}</option> </select> </div> <div class="modal-footer"> <button class="btn btn-warning" type="button" ng-click="cancel()">关闭</button> </div>'),a.put("views/order_remind.html",'<div class="o-search well well-sm"> <form class="form-inline"> <md-grid-list md-cols="5" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">到期期限</span> <md-select md-no-asterisk ng-model="search.month" required aria-label="CustomerType" class="md-select"> <md-option ng-value="1" selected>一个月内</md-option> <md-option ng-value="2">两个月内</md-option> <md-option ng-value="3">三个月内</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container> <md-button class="md-raised md-primary" ng-click="search()">查询</md-button> </md-input-container> </md-grid-tile> </md-grid-list> </form> </div> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>公司名称</th> <th>联系人</th> <th>联系人电话</th> <th>销售</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td>{{::customer.CompanyName}}</td> <td>{{::customer.Connector}}</td> <td>{{::customer.Mobile}}</td> <td>{{::customer.SaleName}}</td> <td class="table-opt"><a href="javascript:;" ng-click="open(customer)">续费</a> </td> </tr> </tbody> </table> <div class="u-paginator"> <uib-pagination total-items="paginator.total" items-per-page="paginator.perPage" boundary-links="true" ng-model="paginator.currentPage" previous-text="{{::paginator.previousText}}" next-text="{{::paginator.nextText}}" first-text="{{::paginator.firstText}}" last-text="{{::paginator.lastText}}" force-ellipses="true" max-size="6" num-pages="paginator.numPages" ng-change="pageChanged()"> </uib-pagination> <div class="u-pages"> <span>{{paginator.currentPage}}</span> / <span>{{paginator.numPages}}</span> <span>合计:{{paginator.total}}</span> </div> <form name="paginatorForm" novalidate> <div class="input-group"> <input type="number" name="paginatorInput" ng-model="currentPage" required min="1" max="{{paginator.numPages}}" class="form-control"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-disabled="!paginatorForm.$valid" ng-click="setCurrentPage()">Go!</button> </span> </div> </form> </div>'),a.put("views/order_statement.html",'<div class="o-search well well-sm"> <form class="form-inline"> <md-grid-list md-cols="1" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">时间范围</span> <md-datepicker ng-model="search.start" md-open-on-focus="true"></md-datepicker> </md-input-container> <md-input-container layout="row"> <span style="line-height: 36px">至</span> <md-datepicker ng-model="search.end" md-open-on-focus="true"></md-datepicker> </md-input-container> <md-input-container> <md-button class="md-raised md-primary" ng-click="search()">查询</md-button> <md-button class="md-raised md-primary" ng-click="add()">添加</md-button> </md-input-container> </md-grid-tile> </md-grid-list> </form> </div> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>日期</th> <th>客户名称</th> <th>服务内容</th> <th>支付方式</th> <th>卡号</th> <th>员工</th> <th>收费总金额</th> <th>记账报税</th> <th>服务费</th> <th>汇缴</th> <th>年报</th> <th>注册</th> <th>银行开户</th> <th>国地税报道</th> <th>刻章</th> <th>地址费用</th> <th>变更</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td>{{::customer.BillTime|tDate}}</td> <td>{{::customer.CompanyName}}</td> <td>{{::customer.ServiceContent}}</td> <td>{{::customer.PayName}}</td> <td>{{::customer.AccountNum}}</td> <td>{{::customer.SaleName}}</td> <td>{{::customer.SumAccount}}</td> <td>{{::customer.AccountsTax}}</td> <td>{{::customer.ServiceCharge}}</td> <td>{{::customer.TaxPayment}}</td> <td>{{::customer.AnnualReport}}</td> <td>{{::customer.Register}}</td> <td>{{::customer.OpenBank}}</td> <td>{{::customer.NationLocalTax}}</td> <td>{{::customer.Prints}}</td> <td>{{::customer.AddressCost}}</td> <td>{{::customer.Change}}</td> <td><a href="javascript:;" ng-if="!customer.AccountsTax" ng-click="delete(customer)">删除</a></td> </tr> </tbody> </table> <div class="u-paginator"> <uib-pagination total-items="paginator.total" items-per-page="paginator.perPage" boundary-links="true" ng-model="paginator.currentPage" previous-text="{{::paginator.previousText}}" next-text="{{::paginator.nextText}}" first-text="{{::paginator.firstText}}" last-text="{{::paginator.lastText}}" force-ellipses="true" max-size="6" num-pages="paginator.numPages" ng-change="pageChanged()"> </uib-pagination> <div class="u-pages"> <span>{{paginator.currentPage}}</span> / <span>{{paginator.numPages}}</span> <span>合计:{{paginator.total}}</span> </div> <form name="paginatorForm" novalidate> <div class="input-group"> <input type="number" name="paginatorInput" ng-model="currentPage" required min="1" max="{{paginator.numPages}}" class="form-control"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-disabled="!paginatorForm.$valid" ng-click="setCurrentPage()">Go!</button> </span> </div> </form> </div>'),a.put("views/order_statement_add.html",'<md-dialog class="md-dialog-lg order_statement_add"> <form name="cusform" novalidate> <md-toolbar> <div class="md-toolbar-tools"> <h2>增加对账单</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <md-dialog-content ng-cloak class="clearfix md-whiteframe-glow-z1 md-padding" style="overflow: auto"> <md-grid-list md-cols="2" md-cols-md="2" md-row-height="52px"> <md-grid-tile md-colspan="2"> <md-input-container layout="row"> <span class="md-label">订单时间</span> <md-datepicker ng-model="postData.BillTime" md-open-on-focus="true"></md-datepicker> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">客户</span> <input required ng-click="select()" readonly ng-disabled="customer.Id" flex ng-model="postData.CustomerName"> </md-input-container> <md-button ng-click="select()" class="md-primary md-raised" ng-if="!customer.Id">选择客户</md-button> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">销售</span> <md-select md-no-asterisk ng-model="postData.SalesId" required class="md-select"> <md-option ng-repeat="item in salers" ng-value="item.UserId">{{item.RealName}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">服务内容</span> <input required flex ng-model="postData.ServiceContent"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">收款方式</span> <md-select md-no-asterisk ng-model="postData.PayId" class="md-select" required> <md-option ng-repeat="pay in paymodes" ng-value="pay.Id">{{::pay.PayName}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">卡号</span> <input flex ng-model="postData.AccountNum" type="text"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">服务费</span> <input flex ng-model="postData.ServiceCharge" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">汇缴</span> <input flex ng-model="postData.TaxPayment" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">年报</span> <input flex ng-model="postData.AnnualReport" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">注册</span> <input flex ng-model="postData.Register" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">银行开户</span> <input flex ng-model="postData.OpenBank" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">国地税报道</span> <input flex ng-model="postData.NationLocalTax" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">刻章</span> <input flex ng-model="postData.Prints" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">地址费用</span> <input flex ng-model="postData.AddressCost" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">变更</span> <input flex ng-model="postData.Change" type="number"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">总金额</span> <input flex readonly ng-model="postData.SumAccount" ng-value="getAmount()" type="number"> </md-input-container> </md-grid-tile> </md-grid-list></md-dialog-content> <md-dialog-actions layout="row" md-colors="::{background: \'default-primary-100\'}"> <span flex></span> <md-button class="md-raised md-primary" ng-disabled="cusform.$invalid" ng-click="ok($event)">保存</md-button> <md-button ng-click="cancel()">取消</md-button> </md-dialog-actions> </form> </md-dialog>'),a.put("views/order_view.html",'<md-dialog style="width: 100%"> <md-toolbar> <div class="md-toolbar-tools"> <h2>查看订单</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <md-dialog-content ng-cloak class="clearfix md-whiteframe-glow-z1 md-padding" style="overflow: auto"> <form name="orderForm"> <div ng-include="\'views/order_addAgent.html\'" ng-controller="OrderAddAgent"></div> </form> </md-dialog-content> <md-dialog-actions layout="row" md-colors="::{background: \'default-primary-100\'}"> <span flex></span> <md-button ng-click="cancel()">取消</md-button> </md-dialog-actions> </md-dialog>'),a.put("views/outwork_dict.html",'<div class="recharge"> <div class="well well-sm u-search clearfix"> <div class="pull-left" style="margin: 12px 0"> <label for="subtask_search">子任务名称 ：</label> <input type="text" ng-model="search.TaskName" id="subtask_search"> </div> <div class="pull-left" style="margin: 12px 10px 0"> <label for="">分类名称：</label> <select ng-model="search.BusinessType" style="height:26px;width:80px"> <option value="" selected>请选择</option> <option value="1" ng-selected="searchData.BusinessType ==\'1\'">税务任务</option> <option value="2" ng-selected="searchData.BusinessType ==\'2\'">工商任务</option> <option value="3" ng-selected="searchData.BusinessType ==\'3\'">其他任务</option> </select> </div> <div class="pull-left" style="margin: 12px 10px 0"> <label for="">状态：</label> <select ng-model="search.Status" style="height:26px;width:80px"> <option value="0" selected>请选择</option> <option value="1">启用</option> <option value="2">停用</option> </select> </div> <button class="btn btn-primary pull-right" ng-click="open()" style="margin:12px 20px 0">&nbsp;&nbsp;&nbsp;新增&nbsp;&nbsp;&nbsp;</button> <button class="btn btn-primary pull-right" ng-click="searchFn()" style="margin:12px 0">&nbsp;&nbsp;&nbsp;搜索&nbsp;&nbsp;&nbsp;</button> </div> <table class="table table-striped table-hover table-bordered"> <thead> <tr class="info"> <th>序列ID</th> <th>子任务名称</th> <th>分类名称</th> <th>操作时间</th> <th>服务费用</th> <th>状态</th> <th>最后操作</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="outworker in outworkers"> <td style="text-align:center">{{outworker.Id}}</td> <td style="text-align:center">{{outworker.TaskName}}</td> <td style="text-align:center">{{outworker.BusinessType|fOtType}}</td> <td style="text-align:center">{{outworker.ModifyDate.replace("T"," ")}}</td> <td style="text-align:center">￥：{{outworker.Price.toFixed(2)}}</td> <td style="text-align:center">{{outworker.Status==1?"启用":"停用"}}</td> <td style="text-align:center">{{outworker.RealName}}</td> <td class="table-opt" style="text-align:center"> &nbsp;<a href="javascript:;" ng-click="open(outworker)">编辑</a>&nbsp;&nbsp;&nbsp; <a href="javascript:;" ng-click="stopOrnot(outworker.Status,outworker.Id)">{{outworker.Status==2?"启用":"停用"}}</a> </td> </tr> </tbody> </table> <div class="u-paginator"> <uib-pagination total-items="paginator.total" items-per-page="paginator.perPage" boundary-links="true" ng-model="paginator.currentPage" previous-text="{{::paginator.previousText}}" next-text="{{::paginator.nextText}}" first-text="{{::paginator.firstText}}" last-text="{{::paginator.lastText}}" force-ellipses="true" max-size="6" num-pages="paginator.numPages" ng-change="pageChanged()"> </uib-pagination> <div class="u-pages"> <span>{{paginator.currentPage}}</span> / <span>{{paginator.numPages}}</span> </div> <form name="paginatorForm" novalidate> <div class="input-group"> <input type="number" name="paginatorInput" ng-model="currentPage" required min="1" max="{{paginator.numPages}}" class="form-control"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-disabled="!paginatorForm.$valid" ng-click="setCurrentPage()">Go!</button> </span> </div> </form> </div> </div>'),a.put("views/outwork_dict_view.html",'<div class="modal-header"> <span class="close" ng-click="cancel()">&times;</span> <h3 class="modal-title">{{::title}}</h3> </div> <div class="modal-body"> <form name="cusform" novalidate class="form-inline"> <div class="clearfix" style="width:80%"> <div class="form-group col-md-12" style="margin: 12px 0"> <label for="" class="required">任务名称</label> <input type="text" class="form-control" ng-model="postData.TaskName" required style="width:300px" maxlength="15"> </div> <div class="form-group col-md-12" style="margin: 12px 0"> <label for="" class="required">分类名称</label> <select ng-model="postData.BusinessType" class="form-control" required style="width:200px"> <option value="">请选择</option> <option ng-value="1" ng-selected="postData.BusinessType ==1">税务任务</option> <option ng-value="2" ng-selected="postData.BusinessType ==2">工商任务</option> <option ng-value="3" ng-selected="postData.BusinessType ==3">其他任务</option> </select> </div> <div class="form-group col-md-12" style="margin: 12px 0"> <label for="" class="required">服务费用</label> <input type="number" class="form-control" ng-model="postData.Price" required placeholder="0" min="0" ng-input="checkPrice()"> </div> <div class="form-group col-md-12" style="margin: 12px 0"> 是否启用：<lable style="margin:0 30px;display:inline-block"><input type="radio" name="ifuse" value="1" ng-model="postData.ifuse.use">启用</lable> <lable style="margin:0 30px;display:inline-block"><input type="radio" name="ifuse" value="2" ng-model="postData.ifuse.use">停用</lable> </div> </div> </form> </div> <div class="modal-footer"> <button class="btn btn-primary" type="button" ng-disabled="cusform.$invalid" ng-click="ok()">保存</button> <button class="btn btn-warning" type="button" ng-click="cancel()">关闭</button> </div>'),a.put("views/outwork_weight_setting.html",'<div class="modal-header"> <span class="close" ng-click="cancel()">&times;</span> <h3 class="modal-title">{{::title}}</h3> </div> <div class="modal-body"> <table class="table table-striped table-hover table-bordered"> <thead> <tr> <th style="width:150px">序号</th> <th style="width:350px">子任务名称</th> <th style="width:150px">权重</th> <th></th> </tr> </thead> <tbody> <tr ng-repeat="item in Tasks|filter:{selected:true} as result track by item.TaskId"> <td>{{$index+1}}</td> <td>{{item.TaskName}}</td> <td><input type="number" ng-model="item._weight" ng-init="item._weight=$index+1" min="1" max="99" maxlength="2" ng-model-options="{allowInvalid:true}" ng-change="item._weight = toInt(item._weight)" min="1"></td> <td> <a ng-click="delete(item)" style="cursor:pointer">删除</a> </td> </tr> </tbody> </table> </div> <div class="modal-footer"> <button class="btn btn-primary" type="button" ng-disabled="cusform.$invalid" ng-click="ok()">确认</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button> </div>'),a.put("views/site_ps.html",'<div class="o-search well well-sm"> <form class="form-inline"> <div class="form-group"> <label class="control-label" for="cusname">类型</label>： <select class="form-control" ng-model="typeId"> <option value="1">公司核名</option> <option value="2">产品服务</option> <option value="3">贷帐公司</option> <option value="4">孵化器</option> <option value="5">渠道</option> </select> </div> <button type="button" class="btn btn-primary" ng-click="searchFn()">查询</button> </form> </div> <table class="table table-striped table-bordered table-hover table-condensed"> <thead> <th ng-repeat="head in headers" ng-bind="head"></th> <th>公司名称</th> <th>姓名</th> <th>联系电话</th> <th>留言</th> <th>类型</th> <th>留言时间</th> <!-- <th>动作</th> --> </thead> <tbody> <tr ng-repeat="row in data"> <td>{{row.CompanyName}}</td> <td>{{row.Name}}</td> <td>{{row.Mobile}}</td> <td>{{row.Remark}}</td> <td>{{row.TypeId|psType}}</td> <td>{{row.CreateDate.replace(\'T\',\' \')}}</td> <!-- <td>\\r\\n                    <a href="javascript:;" uib-tooltip="删除" ng-click="delete(row)"><i class="fa fa-pencil-square-o"></i>删除</a>\\r\\n                </td> --> </tr> </tbody> </table> <div class="u-paginator form-inline"> <uib-pagination total-items="paginator.total" items-per-page="paginator.perPage" boundary-links="true" ng-model="paginator.currentPage" previous-text="{{::paginator.previousText}}" next-text="{{::paginator.nextText}}" first-text="{{::paginator.firstText}}" last-text="{{::paginator.lastText}}" force-ellipses="true" max-size="6" num-pages="paginator.numPages" ng-change="pageChanged()"> </uib-pagination> <div class="u-pages"> <span>{{paginator.currentPage}}</span> / <span>{{paginator.numPages}}</span> <span>合计:{{paginator.total}}</span> </div> <form name="paginatorForm" novalidate> <div class="input-group"> <input type="number" name="paginatorInput" ng-model="currentPage" required min="1" max="{{paginator.numPages}}" class="form-control"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-disabled="!paginatorForm.$valid" ng-click="setCurrentPage()">Go!</button> </span> </div> </form> </div>'),
a.put("views/statis_cus.html",'<table class="table table-striped table-hover table-bordered" ng-if="!user.IsCenter"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>销售</th> <th>签约客户</th> <th>100%</th> <th>80%</th> <th>60%</th> <th>30%</th> <th>10%</th> <th>待筛选</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td>{{::customer.RealName}}</td> <td>{{::customer.BillType}}</td> <td><a href="javascript:;" ng-click="open(1,customer)">{{::customer.AType}}</a></td> <td><a href="javascript:;" ng-click="open(2,customer)">{{::customer.BType}}</a></td> <td><a href="javascript:;" ng-click="open(7,customer)">{{::customer.CType}}</a></td> <td><a href="javascript:;" ng-click="open(3,customer)">{{::customer.DType}}</a></td> <td><a href="javascript:;" ng-click="open(4,customer)">{{::customer.EType}}</a></td> <td><a href="javascript:;" ng-click="open(6,customer)">{{::customer.FType}}</a></td> </tr> <tr> <td>合计</td> <td>{{::total.BillType}}</td> <td>{{::total.AType}}</td> <td>{{::total.BType}}</td> <td>{{::total.CType}}</td> <td>{{::total.DType}}</td> <td>{{::total.EType}}</td> <td>{{::total.FType}}</td> </tr> </tbody> </table> <table class="table table-striped table-hover table-bordered" ng-if="user.IsCenter"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>公司名称</th> <th>签约客户</th> <th>100%</th> <th>80%</th> <th>60%</th> <th>30%</th> <th>10%</th> <th>待筛选</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td>{{::customer.CompanyName}}</td> <td>{{::customer.BillType}}</td> <td>{{::customer.AType}}</td> <td>{{::customer.BType}}</td> <td>{{::customer.CType}}</td> <td>{{::customer.DType}}</td> <td>{{::total.EType}}</td> <td>{{::customer.FType}}</td> </tr> <tr> <td>合计</td> <td>{{::total.BillType}}</td> <td>{{::total.AType}}</td> <td>{{::total.BType}}</td> <td>{{::total.CType}}</td> <td>{{::total.DType}}</td> <td>{{::total.EType}}</td> <td>{{::total.FType}}</td> </tr> </tbody> </table>'),a.put("views/statis_cus_detail.html",'<md-dialog aria-label="客户列表" class="md-dialog-lg"> <form name="cusform" novalidate> <md-toolbar> <div class="md-toolbar-tools"> <h2>客户列表</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <md-dialog-content ng-cloak class="clearfix md-whiteframe-glow-z1 md-padding" style="overflow: hidden"> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>公司名称</th> <th>联系人</th> <th>联系人电话</th> <th></th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td><a href="javascript:;" ng-click="track(customer)">{{::customer.CompanyName}}</a></td> <td>{{::customer.Connector}}</td> <td>{{::customer.Mobile}}</td> <td><a href="javascript:;" ng-click="track(customer)">查看</a></td> </tr> </tbody> </table> <div class="u-paginator"> <uib-pagination total-items="paginator.total" items-per-page="paginator.perPage" boundary-links="true" ng-model="paginator.currentPage" previous-text="{{::paginator.previousText}}" next-text="{{::paginator.nextText}}" first-text="{{::paginator.firstText}}" last-text="{{::paginator.lastText}}" force-ellipses="true" max-size="6" num-pages="paginator.numPages" ng-change="pageChanged()"> </uib-pagination> <div class="u-pages"> <span>{{paginator.currentPage}}</span> / <span>{{paginator.numPages}}</span> </div> </div> </md-dialog-content> <md-dialog-actions layout="row" md-colors="::{background: \'default-primary-100\'}"> <span flex></span> <md-button ng-click="cancel()">取消</md-button> </md-dialog-actions> </form> </md-dialog>'),a.put("views/statis_mate.html",'<div class="o-search well well-sm"> <form class="form-inline"> <md-grid-list md-cols="1" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">时间范围</span> <md-datepicker ng-model="search.start" md-open-on-focus="true"></md-datepicker> </md-input-container> <md-input-container layout="row"> <span style="line-height: 36px">至</span> <md-datepicker ng-model="search.end" md-open-on-focus="true"></md-datepicker> </md-input-container> <md-button class="md-raised md-primary" ng-click="searchFn()">查询</md-button> </md-grid-tile> </md-grid-list> </form> </div> <div style="width: 400px; float: left"> <canvas id="pie" class="chart chart-pie" chart-data="chart1Options.data" chart-labels="chart1Options.labels" chart-options="chart1Options.options" chart-click="chart1Options.onClick"> </canvas> <div class="text-center">合计：{{total}}</div> </div> <div style="width: 800px; height: 400px; float: left"> <div class="text-center">{{chart2Options.title}}</div> <canvas id="bar" class="chart chart-bar" chart-data="chart2Options.data" chart-labels="chart2Options.labels" chart-series="chart2Options.series"> </canvas> <div class="text-center">合计：{{total2}}</div> </div>'),a.put("views/statis_order.html",'<div class="o-search well well-sm"> <form class="form-inline"> <md-grid-list md-cols="5" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">开始日期</span> <md-datepicker ng-model="search.startdate" md-open-on-focus="true"></md-datepicker> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">结束日期</span> <md-datepicker ng-model="search.enddate" md-open-on-focus="true"></md-datepicker> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="!user.IsCenter"> <md-input-container layout="row"> <span class="md-label">销售</span> <md-select md-no-asterisk ng-model="search.SalesId" aria-label="saler" class="md-select"> <md-option ng-value="\'\'" selected>全部</md-option> <md-option ng-repeat="item in salers" ng-value="item.UserId">{{item.RealName}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container> <md-button class="md-raised md-primary" ng-click="search()">查询</md-button> </md-input-container> </md-grid-tile> </md-grid-list> </form> </div> <table ng-if="!user.IsCenter" class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>销售</th> <th>小规模数量</th> <th>小规模金额</th> <th>一般纳税人数量</th> <th>一般纳税人金额</th> <th>合计数量</th> <th>合计金额</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td>{{::customer.SalesName}}</td> <td>{{::customer.SmallScale}}</td> <td>{{::customer.SmallAmount}}</td> <td>{{::customer.GeneralTaxpayer}}</td> <td>{{::customer.GeneralAmount}}</td> <td>{{::customer.orderHJ}}</td> <td>{{::customer.AmountHJ}}</td> </tr> <tr> <td>合计</td> <td>{{total.SmallScale}}</td> <td>{{total.SmallAmount}}</td> <td>{{total.GeneralTaxpayer}}</td> <td>{{total.GeneralAmount}}</td> <td>{{total.orderHJ}}</td> <td>{{total.AmountHJ}}</td> </tr> </tbody> </table> <table ng-if="user.IsCenter" class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>直营公司</th> <th>小规模数量</th> <th>小规模金额</th> <th>一般纳税人数量</th> <th>一般纳税人金额</th> <th>合计数量</th> <th>合计金额</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td>{{::customer.SubsidiaryName}}</td> <td>{{::customer.SmallScale}}</td> <td>{{::customer.SmallAmount}}</td> <td>{{::customer.GeneralTaxpayer}}</td> <td>{{::customer.GeneralAmount}}</td> <td>{{::customer.orderHJ}}</td> <td>{{::customer.AmountHJ}}</td> </tr> <tr> <td>合计</td> <td>{{total.SmallScale}}</td> <td>{{total.SmallAmount}}</td> <td>{{total.GeneralTaxpayer}}</td> <td>{{total.GeneralAmount}}</td> <td>{{total.orderHJ}}</td> <td>{{total.AmountHJ}}</td> </tr> </tbody> </table> <!-- <div class="u-paginator">\r\n    <uib-pagination total-items="paginator.total" items-per-page="paginator.perPage" boundary-links="true" ng-model="paginator.currentPage" previous-text="{{::paginator.previousText}}" next-text="{{::paginator.nextText}}" first-text="{{::paginator.firstText}}" last-text="{{::paginator.lastText}}" force-ellipses="true" max-size="6" num-pages="paginator.numPages" ng-change="pageChanged()">\r\n    </uib-pagination>\r\n    <div class="u-pages">\r\n        <span>{{paginator.currentPage}}</span> /\r\n        <span>{{paginator.numPages}}</span> <span>合计:{{paginator.total}}</span>\r\n    </div>\r\n    <form name="paginatorForm" novalidate>\r\n        <div class="input-group">\r\n            <input type="number" name="paginatorInput" ng-model="currentPage" required min="1" max="{{paginator.numPages}}" class="form-control">\r\n            <span class="input-group-btn">\r\n                        <button class="btn btn-default" type="button"  ng-disabled="!paginatorForm.$valid" ng-click="setCurrentPage()">Go!</button>\r\n                    </span>\r\n        </div>\r\n    </form>\r\n</div> -->'),a.put("views/statis_signed.html",'<div class="o-search well well-sm"> <form class="form-inline"> <md-grid-list md-cols="1" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">时间范围</span> <md-datepicker ng-model="search.start" md-open-on-focus="true"></md-datepicker> </md-input-container> <md-input-container layout="row"> <span style="line-height: 36px">至</span> <md-datepicker ng-model="search.end" md-open-on-focus="true"></md-datepicker> </md-input-container> <md-button class="md-raised md-primary" ng-click="searchFn()">查询</md-button> </md-grid-tile> </md-grid-list> </form> </div> <div style="width: 400px; float: left"> <canvas id="pie" class="chart chart-pie" chart-data="chart1Options.data" chart-labels="chart1Options.labels" chart-options="chart1Options.options" chart-click="chart1Options.onClick"> </canvas> <div class="text-center">合计：{{total}}</div> </div> <div style="width: 800px; height: 400px; float: left"> <div class="text-center">{{chart2Options.title}}</div> <canvas id="bar" class="chart chart-bar" chart-data="chart2Options.data" chart-labels="chart2Options.labels" chart-series="chart2Options.series"> </canvas>  <div class="text-center">合计：{{total2}}</div> </div>'),a.put("views/statis_tend.html",'<div class="o-search well well-sm"> <form class="form-inline"> <md-grid-list md-cols="1" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label">时间范围</span> <md-datepicker ng-model="search.start" md-open-on-focus="true"></md-datepicker> </md-input-container> <md-input-container layout="row"> <span style="line-height: 36px">至</span> <md-datepicker ng-model="search.end" md-open-on-focus="true"></md-datepicker> </md-input-container> <md-button class="md-raised md-primary" ng-click="searchFn()">查询</md-button> </md-grid-tile> </md-grid-list> </form> </div> <div style="width: 400px; float: left"> <canvas id="pie" class="chart chart-pie" chart-data="chart1Options.data" chart-labels="chart1Options.labels" chart-options="chart1Options.options" chart-click="chart1Options.onClick"> </canvas> <div class="text-center">合计：{{total}}</div> </div> <div style="width: 800px; height: 400px; float: left"> <div class="text-center">{{chart2Options.title}}</div> <canvas id="line" class="chart chart-line" chart-data="chart2Options.data" chart-labels="chart2Options.labels" chart-series="chart2Options.series" chart-options="chart1Options.options"> </canvas> <div class="text-center">合计：{{total2}}</div> </div>'),a.put("views/statis_today.html",'<div class="o-search well well-sm"> <form class="form-inline"> <md-grid-list md-cols="4" md-row-height="52px"> <md-grid-tile ng-if="user.RoleId<11"> <md-input-container layout="row"> <span class="md-label">分组</span> <md-select md-no-asterisk ng-model="search.DepartmentId" class="md-select" ng-change="verifyGroup()"> <md-option ng-value="0" ng-selected="true">全部</md-option> <md-option ng-repeat="g in groups" ng-value="g.DepartmentId">{{g.DepartmentName}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile md-colspan="2"> <div class="text-center"> <md-input-container> <md-button class="md-raised md-primary" ng-click="searchFn()">查询</md-button> </md-input-container> </div> </md-grid-tile> </md-grid-list> </form> </div> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th style="width: 40px" ng-show="batIsOpen"></th> <th>公司名称</th> <th>联系人</th> <th>联系人电话</th> <th>意向度</th> <th>首次跟踪时间</th> <th>最后跟踪时间</th> <th>销售</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td ng-show="batIsOpen"> <md-checkbox ng-model="customer.selected" ng-true-value="true" ng-false-value="false" class="md-primary md-align-top-left" flex> </md-checkbox> </td> <td>{{customer.CompanyName}}</td> <td>{{customer.Connector}}</td> <td>{{customer.Mobile}}</td> <td>{{customer.CustomerTypeName}}</td> <td>{{customer.FirstTrackTime|tDate}}</td> <td>{{customer.LastTrackTime|tDate}}</td> <td>{{customer.SaleName}}</td> </tr> </tbody> </table> <div class="u-paginator"> <uib-pagination total-items="paginator.total" items-per-page="paginator.perPage" boundary-links="true" ng-model="paginator.currentPage" previous-text="{{::paginator.previousText}}" next-text="{{::paginator.nextText}}" first-text="{{::paginator.firstText}}" last-text="{{::paginator.lastText}}" force-ellipses="true" max-size="6" num-pages="paginator.numPages" ng-change="pageChanged()"> </uib-pagination> <div class="u-pages"> <span>{{paginator.currentPage}}</span> / <span>{{paginator.numPages}}</span> &nbsp; <span>合计:{{paginator.total}}</span> </div> <form name="paginatorForm" novalidate> <div class="input-group"> <input type="number" name="paginatorInput" ng-model="currentPage" required min="1" max="{{paginator.numPages}}" class="form-control"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-disabled="!paginatorForm.$valid" ng-click="setCurrentPage()">Go!</button> </span> </div> </form> </div>'),a.put("views/statis_top.html",'<div ng-cloak> <div class="text-center statis-header">个人排行榜</div> <md-content> <md-tabs md-dynamic-height md-border-bottom> <md-tab label="到款数"> <md-content class="md-padding clearfix"> <div style="width: 200px; margin: 12px;float: left" ng-repeat="item in typeSList"> <h4 class="text-center">{{item.CompanyName}}</h4> <ul class="list-group"> <li class="list-group-item" ng-repeat="saler in item.salers"><span class="list-header">{{saler.RealName}}</span><span class="list-num">{{saler.Num}}</span></li> <li class="list-group-item"><span class="list-header">合计：</span><span class="list-num">{{item.total}}</span></li> </ul> </div> </md-content> </md-tab> <md-tab label="60%客户数"> <md-content class="md-padding"> <div layout="row"> <div style="width: 200px; margin: 12px;float: left" ng-repeat="item in typeCList"> <h4 class="text-center">{{item.CompanyName}}</h4> <ul class="list-group"> <li class="list-group-item" ng-repeat="saler in item.salers"><span class="list-header">{{saler.RealName}}</span><span class="list-num">{{saler.Num}}</span></li> <li class="list-group-item"><span class="list-header">合计：</span><span class="list-num">{{item.total}}</span></li> </ul> </div> </div> </md-content> </md-tab> <md-tab label="80%客户数"> <md-content class="md-padding"> <div layout="row"> <div style="width: 200px; margin: 12px;float: left" ng-repeat="item in typeBList"> <h4 class="text-center">{{item.CompanyName}}</h4> <ul class="list-group"> <li class="list-group-item" ng-repeat="saler in item.salers"><span class="list-header">{{saler.RealName}}</span><span class="list-num">{{saler.Num}}</span></li> <li class="list-group-item"><span class="list-header">合计：</span><span class="list-num">{{item.total}}</span></li> </ul> </div> </div> </md-content> </md-tab> </md-tabs> </md-content> </div> <div ng-cloak> <div class="text-center statis-header">分组排行榜</div> <md-content> <md-tabs md-dynamic-height md-border-bottom> <md-tab label="{{company.CompanyName}}" ng-repeat="company in companies"> <md-content class="md-padding clearfix"> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>签约数</th> <th>60%客户</th> <th>80%客户</th> <th>99%客户</th> </tr> </thead> <tbody> <tr> <td> <ul class="list-group"> <li class="list-group-item" ng-repeat="saler in company.SList"><span class="list-header">{{saler.DepartmentName||"其他"}}</span><span class="list-num">{{saler.Num}}</span></li> <li class="list-group-item"><span class="list-header">合计：</span><span class="list-num">{{company.total.st}}</span></li> </ul> </td> <td> <ul class="list-group"> <li class="list-group-item" ng-repeat="saler in company.CList"><span class="list-header">{{saler.DepartmentName||"其他"}}</span><span class="list-num">{{saler.Num}}</span></li> <li class="list-group-item"><span class="list-header">合计：</span><span class="list-num">{{company.total.ct}}</span></li> </ul> </td> <td> <ul class="list-group"> <li class="list-group-item" ng-repeat="saler in company.BList"><span class="list-header">{{saler.DepartmentName||"其他"}}</span><span class="list-num">{{saler.Num}}</span></li> <li class="list-group-item"><span class="list-header">合计：</span><span class="list-num">{{company.total.bt}}</span></li> </ul> </td> <td> <ul class="list-group"> <li class="list-group-item" ng-repeat="saler in company.AList"><span class="list-header">{{saler.DepartmentName||"其他"}}</span><span class="list-num">{{saler.Num}}</span></li> <li class="list-group-item"><span class="list-header">合计：</span><span class="list-num">{{company.total.at}}</span></li> </ul> </td> </tr> </tbody> </table> </md-content> </md-tab> </md-tabs> </md-content> </div>'),a.put("views/tpl_inputContainer.html",'<md-input-container md-theme="{{to.theme}}"> <span class="md-label">{{to.label}}</span> <formly-transclude></formly-transclude> <div ng-messages="fc.$error" ng-show="showError"> <div ng-repeat="(name, message) in ::options.validation.messages" ng-message-exp="name"> {{message(fc.$viewValue, fc.$modelValue, this)}} </div> </div> </md-input-container>'),a.put("views/user_group.html",'<div layout="row" style="height: 100%"> <div style="width: 300px" class="md-padding"> <md-nav-bar> <md-nav-item md-nav-click="" class="md-active" ng-disabled="true" name="page1">分组列表</md-nav-item> </md-nav-bar> <ul class="list-group md-padding" style="max-height: 60%;overflow: auto"> <li ng-repeat="group in groups" ng-click="active(group)" class="list-group-item" ng-class="{active:group.active}" style="cursor: pointer"><span>{{group.DepartmentName}}</span> <span class="close pull-right" ng-click="delete(group.DepartmentId);$event.stopPropagation()">&times;</span></li> </ul> <div> <md-button class="md-raised md-primary" ng-click="add()">添加</md-button> </div> </div> <div flex class="md-padding"> <div layout="row"> <span flex></span> <md-button class="md-raised md-primary" ng-click="addMember()">增加成员</md-button> </div> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>姓名</th> <th style="width: 200px">操作</th> </tr> </thead> <tbody> <tr ng-repeat="member in members"> <td>{{::member.RealName}} <span style="color: red" ng-if="member.IsGroupLeader">(组长)</span></td> <td class="table-opt"> <a href="javascript:;" ng-click="setLeader(member)">设为组长</a> <a href="javascript:;" ng-click="deleteMember(member)">移除成员</a> </td> </tr> </tbody> </table> </div> </div>'),a.put("views/user_group_addMember.html",'<md-dialog class="md-dialog-md"> <form name="cusform" novalidate> <md-toolbar> <div class="md-toolbar-tools"> <h2>增加成员</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <md-dialog-content ng-cloak class="clearfix md-whiteframe-glow-z1 md-padding" style="overflow: hidden"> <md-input-container layout="row"> <span class="md-label md-required">成员选择</span> <md-select md-no-asterisk ng-model="selecteds" required class="md-select" multiple> <md-option ng-repeat="user in users" ng-if="!user.hide" ng-value="user.UserId">{{user.RealName}}</md-option> </md-select> </md-input-container> </md-dialog-content> <md-dialog-actions layout="row" md-colors="::{background: \'default-primary-100\'}"> <span flex></span> <md-button class="md-raised md-primary" ng-disabled="!selecteds" ng-click="ok($event)">保存</md-button> <md-button ng-click="cancel()">取消</md-button> </md-dialog-actions> </form> </md-dialog>'),a.put("views/user_group_addgroup.html",'<md-dialog aria-label="添加组" class="md-dialog-md"> <md-toolbar> <div class="md-toolbar-tools"> <h2>添加组</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <form name="cusform" novalidate> <md-dialog-content ng-cloak class="clearfix md-whiteframe-glow-z1 md-padding" style="overflow: hidden"> <md-input-container layout="row"> <span class="md-label md-required">组名称</span> <input required flex required ng-model="name"> </md-input-container> </md-dialog-content> <md-dialog-actions layout="row" md-colors="::{background: \'default-primary-100\'}"> <span flex></span> <md-button class="md-raised md-primary" ng-disabled="cusform.$invalid" ng-click="ok($event)">保存</md-button> <md-button ng-click="cancel()">取消</md-button> </md-dialog-actions> </form> </md-dialog>'),a.put("views/user_my.html",'<md-toolbar> <div class="md-toolbar-tools"> <h2>修改用户信息</h2> <span flex></span> </div> </md-toolbar> <form name="cusform" novalidate> <md-grid-list md-cols="1" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">用户名</span> <input flex ng-model="postData.UserName" class="md-input" disabled> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">联系电话</span> <input required flex ng-model="postData.Phone" class="md-input"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-button class="md-raised md-primary" ng-disabled="cusform.$invalid" ng-click="ok($event)">保存</md-button> </md-grid-tile> </md-grid-list> </form> <md-toolbar> <div class="md-toolbar-tools"> <h2>修改密码</h2> <span flex></span> </div> </md-toolbar> <form name="psdform" novalidate> <md-grid-list md-cols="1" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">原密码</span> <input flex ng-model="psdData.Old" type="passWord" class="md-input"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">新密码</span> <input required flex ng-model="psdData.New" type="passWord" class="md-input"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">重复新密码</span> <input required flex ng-model="psdData.New2" type="passWord" class="md-input"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-button class="md-raised md-primary" ng-disabled="psdform.$invalid" ng-click="changePsd($event)">保存</md-button> </md-grid-tile> </md-grid-list> </form>'),a.put("views/user_outworker.html",'<div class="o-search well well-sm clearfix"> <md-input-container class="pull-right" style="margin:0"> <md-button class="md-raised md-primary" ng-click="open()">新增用户</md-button> </md-input-container> </div> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>姓名</th> <th>联系电话</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="outworker in outworkers"> <td>{{outworker.Name}}</td> <td>{{outworker.Phone}}</td> <td class="table-opt"> <a href="javascript:;" ng-click="open(outworker)">查看</a> <a href="javascript:;" ng-click="delete(outworker)">删除</a> </td> </tr> </tbody> </table>'),a.put("views/user_outworker_view.html",'<md-dialog aria-label="用户" class="md-dialog-lg"> <form name="cusform" novalidate> <md-toolbar> <div class="md-toolbar-tools"> <h2>{{::title}}</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <md-dialog-content ng-cloak class="clearfix md-whiteframe-glow-z1 md-padding" style="overflow: hidden"> <md-grid-list md-cols="2" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">姓名</span> <input flex required ng-model="postData.Name" class="md-input"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">联系电话</span> <input required flex ng-model="postData.Phone" class="md-input"> </md-input-container> </md-grid-tile> </md-grid-list> </md-dialog-content> <md-dialog-actions layout="row" md-colors="::{background: \'default-primary-100\'}"> <span flex></span> <md-button class="md-raised md-primary" ng-disabled="cusform.$invalid" ng-click="ok($event)">保存</md-button> <md-button ng-click="cancel()">取消</md-button> </md-dialog-actions> </form> </md-dialog>'),a.put("views/user_users.html",'<div class="o-search well well-sm clearfix"> <md-input-container class="pull-right" style="margin:0"> <md-button class="md-raised md-primary" ng-click="open()">新增用户</md-button> </md-input-container> </div> <table class="table table-striped table-hover table-bordered"> <thead> <tr md-colors="::{background: \'default-primary-50\'}"> <th>用户名</th> <th>姓名</th> <th>角色</th> <th>联系电话</th> <th>操作</th> </tr> </thead> <tbody> <tr ng-repeat="customer in customers"> <td>{{::customer.UserName}}</td> <td>{{::customer.RealName}}</td> <td>{{::customer.RoleName}}</td> <td>{{::customer.Phone}}</td> <td class="table-opt"> <a href="javascript:;" ng-click="open(customer)">查看</a> <a href="javascript:;" ng-click="delete(customer)">删除</a> </td> </tr> </tbody> </table>'),a.put("views/user_view.html",'<md-dialog aria-label="用户" class="md-dialog-lg"> <form name="cusform" novalidate> <md-toolbar> <div class="md-toolbar-tools"> <h2>{{::title}}</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <i class="fa fa-times"></i> </md-button> </div> </md-toolbar> <md-dialog-content ng-cloak class="clearfix md-whiteframe-glow-z1 md-padding" style="overflow: hidden"> <md-grid-list md-cols="2" md-row-height="52px"> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">用户名</span> <input flex ng-model="postData.UserName" class="md-input"> </md-input-container> </md-grid-tile> <md-grid-tile ng-if="!postData.UserId"> <md-input-container layout="row"> <span class="md-label md-required">用户密码</span> <input required flex ng-model="postData.PassWord" type="passWord" class="md-input"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">姓名</span> <input flex required ng-model="postData.RealName" class="md-input"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">联系电话</span> <input required flex ng-model="postData.Phone" class="md-input"> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">用户角色</span> <md-select required md-no-asterisk ng-model="postData.RoleId" class="md-select" ng-change="changeRole()"> <md-option ng-repeat="item in roles" ng-value="item.RoleId">{{item.RoleName}}</md-option> </md-select> </md-input-container> </md-grid-tile> <md-grid-tile> <md-input-container layout="row"> <span class="md-label md-required">用户权限</span> <md-select required ng-model="postData.functions" class="md-select" md-selected-text="getSelectedText()" multiple ng-model-options="{trackBy: \'$value.Id\'}"> <md-optgroup ng-repeat="fun in functionlist" label="{{fun.name}}"> <md-option ng-repeat="item in fun.pages" ng-value="item">{{item.name}}</md-option> </md-optgroup> </md-select> </md-input-container> </md-grid-tile> </md-grid-list> </md-dialog-content> <md-dialog-actions layout="row" md-colors="::{background: \'default-primary-100\'}"> <span flex></span> <md-button class="md-raised md-primary" ng-disabled="cusform.$invalid" ng-click="ok($event)">保存</md-button> <md-button ng-click="cancel()">取消</md-button> </md-dialog-actions> </form> </md-dialog>')}]);